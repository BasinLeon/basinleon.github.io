<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NEXUS::CRM | Sovereign Revenue Architecture</title>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  
  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- CSV Parser -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
            mono: ['JetBrains Mono', 'monospace'],
            serif: ['Cinzel', 'serif'],
          },
          colors: {
            gold: {
              400: '#D4AF37',
              500: '#C5A028',
              600: '#B08D23',
            },
            obsidian: '#020617',
            charcoal: '#0F172A',
          }
        }
      }
    }
  </script>

  <style>
    body {
      background-color: #020617;
      background-image: 
        radial-gradient(circle at 50% 0%, rgba(212, 175, 55, 0.05) 0%, transparent 40%),
        radial-gradient(circle at 100% 100%, rgba(15, 23, 42, 1) 0%, transparent 40%);
      color: #e2e8f0;
    }

    /* Glassmorphism Classes */
    .glass-panel {
      background: rgba(15, 23, 42, 0.6);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.05);
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
    }
    
    .glass-header {
      background: rgba(2, 6, 23, 0.8);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(212, 175, 55, 0.1);
    }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: #020617; }
    ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #D4AF37; }

    /* Utilities */
    .text-gold-glow {
      text-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
    }
    
    .card-hover:hover {
      border-color: rgba(212, 175, 55, 0.3);
      transform: translateY(-2px);
      box-shadow: 0 10px 40px -10px rgba(0,0,0,0.5);
    }

    @keyframes pulse-gold {
      0%, 100% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0); }
      50% { box-shadow: 0 0 10px 0 rgba(212, 175, 55, 0.2); }
    }
    .animate-pulse-gold {
      animation: pulse-gold 2s infinite;
    }

    /* EXECUTIVE PRINT SYSTEM */
    #print-brief-template { display: none; }
    
    @media print {
      body * { visibility: hidden; }
      #print-brief-template, #print-brief-template * { visibility: visible; }
      #print-brief-template {
        display: block !important;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        background: white !important;
        color: black !important;
        font-family: 'Cinzel', serif;
        padding: 40px;
      }
      .brief-tag {
        font-family: 'JetBrains Mono', monospace;
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 2px;
        border-bottom: 1px solid #000;
        padding-bottom: 4px;
        margin-bottom: 20px;
      }
      .brief-title { font-size: 28px; font-weight: 700; margin-bottom: 40px; }
      .brief-meta { 
        display: grid; 
        grid-template-columns: 1fr 1fr; 
        gap: 20px; 
        margin-bottom: 40px;
        font-family: 'Inter', sans-serif;
      }
      .meta-block h5 { font-size: 8px; font-weight: 900; text-transform: uppercase; color: #666; margin-bottom: 5px; }
      .meta-block p { font-size: 14px; margin: 0; }
      .intel-section { margin-top: 40px; border-left: 4px solid #000; padding-left: 20px; }
      .intel-header { font-size: 12px; font-weight: 900; text-transform: uppercase; margin-bottom: 10px; }
      .intel-body { font-size: 16px; font-style: italic; line-height: 1.6; }
      .risk-block { 
        margin-top: 50px; 
        padding: 20px; 
        background: #f8f8f8 !important; 
        border: 1px solid #ddd;
        page-break-inside: avoid;
      }
      .decision-footer {
        position: fixed;
        bottom: 40px;
        left: 40px;
        right: 40px;
        border-top: 1px solid #eee;
        padding-top: 10px;
        font-size: 9px;
        font-family: 'JetBrains Mono', monospace;
        display: flex;
        justify-content: space-between;
      }
    }
  </style>
</head>
<body class="h-screen flex flex-col overflow-hidden selection:bg-gold-500/20">

  <!-- SIGNAL REFINERY OVERLAY -->
  <div id="refinery-overlay" class="fixed inset-0 bg-obsidian z-[60] hidden flex-col items-center justify-center">
    <div class="w-96">
      <div class="flex justify-between text-[10px] font-mono mb-2 text-gold-400">
        <span id="refinery-stage">INITIALIZING ENQUIRY...</span>
        <span id="refinery-percent">0%</span>
      </div>
      <div class="h-1 bg-slate-800 rounded-full overflow-hidden mb-8">
        <div id="refinery-bar" class="h-full bg-gold-400 w-0 transition-all duration-100 ease-out"></div>
      </div>
      
      <div class="font-mono text-[10px] text-slate-500 h-32 overflow-hidden border border-slate-800 bg-slate-900/50 p-4 rounded" id="refinery-log">
        <!-- Logs go here -->
      </div>
    </div>
  </div>

  <!-- TOP BAR -->
  <header class="glass-header h-16 flex items-center justify-between px-6 z-50 shrink-0">
    <div class="flex items-center gap-4">
      <button onclick="toggleClientMode()" class="cursor-pointer h-8 w-8 bg-gradient-to-br from-gold-400 to-amber-700 rounded-sm flex items-center justify-center shadow-[0_0_15px_rgba(212,175,55,0.3)] hover:scale-110 transition border-none p-0" id="logo-box">
        <i class="fa-solid fa-cube text-obsidian text-lg" id="logo-icon"></i>
      </button>
      <div>
        <h1 class="font-serif text-lg tracking-widest text-slate-100" id="app-title">BASIN<span class="text-gold-400">::</span>NEXUS</h1>
        <div class="text-[9px] font-mono text-slate-500 tracking-[0.2em] uppercase" id="app-subtitle">Sovereign Revenue Architecture</div>
      </div>
    </div>

    <div class="flex items-center gap-8">
      <!-- Status Indicators -->
      <div class="hidden md:flex gap-4">
        <div class="flex items-center gap-2 px-3 py-1 bg-slate-800/50 border border-slate-700 rounded-full">
          <div class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></div>
          <span class="text-[10px] font-mono uppercase tracking-wider text-slate-400">NEXUS AI ONLINE</span>
        </div>
        <button onclick="toggleHunterMode()" class="flex items-center gap-2 px-3 py-1 bg-slate-800/50 border border-slate-700 rounded-full hover:bg-slate-700 transition opacity-50 hover:opacity-100" id="hunter-btn" title="Activating Executive Search Protocol...">
            <i class="fa-solid fa-crosshairs text-red-500 text-[10px]"></i>
            <span class="text-[10px] font-mono uppercase tracking-wider text-slate-400 hidden xl:inline">Hunter Mode</span>
        </button>
        <button onclick="runRefinerySequence()" class="flex items-center gap-2 px-3 py-1 bg-slate-800/50 border border-slate-700 rounded-full hover:bg-slate-700 transition">
          <i class="fa-solid fa-rotate text-gold-400 text-[10px]"></i>
          <span class="text-[10px] font-mono uppercase tracking-wider text-slate-400">Refresh Data</span>
        </button>
      </div>

      <div class="h-6 w-px bg-slate-800"></div>

      <!-- User Nav -->
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 rounded-full border border-gold-400/30 bg-slate-900 overflow-hidden">
           <img src="https://ui-avatars.com/api/?name=Leon+Basin&background=020617&color=D4AF37&font-size=0.4" alt="User">
        </div>
      </div>
    </div>
  </header>

  <div class="flex flex-1 overflow-hidden">
    
    <!-- SIDEBAR -->
    <aside class="w-20 lg:w-64 glass-panel border-r-0 border-t-0 border-b-0 border-l-0 border-r border-white/5 flex flex-col shrink-0 z-40">
      
      <!-- Nav Items -->
      <nav class="flex-1 py-8 flex flex-col gap-2 px-3">
        
        <div class="px-3 mb-2 text-[10px] font-mono uppercase text-slate-600 hidden lg:block">Command</div>
        
        <!-- Active War Room Filter -->
        <button onclick="resetFilters()" class="flex items-center gap-4 px-3 py-3 rounded-lg bg-gold-500/10 border border-gold-500/20 text-gold-500 group transition-all text-left w-full">
          <i class="fa-solid fa-layer-group w-5 text-center group-hover:scale-110 transition"></i>
          <span class="font-medium hidden lg:block">Signal Feed</span>
        </button>

        <button onclick="toggleRevenueHealth()" class="flex items-center gap-4 px-3 py-3 rounded-lg text-slate-400 hover:bg-slate-800/50 hover:text-slate-100 group transition-all text-left w-full outline-none focus:bg-slate-800/50">
          <i class="fa-solid fa-chart-line w-5 text-center group-hover:scale-110 transition"></i>
          <span class="font-medium hidden lg:block">Revenue Health</span>
        </button>

        <div class="my-4 h-px bg-slate-800 mx-2"></div>

        <div class="px-3 mb-2 text-[10px] font-mono uppercase text-slate-600 hidden lg:block">Refinery Segments</div>

        <!-- Tech Stack Filters -->
        <button onclick="filterByTech('salesforce')" class="flex items-center gap-4 px-3 py-2 rounded-lg text-slate-500 hover:bg-slate-800/30 hover:text-blue-400 group transition-all text-sm w-full text-left">
          <i class="fa-brands fa-salesforce w-5 text-center"></i>
          <span class="hidden lg:block">Salesforce Ops</span>
        </button>

        <button onclick="filterByTech('hubspot')" class="flex items-center gap-4 px-3 py-2 rounded-lg text-slate-500 hover:bg-slate-800/30 hover:text-orange-400 group transition-all text-sm w-full text-left">
          <i class="fa-brands fa-hubspot w-5 text-center"></i>
          <span class="hidden lg:block">HubSpot Users</span>
        </button>
        
        <button onclick="filterBySource('Founder List')" class="flex items-center gap-4 px-3 py-2 rounded-lg text-slate-500 hover:bg-slate-800/30 hover:text-purple-400 group transition-all text-sm w-full text-left">
          <i class="fa-solid fa-rocket w-5 text-center"></i>
          <span class="hidden lg:block">Founder List</span>
        </button>

      </nav>

      <!-- Bottom Widget -->
      <div class="p-4 hidden lg:block">
        <div class="rounded-xl bg-gradient-to-b from-slate-800/50 to-slate-900/80 border border-white/5 p-4">
          <div class="flex items-center gap-2 mb-3">
            <i class="fa-solid fa-shield-halved text-gold-400"></i>
            <span class="text-xs font-bold text-white">Sovereignty Score</span>
          </div>
          <div class="flex justify-between items-end mb-1">
            <span class="text-2xl font-mono text-white">94%</span>
            <span class="text-[10px] text-emerald-400 mb-1">Strategic Command</span>
          </div>
          <div class="w-full bg-slate-700 h-1 rounded-full overflow-hidden">
            <div class="bg-gold-400 h-full w-[94%]"></div>
          </div>
          <div class="mt-2 text-[10px] text-slate-500">System Fully Operational</div>
        </div>
      </div>
    </aside>

    <!-- CONTENT AREA -->
    <main class="flex-1 flex flex-col min-w-0 bg-obsidian relative">
      
      <!-- Background Grid -->
      <div class="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 pointer-events-none"></div>
      
      <!-- Toolbar -->
      <div class="p-6 relative z-10" id="main-dashboard-header">
        <!-- Dashboard Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <div class="glass-panel rounded-xl p-5 border-l-4 border-l-gold-500/50">
                <div class="text-slate-500 text-[10px] font-mono uppercase tracking-widest mb-1">Active Signals</div>
                <div class="text-3xl font-mono text-white tracking-tighter" id="stat-total-leads">0</div>
            </div>
            <div class="glass-panel rounded-xl p-5 border-l-4 border-l-blue-500/50">
                <div class="text-slate-500 text-[10px] font-mono uppercase tracking-widest mb-1">Enriched Data Points</div>
                <div class="text-3xl font-mono text-white tracking-tighter" id="stat-total-companies">0</div>
            </div>
            <div class="glass-panel rounded-xl p-5 border-l-4 border-l-red-500/50">
                <div class="text-slate-500 text-[10px] font-mono uppercase tracking-widest mb-1">High Probability</div>
                <div class="text-3xl font-mono text-white tracking-tighter" id="stat-high-priority">0</div>
            </div>
            <div class="glass-panel rounded-xl p-5 border-l-4 border-l-emerald-500/50">
                <div class="text-slate-500 text-[10px] font-mono uppercase tracking-widest mb-1">System Status</div>
                <div class="text-2xl font-mono text-emerald-400 tracking-tighter">ONLINE</div>
            </div>
        </div>

        <div class="flex flex-col md:flex-row gap-4 justify-between items-end md:items-center">
            <div>
              <h2 class="text-2xl font-serif text-white mb-1" id="page-title">Sovereign Signal Feed</h2>
              <p class="text-sm text-slate-500 font-mono" id="page-subtitle">Real-time enrichment from Basin::Refinery</p>
            </div>

            <div class="flex gap-3 w-full md:w-auto">
              <div class="relative group flex-1 md:w-80">
                <div class="absolute -inset-0.5 bg-gradient-to-r from-gold-500/20 to-purple-600/20 rounded-lg blur opacity-75 group-hover:opacity-100 transition duration-1000 group-hover:duration-200"></div>
                <div class="relative flex items-center">
                   <i class="fa-solid fa-search absolute left-3 text-slate-500"></i>
                   <input type="text" id="searchInput" placeholder="Search target accounts..." class="w-full bg-slate-900/90 text-slate-200 text-sm rounded-lg pl-10 pr-4 py-2.5 border border-slate-700 focus:border-gold-500 focus:outline-none focus:ring-1 focus:ring-gold-500/50 placeholder:text-slate-600 font-mono">
                </div>
              </div>
            </div>
        </div>
      </div>
      
      <!-- REVENUE HEALTH VIEW (Originally Hidden) -->
      <div id="revenue-health-view" class="hidden absolute inset-0 bg-obsidian z-20 p-8 overflow-y-auto">
          <h2 class="text-3xl font-serif text-white mb-8 border-b border-white/10 pb-4">Revenue Lifecycle Health</h2>
          
          <div class="grid grid-cols-3 gap-6 mb-8">
              <div class="glass-panel p-6 rounded-xl">
                  <h4 class="text-xs font-mono uppercase text-slate-400 mb-2">Signal Velocity</h4>
                  <div class="text-4xl font-mono text-gold-400 mb-2">14.2<span class="text-sm text-slate-500 ml-2">days</span></div>
                  <p class="text-[10px] text-slate-500">Avg. time from Signal to Brief Generation</p>
                  <div class="mt-4 h-1 bg-slate-800 rounded w-full"><div class="h-full bg-gold-400 w-[70%]"></div></div>
              </div>
              <div class="glass-panel p-6 rounded-xl">
                  <h4 class="text-xs font-mono uppercase text-slate-400 mb-2">Enrichment Accuracy</h4>
                  <div class="text-4xl font-mono text-emerald-400 mb-2">98.4<span class="text-sm text-slate-500 ml-2">%</span></div>
                  <p class="text-[10px] text-slate-500">Verified contacts vs. Bounces</p>
                  <div class="mt-4 h-1 bg-slate-800 rounded w-full"><div class="h-full bg-emerald-400 w-[98%]"></div></div>
              </div>
              <div class="glass-panel p-6 rounded-xl">
                  <h4 class="text-xs font-mono uppercase text-slate-400 mb-2">Pipeline Conversion</h4>
                  <div class="text-4xl font-mono text-blue-400 mb-2">$4.2M<span class="text-sm text-slate-500 ml-2">influenced</span></div>
                  <p class="text-[10px] text-slate-500">Total pipeline generated Q1 2026</p>
                  <div class="mt-4 h-1 bg-slate-800 rounded w-full"><div class="h-full bg-blue-400 w-[60%]"></div></div>
              </div>
          </div>
          
          <div class="glass-panel p-6 rounded-xl mb-6">
              <h4 class="text-xs font-mono uppercase text-slate-400 mb-4">Live Pipeline Flow</h4>
              <!-- Simple CSS Chart Visualization -->
              <div class="flex items-end gap-2 h-40 border-b border-white/5 pb-2">
                  <div class="flex-1 bg-slate-800 hover:bg-gold-500/50 transition-all rounded-t" style="height: 30%"></div>
                  <div class="flex-1 bg-slate-800 hover:bg-gold-500/50 transition-all rounded-t" style="height: 45%"></div>
                  <div class="flex-1 bg-slate-800 hover:bg-gold-500/50 transition-all rounded-t" style="height: 35%"></div>
                  <div class="flex-1 bg-slate-800 hover:bg-gold-500/50 transition-all rounded-t" style="height: 60%"></div>
                  <div class="flex-1 bg-slate-800 hover:bg-gold-500/50 transition-all rounded-t" style="height: 75%"></div>
                  <div class="flex-1 bg-slate-800 hover:bg-gold-500/50 transition-all rounded-t" style="height: 50%"></div>
                  <div class="flex-1 bg-slate-800 hover:bg-gold-500/50 transition-all rounded-t" style="height: 65%"></div>
                  <div class="flex-1 bg-gold-400 hover:bg-gold-300 transition-all rounded-t relative group" style="height: 85%">
                    <div class="absolute -top-8 left-1/2 -translate-x-1/2 bg-white text-black text-[10px] px-2 py-1 rounded opacity-0 group-hover:opacity-100 whitespace-nowrap">Current Week</div>
                  </div>
                  <div class="flex-1 bg-slate-800 hover:bg-gold-500/50 transition-all rounded-t" style="height: 60%"></div>
                  <div class="flex-1 bg-slate-800 hover:bg-gold-500/50 transition-all rounded-t" style="height: 70%"></div>
              </div>
          </div>
          
           <button onclick="toggleRevenueHealth()" class="px-4 py-2 bg-slate-800 text-white text-xs font-mono rounded border border-white/10 hover:bg-slate-700">Back to Feed</button>
      </div>

      <!-- Feed / Grid -->
      <div class="flex-1 overflow-y-auto px-6 pb-20 scroll-smooth relative z-10" id="feed-container">
        <!-- Loader -->
        <div class="h-full flex flex-col items-center justify-center text-slate-600 gap-4">
          <i class="fa-solid fa-circle-notch fa-spin text-4xl text-gold-400/50"></i>
          <div class="font-mono text-xs tracking-widest uppercase">Initializing Secure Uplink...</div>
        </div>
      </div>

      <!-- Footer Overlay -->
      <div class="absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-t from-obsidian to-transparent pointer-events-none z-20"></div>

      <!-- Nexus Oracle Floating Assistant -->
      <div id="oracle-container" class="fixed bottom-8 right-8 w-96 z-50 transition-all duration-500 transform translate-y-8 opacity-0 pointer-events-none scale-95">
          <div class="glass border border-white/10 rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[500px]">
              <div class="bg-gradient-to-r from-blue-600/30 to-purple-600/30 p-4 border-b border-white/10 flex justify-between items-center">
                  <div class="flex items-center gap-3">
                      <div class="w-2 h-2 rounded-full bg-blue-400 animate-pulse"></div>
                      <span class="text-[10px] font-bold text-white tracking-[0.2em] font-mono">NEXUS::ORACLE</span>
                  </div>
                  <button onclick="toggleOracle()" class="text-slate-400 hover:text-white transition">
                      <i class="fa-solid fa-chevron-down text-sm"></i>
                  </button>
              </div>
              <div id="oracle-messages" class="p-4 overflow-y-auto space-y-4 font-mono text-[10px] text-slate-300 min-h-[250px] bg-slate-950/40">
                  <div class="flex gap-2">
                      <span class="text-blue-400 shrink-0">[SYSTEM]</span>
                      <span>Uplink established. Scanning your 6,336 leads. How shall we orchestrate?</span>
                  </div>
              </div>
              <div class="p-4 border-t border-white/10 bg-slate-900/50">
                  <div class="relative group">
                      <input type="text" id="oracle-input" 
                          class="w-full bg-slate-950/80 border border-slate-800 rounded-lg py-3 px-4 text-[10px] text-white placeholder-slate-600 focus:outline-none focus:border-blue-500/50 font-mono transition-all"
                          placeholder="Ask the Oracle (e.g. 'Outreach plan for Substack')..."
                          onkeyup="handleOracleKey(event)">
                      <button onclick="askOracle()" class="absolute right-3 top-2.5 text-blue-400 hover:text-white transition">
                          <i class="fa-solid fa-paper-plane text-xs"></i>
                      </button>
                  </div>
              </div>
          </div>
      </div>

      <button id="oracle-pill" onclick="toggleOracle()" class="fixed bottom-8 right-8 px-6 py-4 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white rounded-full shadow-[0_0_20px_rgba(37,99,235,0.3)] flex items-center gap-3 z-40 transition-all hover:scale-105 border border-white/20 group">
          <div class="relative">
              <i class="fa-solid fa-ghost text-sm group-hover:animate-bounce"></i>
              <div class="absolute -top-1 -right-1 w-2 h-2 bg-emerald-400 rounded-full border border-obsidian animate-ping"></div>
          </div>
          <span class="font-mono text-xs font-bold tracking-[0.2em]">ORACLE</span>
      </button>

    </main>

    <!-- DETAIL PANEL (Right) -->
    <aside class="w-96 glass-panel border-l border-white/5 hidden xl:flex flex-col p-6 gap-6 shrink-0 z-30">
        <div>
            <h3 class="text-xs font-mono uppercase text-slate-500 mb-4 tracking-widest">Selected Target</h3>
            <div id="detail-view" class="flex flex-col gap-4 text-center items-center justify-center h-40 border-2 border-dashed border-slate-800 rounded-xl relative overflow-hidden group">
                <i class="fa-regular fa-id-card text-3xl text-slate-700 group-hover:scale-110 transition"></i>
                <p class="text-sm text-slate-500">Select a lead to view War Room</p>
            </div>
        </div>

        <div class="flex-1 overflow-hidden flex flex-col">
            <h3 class="text-xs font-mono uppercase text-slate-500 mb-2 tracking-widest flex justify-between items-center">
                Attack Plans
                <span class="text-[9px] bg-slate-800 px-2 py-0.5 rounded text-gold-400 border border-slate-700">AI GENERATED</span>
            </h3>
            
            <!-- Attack Plan Tabs -->
            <div class="flex gap-2 mb-4">
                <button onclick="switchTab('sovereign')" id="tab-sovereign" class="flex-1 py-1.5 text-[10px] uppercase font-bold tracking-wider rounded bg-gold-400 text-obsidian text-center">Sovereign</button>
                <button onclick="switchTab('technical')" id="tab-technical" class="flex-1 py-1.5 text-[10px] uppercase font-bold tracking-wider rounded bg-slate-800 text-slate-400 hover:text-white transition text-center">Tech</button>
                <button onclick="switchTab('roi')" id="tab-roi" class="flex-1 py-1.5 text-[10px] uppercase font-bold tracking-wider rounded bg-slate-800 text-slate-400 hover:text-white transition text-center">ROI</button>
            </div>

            <!-- Pitch Content -->
            <div class="bg-gradient-to-b from-slate-800/30 to-slate-900/30 border border-gold-500/10 rounded-xl p-4 flex-1 relative overflow-y-auto custom-scrollbar">
                
                <div id="content-sovereign" class="pitch-content">
                    <p class="text-sm text-slate-300 italic mb-4 leading-relaxed" id="pitch-preview">
                        "Select a target to generate a sovereign architecture pitch."
                    </p>
                </div>
                
                <div id="content-candidate" class="pitch-content hidden">
                    <p class="text-sm text-slate-300 italic mb-4 leading-relaxed" id="pitch-candidate">
                         "Select a target to generate Candidate Value Prop."
                    </p>
                </div>
                
                <div id="content-technical" class="pitch-content hidden">
                    <p class="text-sm text-slate-300 italic mb-4 leading-relaxed" id="pitch-tech">
                        "Analyzing tech stack for vulnerabilities..."
                    </p>
                </div>

                <div id="content-roi" class="pitch-content hidden">
                    <p class="text-sm text-slate-300 italic mb-4 leading-relaxed" id="pitch-roi">
                         "Calculating cost of inaction..."
                    </p>
                </div>

                <!-- Actions -->
                <div class="flex flex-col gap-2 mt-4">
                    <button onclick="copyPitch()" class="w-full py-2 bg-slate-800 hover:bg-slate-700 text-slate-300 font-medium rounded border border-slate-700 transition text-xs flex items-center justify-center gap-2">
                        <i class="fa-regular fa-copy"></i> Copy to Clipboard
                    </button>
                    <button onclick="exportBrief()" class="w-full py-2 bg-gradient-to-r from-gold-500 to-amber-600 hover:from-gold-400 hover:to-amber-500 text-obsidian font-bold rounded shadow-[0_0_15px_rgba(212,175,55,0.2)] transition text-xs flex items-center justify-center gap-2">
                       <i class="fa-solid fa-file-pdf"></i> Generate Executive Brief
                    </button>
                    <button onclick="searchNews()" class="w-full py-2 bg-slate-800 hover:bg-slate-700 text-blue-400 font-medium rounded border border-slate-700 transition text-xs flex items-center justify-center gap-2">
                       <i class="fa-solid fa-satellite-dish"></i> Signal Decryption (News)
                    </button>
                </div>

            </div>
        </div>
    </aside>

  </div>

  <!-- PRINT TEMPLATE (HIDDEN) -->
  <div id="print-brief-template">
    <div class="brief-tag">GTM Signal Intelligence // Basin::Nexus</div>
    <div class="brief-title">EXECUTIVE GTM SIGNAL BRIEF</div>
    
    <div class="brief-meta">
        <div class="meta-block">
            <h5>Strategic Target</h5>
            <p id="pb-name"></p>
            <p id="pb-title" style="font-size: 11px; color: #555;"></p>
        </div>
        <div class="meta-block">
            <h5>Organization</h5>
            <p id="pb-company"></p>
        </div>
        <div class="meta-block">
            <h5>Signal Strength</h5>
            <p id="pb-score" style="font-weight: 900; font-size: 24px;"></p>
        </div>
        <div class="meta-block">
            <h5>Date of Issue</h5>
            <p id="pb-date"></p>
        </div>
    </div>

    <div class="intel-section">
        <div class="intel-header">Core Revenue Hypothesis (Sovereign)</div>
        <div class="intel-body" id="pb-sov"></div>
    </div>

    <div class="intel-section">
        <div class="intel-header">Technical Infrastructure Signal</div>
        <div class="intel-body" id="pb-tech"></div>
    </div>

    <div class="risk-block">
        <div class="intel-header" style="color: #c00;">Risk of Inaction</div>
        <div class="intel-body" id="pb-roi"></div>
    </div>

    <div class="decision-footer">
        <span>CONFIDENTIAL // AUTHORIZED ACCESS ONLY</span>
        <span>BASIN::NEXUS REVENUE ARCHITECTURE v6.2</span>
    </div>
  </div>

  <script>
    window.rawData = [];
    let currentLead = null;
    const VERSION = "6.3.0";
    let isClientMode = false;
    let isHunterMode = false;

    function toggleHunterMode() {
        isHunterMode = !isHunterMode;
        const btn = document.getElementById('hunter-btn');
        
        if (isHunterMode) {
            if(btn) {
                btn.classList.remove('opacity-50');
                btn.classList.add('bg-red-900/20', 'border-red-500/50', 'text-red-400');
            }
            
            // Filter Data for Hiring Signals if we had real signal data for that, 
            // for now, we just re-render to trigger visual refresh, 
            // or we could filter by keywords if valid.
            const hiringKeywords = ['Founder', 'CEO', 'Director', 'Head of', 'President', 'VP'];
            const filtered = window.rawData.filter(item => 
                hiringKeywords.some(k => item['Title'] && item['Title'].includes(k)) ||
                (item['GTM Score'] && parseInt(item['GTM Score']) > 85)
            );
            
            renderFeed(filtered);
            updateHeader("Executive Search Grid", `Tracking ${filtered.length} Hiring Decision Makers`);
            
            // alert("丘멆잺 HUNTER MODE ACTIVE\n\nOptimizing for Executive Placement Vectors.\nTargeting: Founders, Talent Leaders, Hiring Managers.");
        } else {
            if(btn) {
                btn.classList.add('opacity-50');
                btn.classList.remove('bg-red-900/20', 'border-red-500/50', 'text-red-400');
            }
            resetFilters();
        }
    }

    // FALLBACK DATA (For Offline/Demo Stability)

    // FALLBACK DATA (For Offline/Demo Stability)
    const MOCK_DATA = [
      {"Full Name": "SecureMC Leadership", "Company": "SecureMC Global", "Title": "Expansion Team", "GTM Score": "99", "Tech Stack": "Global BPO, Real Estate", "Source": "Strategic Inbound", "Industry": "Intl. Operations", "Nexus Pitch": "SecureMC requires a sovereign US landing zone. Basin::Nexus provides the architectural bridge for high-velocity client acquisition."},
      {"Full Name": "Jassi Singh", "Company": "TalSmart", "Title": "Founder & CEO", "GTM Score": "96", "Tech Stack": "HubSpot, LinkedIn Sales Nav", "Source": "Active Deal", "Industry": "Sales Intelligence", "Nexus Pitch": "TalSmart's outbound motion is currently manual. Basin::Nexus Sovereign Agents can automate 80% of top-of-funnel validation."},
      {"Full Name": "Daniel Bell", "Company": "Bell Tower", "Title": "Managing Partner", "GTM Score": "92", "Tech Stack": "ConnectWise, Azure Sentinel", "Source": "Strategic Partner", "Industry": "Cybersecurity / MSP", "Nexus Pitch": "Bell Tower has strong defense, but weak offense. A sovereign signal engine will allow you to capture market share before competitors even see the RFPs."},
      {"Full Name": "Katia Annad", "Company": "Bell Tower", "Title": "Sysadmin & Cloud Sec", "GTM Score": "88", "Tech Stack": "Linux, Azure, AWS", "Source": "Strategic Partner", "Industry": "Cybersecurity", "Nexus Pitch": "Your infrastructure is solid. Now let's apply that same rigor to your revenue stack using sovereign AI models."},
      {"Full Name": "Sarah Connor", "Company": "CyberDyne Systems", "Title": "COO", "GTM Score": "85", "Tech Stack": "Salesforce, Oracle", "Source": "Market Pulse", "Industry": "Defense Tech", "Nexus Pitch": ""},
      {"Full Name": "Alex Chen", "Company": "Neural Linkage", "Title": "VP Engineering", "GTM Score": "78", "Tech Stack": "React, Python, AWS", "Source": "Inbound", "Industry": "AI Software", "Nexus Pitch": ""},
      {"Full Name": "Marcus Aurelius", "Company": "Roman Empire Holdings", "Title": "CEO", "GTM Score": "99", "Tech Stack": "Papyrus, Stone Tablets", "Source": "Founder List", "Industry": "Global Governance", "Nexus Pitch": "Empire requires order. Sovereign Revenue Architecture provides the logistics for expansion."},
      {"Full Name": "Elena Fisher", "Company": "Uncharted Net", "Title": "Explorer", "GTM Score": "65", "Tech Stack": "Google Maps, Satellite", "Source": "Cold", "Industry": "Logistics", "Nexus Pitch": ""}
    ];

    function initDashboard() {
        console.log("Initializing Basin::Nexus V" + VERSION);
        runRefinerySequence(true); // Initial load sequence
    }

    function runRefinerySequence(isInit = false) {
        const overlay = document.getElementById('refinery-overlay');
        const progressBar = document.getElementById('refinery-bar');
        const stageText = document.getElementById('refinery-stage');
        const percentText = document.getElementById('refinery-percent');
        const logBox = document.getElementById('refinery-log');
        
        overlay.style.display = 'flex';
        progressBar.style.width = '0%';
        logBox.innerHTML = '';
        
        const logs = [
            "Initializing Secure Uplink...",
            "Handshaking with Basin::Refinery...",
            "Decrypting Signal Stream...",
            "Ingesting 12,400 raw nodes...",
            "Applying GTM Scoring Algorithms...",
            "Enriching Company Firmographics...",
            "Validating Contact Vectors...",
            "Optimizing Local Cache...",
            "SYNC COMPLETE."
        ];

        let step = 0;
        const totalSteps = logs.length;
        
        const interval = setInterval(() => {
            if (step >= totalSteps) {
                clearInterval(interval);
                setTimeout(() => {
                    overlay.style.display = 'none';
                    if (isInit) loadData(); // Load data after animation
                }, 500);
                return;
            }
            
            // Update UI
            const percent = Math.round(((step + 1) / totalSteps) * 100);
            progressBar.style.width = percent + '%';
            percentText.innerText = percent + '%';
            stageText.innerText = logs[step];
            
            const logEntry = document.createElement('div');
            logEntry.className = "text-emerald-500/80 mb-1";
            logEntry.innerText = `> ${new Date().toLocaleTimeString()} :: ${logs[step]}`;
            logBox.appendChild(logEntry);
            logBox.scrollTop = logBox.scrollHeight;
            
            step++;
        }, 150); // Speed of animation
    }

    function loadData() {
        const statusEl = document.getElementById('stat-total-leads');
        // statusEl.innerText = "Syncing..."; // Removed to keep numbers stable after anim
        
        const csvUrl = 'leads.csv?v=' + Date.now();
        
        Papa.parse(csvUrl, {
            download: true,
            header: true,
            skipEmptyLines: true,
            complete: function(results) {
                // Happy Path
                window.rawData = results.data.filter(r => r['Full Name'] || r['Company']);
                processData();
            },
            error: function(err) {
                console.warn("CSV Load Failed. Using Sovereign Mock Data.", err);
                window.rawData = MOCK_DATA;
                processData();
            }
        });
    }

    function processData() {
         // Identify Substack Segment
        window.rawData.forEach(r => {
            if (r['Company'] === 'Substack Subscriber' || r['Company'] === 'Newsletter Subscriber') {
                r.isSubstack = true;
                r.channel = 'Email/Content';
            } else {
                r.channel = 'LinkedIn/Direct';
            }
        });

        console.log("Data Active:", window.rawData.length);
        updateStats();
        renderFeed(window.rawData);
        setupSearch();
    }

    function updateStats() {
        const totalLeads = window.rawData.length;
        const uniqueCompanies = new Set(window.rawData.map(r => r['Company']).filter(c => c)).size;
        const highPriority = window.rawData.filter(r => (parseInt(r['GTM Score']) || 0) >= 80).length;
        
        // Update UI Stats with animation
        animateValue("stat-total-leads", 0, totalLeads, 1000);
        animateValue("stat-total-companies", 0, uniqueCompanies, 1000);
        animateValue("stat-high-priority", 0, highPriority, 1000);
    }

    function animateValue(id, start, end, duration) {
        const obj = document.getElementById(id);
        if (!obj) return;
        let startTimestamp = null;
        const step = (timestamp) => {
            if (!startTimestamp) startTimestamp = timestamp;
            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
            obj.innerText = Math.floor(progress * (end - start) + start).toLocaleString();
            if (progress < 1) {
                window.requestAnimationFrame(step);
            }
        };
        window.requestAnimationFrame(step);
    }

    function setupSearch() {
        // Clear old listeners by replacing element (simple hack)
        const oldInput = document.getElementById('searchInput');
        const newInput = oldInput.cloneNode(true);
        oldInput.parentNode.replaceChild(newInput, oldInput);

        newInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            const filtered = window.rawData.filter(item => 
                (item['Full Name'] && item['Full Name'].toLowerCase().includes(term)) ||
                (item['Company'] && item['Company'].toLowerCase().includes(term)) ||
                (item['Tech Stack'] && item['Tech Stack'].toLowerCase().includes(term)) ||
                (item['Title'] && item['Title'].toLowerCase().includes(term))
            );
            renderFeed(filtered);
        });
    }

    function filterByTech(tech) {
        const searchInput = document.getElementById('searchInput');
        searchInput.value = tech;
        const event = new Event('input');
        searchInput.dispatchEvent(event);
        updateHeader(`Stack: ${tech}`, `${window.rawData.filter(r => r['Tech Stack'] && r['Tech Stack'].toLowerCase().includes(tech)).length} signals identified`);
    }

    function filterBySource(sourceStr) {
        document.getElementById('searchInput').value = "";
        const filtered = window.rawData.filter(item => 
            item['Source'] && item['Source'].includes(sourceStr)
        );
        renderFeed(filtered);
        updateHeader("Strategic Command", sourceStr + " Segments Active");
    }

    function resetFilters() {
        document.getElementById('searchInput').value = "";
        renderFeed(window.rawData);
        updateHeader("Sovereign Signal Feed", "Real-time enrichment from Basin::Refinery");
    }

    function updateHeader(title, subtitle) {
        document.getElementById('page-title').innerText = title;
        document.getElementById('page-subtitle').innerText = subtitle;
    }

    function renderFeed(data) {
        const container = document.getElementById('feed-container');
        if(data.length === 0) {
            container.innerHTML = `
                <div class="h-full flex flex-col items-center justify-center opacity-30 gap-4 mt-20">
                    <i class="fa-solid fa-ghost text-6xl"></i>
                    <div class="font-mono text-sm uppercase">No signals intercepted.</div>
                </div>`;
            return;
        }

        let html = '<div class="grid grid-cols-1 md:grid-cols-2 2xl:grid-cols-3 gap-4 pt-6">';
        
        data.forEach((lead, index) => {
            const actualIndex = window.rawData.indexOf(lead); // Use index from master list
            const score = parseInt(lead['GTM Score']) || 10;
            const initials = lead['Full Name'] ? lead['Full Name'].split(' ').map(n => n[0]).join('').slice(0,2) : '?';
            
            // Premium Badging
            const isActiveDeal = lead['Source'] && lead['Source'].includes('Active Deal');
            const isHighPriority = score >= 80;
            
            const cardClasses = `glass-panel rounded-2xl p-5 cursor-pointer transition-all duration-300 group hover:scale-[1.02] border-l-4 ${isActiveDeal ? 'border-l-red-500 shadow-[0_0_20px_rgba(239,68,68,0.1)]' : (isHighPriority ? 'border-l-gold-400 shadow-[0_0_20px_rgba(212,175,55,0.1)]' : 'border-l-slate-800')}`;
            
            html += `
            <div onclick="selectLead(${actualIndex})" role="button" tabindex="0" onkeydown="if(event.key==='Enter') selectLead(${actualIndex})" class="${cardClasses}">
                <div class="flex items-start justify-between mb-4">
                    <div class="h-10 w-10 rounded-xl bg-slate-900 border border-white/5 flex items-center justify-center text-gold-400 font-bold shadow-xl">
                        ${initials}
                    </div>
                    <div class="text-right">
                        <div class="text-[18px] font-black font-mono ${score >= 80 ? 'text-gold-400' : (score >= 50 ? 'text-emerald-400' : 'text-slate-500')}">${score}</div>
                        <div class="text-[8px] uppercase tracking-widest text-slate-600">Signal Strength</div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h4 class="font-bold text-slate-100 truncate group-hover:text-gold-400 transition mb-0.5">${lead['Full Name'] || 'Anonymous Signal'}</h4>
                    <p class="text-[10px] text-slate-500 font-mono uppercase tracking-wider truncate">${lead['Title'] || 'Executive'} @ ${lead['Company']}</p>
                </div>

                <div class="flex flex-wrap gap-1.5 mb-4">
                    ${(lead['Tech Stack'] || '').split(',').slice(0, 3).map(t => t.trim() ? `<span class="px-2 py-0.5 rounded bg-slate-950/50 border border-slate-800 text-[9px] text-slate-400 font-mono">${t}</span>` : '').join('')}
                </div>

                <div class="flex items-center justify-between pt-3 border-t border-white/5 opacity-50 group-hover:opacity-100 transition">
                    <span class="text-[9px] text-slate-600 font-mono uppercase">${lead['Industry'] || 'Unknown Sector'}</span>
                    <i class="fa-solid fa-chevron-right text-[10px] text-gold-400"></i>
                </div>
            </div>
            `;
        });
        
        html += '</div>';
        container.innerHTML = html;
    }

    function selectLead(index) {
        currentLead = window.rawData[index];
        const leadData = currentLead;
        
        // Custom SecureMC War Room View
        if (leadData['Company'] === 'SecureMC Global') {
            const detailHtml = `
                <div class="relative mb-6">
                    <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-gold-600 to-amber-800 border-2 border-gold-400 flex items-center justify-center text-2xl font-black text-white shadow-[0_0_30px_rgba(212,175,55,0.4)] mx-auto animate-pulse-gold">
                        SMC
                    </div>
                    <div class="absolute -bottom-2 left-1/2 -translate-x-1/2 bg-slate-900 border border-gold-400 px-3 py-1 rounded-full flex items-center gap-2 shadow-xl">
                        <div class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></div>
                        <span class="text-[9px] font-bold text-gold-400 uppercase tracking-widest whitespace-nowrap">TARGET LOCKED</span>
                    </div>
                </div>
                
                <div class="text-center px-4 space-y-4">
                    <div>
                        <h2 class="text-xl font-black text-white leading-none uppercase tracking-tighter">SECUREMC GLOBAL</h2>
                        <div class="text-[10px] text-emerald-400 font-mono uppercase tracking-[0.2em] mt-1">US Expansion Node</div>
                    </div>
                    
                    <div class="p-3 bg-red-900/10 border border-red-500/20 rounded-lg">
                        <div class="text-[9px] text-red-400 uppercase font-bold tracking-widest mb-1">Current Friction</div>
                        <div class="text-xs text-slate-300 italic">"Trust Gap & Timezone Latency"</div>
                    </div>

                    <div class="p-3 bg-emerald-900/10 border border-emerald-500/20 rounded-lg">
                        <div class="text-[9px] text-emerald-400 uppercase font-bold tracking-widest mb-1">Sovereign Solution</div>
                        <div class="text-xs text-slate-300 italic">"US Landing Zone Architecture"</div>
                    </div>
                    
                    <button onclick="window.open('securemc-brief.html', '_blank')" class="w-full py-3 bg-gold-500 hover:bg-gold-400 text-obsidian font-bold rounded shadow-[0_0_20px_rgba(212,175,55,0.3)] transition text-xs flex items-center justify-center gap-2 group">
                        <i class="fa-solid fa-file-shield group-hover:scale-110 transition"></i> OPEN MISSION BRIEF
                    </button>
                    
                    <button onclick="window.open('securemc-framework.html', '_blank')" class="w-full py-3 bg-slate-800 hover:bg-slate-700 text-white font-bold rounded border border-white/10 transition text-xs flex items-center justify-center gap-2">
                        <i class="fa-solid fa-handshake"></i> VIEW PARTNERSHIP TERMS
                    </button>
                </div>
            `;
            document.getElementById('detail-view').innerHTML = detailHtml;
            // Update Pitches for Logic Consistency
            updatePitches(leadData);
            return;
        }

        const detailHtml = `
            <div class="relative mb-4">
                <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-slate-800 to-slate-950 border border-gold-400/20 flex items-center justify-center text-2xl font-black text-gold-400 shadow-2xl mx-auto rotate-3 group-hover:rotate-0 transition-transform">
                    ${leadData['Full Name'] ? leadData['Full Name'].charAt(0) : '?'}
                </div>
                <div class="absolute -bottom-1 -right-1 h-6 w-6 rounded-lg bg-emerald-500 border-2 border-obsidian flex items-center justify-center shadow-lg">
                    <i class="fa-solid fa-bolt text-[10px] text-white"></i>
                </div>
            </div>
            <div class="text-center px-4">
                <h2 class="text-lg font-black text-white leading-tight mb-1 uppercase tracking-tighter">${leadData['Full Name']}</h2>
                <div class="text-[10px] text-gold-500 font-mono uppercase mb-4 tracking-widest">${leadData['Company']}</div>
                
                <div class="grid grid-cols-2 gap-3 w-full text-xs">
                    <div class="bg-slate-900/50 p-3 rounded-xl border border-white/5 text-left">
                        <div class="text-slate-600 uppercase text-[8px] font-black tracking-widest mb-1">Position</div>
                        <div class="font-medium text-slate-300 truncate text-[11px]">${leadData['Title'] || 'Executive'}</div>
                    </div>
                    <div class="bg-slate-900/50 p-3 rounded-xl border border-white/5 text-left">
                        <div class="text-slate-600 uppercase text-[8px] font-black tracking-widest mb-1">Primary Stack</div>
                        <div class="font-medium text-slate-300 truncate text-[11px]">${(leadData['Tech Stack'] || 'Legacy').split(',')[0]}</div>
                    </div>
                </div>
            </div>
        `;
        document.getElementById('detail-view').innerHTML = detailHtml;
        
        updatePitches(leadData);
    }

    function updatePitches(leadData) {
        document.getElementById('detail-view').className = "flex flex-col items-center bg-slate-900/40 border border-slate-800 p-6 rounded-2xl shadow-xl";
        
        // Populate Pitches
        const firstName = leadData['Full Name'] ? leadData['Full Name'].split(' ')[0] : 'Leader';
        const company = leadData['Company'] || 'the organization';
        
        const sovPitch = leadData['Nexus Pitch'] && leadData['Nexus Pitch'].length > 20 
            ? leadData['Nexus Pitch'] 
            : `游분 ${firstName}, managing revenue at ${company} requires sovereign infrastructure. My framework operationalizes your data so you own the intelligence layer, not rent it.`;
            
        const techPitch = `游분 ${firstName}, I see you're running ${leadData['Tech Stack'] || 'legacy systems'}. Basin::Nexus deploys a local reasoning layer that bypasses API latency and secures your GTM data inside your own VPC.`;
        
    const roiPitch = `游분 ${firstName}, ${company} is likely leaking 20% of pipeline to signal noise. By moving to a sovereign agent architecture, we can cut CAC by 40% in Q1.`;

    document.getElementById('pitch-preview').innerText = sovPitch;
    document.getElementById('pitch-tech').innerText = techPitch;
    document.getElementById('pitch-roi').innerText = roiPitch;
    
    // Hunter Mode Logic
    const candidatePitch = `游분 ${firstName}, I'm vetting leadership roles where I can deploy this Sovereign GTM architecture. ${company} fits the profile for high-velocity signal enrichment. Are you open to a brief demo of the engine?`;
    document.getElementById('pitch-candidate').innerText = candidatePitch;

    if (isHunterMode) {
         document.getElementById('content-sovereign').classList.add('hidden');
         document.getElementById('content-technical').classList.add('hidden');
         document.getElementById('content-roi').classList.add('hidden');
         
         document.getElementById('content-candidate').classList.remove('hidden');
         
         document.getElementById('tab-sovereign').innerText = "INTRO";
         document.getElementById('tab-technical').innerText = "VALUE";
         document.getElementById('tab-roi').innerText = "ASK";
    } else {
         document.getElementById('content-candidate').classList.add('hidden');
         
         document.getElementById('tab-sovereign').innerText = "SOVEREIGN";
         document.getElementById('tab-technical').innerText = "TECH";
         document.getElementById('tab-roi').innerText = "ROI";
         switchTab('sovereign');
    }
}
    
    function switchTab(tab) {
        ['sovereign', 'technical', 'roi'].forEach(t => {
            document.getElementById(`content-${t}`).classList.add('hidden');
            const btn = document.getElementById(`tab-${t}`);
            btn.classList.remove('bg-gold-400', 'text-obsidian', 'shadow-[0_0_15px_rgba(212,175,55,0.3)]');
            btn.classList.add('bg-slate-800', 'text-slate-500');
        });
        
        document.getElementById(`content-${tab}`).classList.remove('hidden');
        const activeBtn = document.getElementById(`tab-${tab}`);
        activeBtn.classList.remove('bg-slate-800', 'text-slate-500');
        activeBtn.classList.add('bg-gold-400', 'text-obsidian', 'shadow-[0_0_15px_rgba(212,175,55,0.3)]');
    }
    
    function copyPitch() {
        const activeContent = document.querySelector('.pitch-content:not(.hidden) p');
        if (!activeContent) return;
        navigator.clipboard.writeText(activeContent.innerText).then(() => {
            alert('Strategic attack plan cloned to clipboard.');
        });
    }
    
    function searchNews() {
        if(!currentLead) return;
        const query = encodeURIComponent(`${currentLead['Company']} GTM strategy news 2026`);
        window.open(`https://www.google.com/search?q=${query}`, '_blank');
    }

    function exportBrief() {
        if (!currentLead) {
            alert("Select a target to generate a brief.");
            return;
        }

        // Populate Print Template
        document.getElementById('pb-name').innerText = currentLead['Full Name'];
        document.getElementById('pb-title').innerText = currentLead['Title'] || 'Executive';
        document.getElementById('pb-company').innerText = currentLead['Company'];
        document.getElementById('pb-score').innerText = currentLead['GTM Score'] || '00';
        document.getElementById('pb-date').innerText = new Date().toLocaleDateString('en-US', { 
            year: 'numeric', month: 'long', day: 'numeric' 
        });

        document.getElementById('pb-sov').innerText = document.getElementById('pitch-preview').innerText;
        document.getElementById('pb-tech').innerText = document.getElementById('pitch-tech').innerText;
        document.getElementById('pb-roi').innerText = document.getElementById('pitch-roi').innerText;

        // Trigger native print logic
        window.print();
    }
    
    // UI Features
    function toggleRevenueHealth() {
        const healthView = document.getElementById('revenue-health-view');
        healthView.classList.toggle('hidden');
    }

    function toggleClientMode() {
        isClientMode = !isClientMode;
        const title = document.getElementById('app-title');
        const subtitle = document.getElementById('app-subtitle');
        const logoBox = document.getElementById('logo-box');
        
        if (isClientMode) {
            // Client Mode (White Label Style)
            title.innerHTML = "BELL<span class='text-blue-500'>::</span>TOWER";
            title.classList.remove('text-slate-100');
            title.classList.add('text-blue-100');
            
            subtitle.innerText = "Managed Defense Protocol";
            
            logoBox.className = "cursor-pointer h-8 w-8 bg-gradient-to-br from-blue-500 to-slate-800 rounded-sm flex items-center justify-center shadow-[0_0_15px_rgba(59,130,246,0.5)] hover:scale-110 transition";
            
            // Just for fun, change some accent colors via JS style injection if we wanted, 
            // but this is enough to show the "White Label" concept.
            alert("Accessing Partner Workspace: Bell Tower");
        } else {
            // Basin Mode
            title.innerHTML = "BASIN<span class='text-gold-400'>::</span>NEXUS";
            title.classList.remove('text-blue-100');
            title.classList.add('text-slate-100');
            
            subtitle.innerText = "Sovereign Revenue Architecture";
            
            logoBox.className = "cursor-pointer h-8 w-8 bg-gradient-to-br from-gold-400 to-amber-700 rounded-sm flex items-center justify-center shadow-[0_0_15px_rgba(212,175,55,0.3)] hover:scale-110 transition";
        }
    }

    // --- NEXUS ORACLE INTELLIGENCE ---
    function toggleOracle() {
        const container = document.getElementById('oracle-container');
        const pill = document.getElementById('oracle-pill');
        const isOpen = !container.classList.contains('opacity-0');
        
        if (isOpen) {
            container.classList.add('opacity-0', 'translate-y-8', 'pointer-events-none', 'scale-95');
            pill.classList.remove('opacity-0');
        } else {
            container.classList.remove('opacity-0', 'translate-y-8', 'pointer-events-none', 'scale-95');
            pill.classList.add('opacity-0');
            document.getElementById('oracle-input').focus();
        }
    }

    function handleOracleKey(e) {
        if (e.key === 'Enter') askOracle();
    }

    function appendOracleMessage(sender, text) {
        const msgDiv = document.getElementById('oracle-messages');
        const color = sender === 'Oracle' ? 'text-blue-400' : 'text-emerald-400';
        const label = sender === 'Oracle' ? '[ORACLE]' : '[BASIN]';
        
        const newMsg = document.createElement('div');
        newMsg.className = 'flex gap-2 mb-2 animate-in fade-in slide-in-from-left-2 duration-300';
        newMsg.innerHTML = `<span class="${color} shrink-0">${label}</span><span>${text}</span>`;
        msgDiv.appendChild(newMsg);
        msgDiv.scrollTop = msgDiv.scrollHeight;
    }

    function askOracle() {
        const input = document.getElementById('oracle-input');
        const query = input.value.trim().toLowerCase();
        if (!query) return;

        appendOracleMessage('Basin', input.value);
        input.value = '';

        // Simple reasoning loop (simulated)
        setTimeout(() => {
            let response = "";
            if (query.includes('plan') || query.includes('substack')) {
                const substackCount = window.rawData.filter(r => r.isSubstack).length;
                response = `Orchestrating Substack Strategy: I recommend a 3-part 'Dark Social' sequence. 1. LinkedIn Connection (Insight-led), 2. Email (Proof of Work), 3. Substack comment interaction. Target: ${substackCount} active signals.`;
            } else if (query.includes('who') || query.includes('email')) {
                const high = window.rawData.filter(r => (parseInt(r['GTM Score']) || 0) >= 90)[0];
                response = `Top priority detected: ${high ? high['Full Name'] + ' @ ' + high['Company'] : 'No 90+ score signals'}. They have the highest GTM alignment. Deploy 'Sovereign Architecture' pitch.`;
            } else if (query.includes('job') || query.includes('hire') || query.includes('career') || query.includes('interview')) {
                 response = "Hunter Protocol Logic: 1. Identify Hiring Manager (Founder/VP). 2. Send 'Sovereign Value' pitch (not a resume). 3. Offer a 'Working Audit' instead of an interview. Probability of success: 85%.";
            } else if (query.includes('bell') || query.includes('katia') || query.includes('daniel')) {
                 response = "Bell Tower Strategy: They value SECURITY and OPS. Do not pitch 'sales'. Pitch 'Revenue Resilience'. Use the 'Managed Defense Protocol' language from the framework.";
            } else {
                response = "Command received. Analyzing dataset for strategic patterns. Try asking for an 'outreach plan', 'hiring targets', or specific deal intel.";
            }
            appendOracleMessage('Oracle', response);
        }, 800);
    }

    // Start
    document.addEventListener('DOMContentLoaded', initDashboard);
  </script>
</body>
</html>
