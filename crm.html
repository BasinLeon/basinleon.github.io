<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BASIN::NEXUS // REVENUE COMMAND CENTER</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
    :root {
        --bg: #030308; --surface: rgba(13,15,25,0.7); --border: rgba(255,255,255,0.08);
        --accent: #818cf8; --accent-glow: rgba(129,140,248,0.25);
        --cyan: #22d3ee; --cyan-glow: rgba(34,211,238,0.25);
        --gold: #fbbf24; --green: #34d399; --red: #f87171; --pink: #f472b6;
        --text-primary: #f8fafc; --text-secondary: #94a3b8;
        --glass-blur: blur(28px);
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    html, body { height:100vh; overflow:hidden; background-color:var(--bg); color:var(--text-primary); font-family:'Inter',sans-serif;
        background-image: radial-gradient(circle at 10% 10%,rgba(129,140,248,.1) 0%,transparent 45%), radial-gradient(circle at 90% 10%,rgba(34,211,238,.07) 0%,transparent 45%), radial-gradient(circle at 50% 90%,rgba(251,191,36,.04) 0%,transparent 50%); }

    .app-window { display:grid; grid-template-columns:280px 1fr; grid-template-rows:64px 1fr 28px; height:100vh; }

    /* â”€â”€ SIDEBAR â”€â”€ */
    .workspace-sidebar { grid-row:1/4; grid-column:1; border-right:1px solid var(--border); display:flex; flex-direction:column; padding:28px 20px; background:rgba(4,4,10,.97); z-index:50; overflow-y:auto; }
    .logo { font-family:'Outfit'; font-weight:900; font-size:1.3rem; color:#fff; display:flex; align-items:center; gap:12px; margin-bottom:40px; }
    .logo-icon { width:26px; height:26px; background:linear-gradient(135deg,var(--accent),var(--cyan)); border-radius:7px; box-shadow:0 0 14px var(--accent-glow); flex-shrink:0; }
    .sidebar-label { font-size:.58rem; color:var(--text-secondary); letter-spacing:2.5px; text-transform:uppercase; font-weight:950; opacity:.4; margin-bottom:12px; margin-top:28px; border-bottom:1px solid rgba(255,255,255,0.03); padding-bottom:4px; transition: .2s; }
    .sidebar-label:hover { opacity:.8; color:var(--accent); }
    .nav-item { padding:11px 16px; border-radius:11px; color:var(--text-secondary); font-size:.82rem; display:flex; gap:12px; align-items:center; cursor:pointer; transition:.2s; margin-bottom:4px; justify-content:space-between; }
    .nav-item:hover { background:rgba(255,255,255,.05); color:#fff; }
    .nav-item.active { background:rgba(129,140,248,.12); color:#fff; border-left:3px solid var(--accent); }
    .nav-left { display:flex; gap:12px; align-items:center; }
    .badge { background:var(--accent); color:#fff; font-size:.55rem; padding:2px 7px; border-radius:7px; font-weight:900; }
    .badge-green { background:var(--green); color:#000; }
    .badge-gold { background:var(--gold); color:#000; }
    .protocol-box { background:rgba(248,113,113,.06); border:1px solid rgba(248,113,113,.2); padding:14px; border-radius:12px; margin-top:auto; margin-bottom:16px; }
    .protocol-title { font-size:.58rem; color:var(--red); font-weight:950; text-transform:uppercase; letter-spacing:1px; margin-bottom:6px; }
    .protocol-body { font-size:.72rem; color:rgba(255,255,255,.65); line-height:1.5; }
    .sys-status { font-family:'JetBrains Mono'; font-size:.62rem; color:var(--green); display:flex; align-items:center; gap:8px; }
    .pulse { animation:pulse 1.5s infinite; filter:drop-shadow(0 0 4px var(--green)); }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.4} }

    /* â”€â”€ HEADER â”€â”€ */
    .workspace-header { grid-row:1; grid-column:2; padding:0 36px; display:flex; align-items:center; gap:16px; border-bottom:1px solid var(--border); background:rgba(3,3,8,.9); backdrop-filter:blur(20px); z-index:40; }
    .search-wrap { flex:1; max-width:420px; display:flex; align-items:center; gap:10px; }
    .search-bar { flex:1; background:rgba(0,0,0,.35); border:1px solid var(--border); color:#fff; padding:9px 16px; border-radius:9px; font-family:'JetBrains Mono'; font-size:.78rem; outline:none; transition:.3s; }
    .search-bar:focus { border-color:var(--accent); box-shadow:0 0 18px var(--accent-glow); }
    .vector-pill { display:flex; align-items:center; gap:7px; padding:5px 11px; border-radius:100px; background:rgba(255,255,255,.03); border:1px solid var(--border); cursor:pointer; transition:.3s; font-family:'JetBrains Mono'; font-size:.58rem; font-weight:900; color:var(--text-secondary); white-space:nowrap; }
    .vector-pill.active { background:rgba(52,211,153,.1); border-color:var(--green); color:var(--green); box-shadow:0 0 12px rgba(52,211,153,.2); }
    .vector-pill .dot { width:5px; height:5px; border-radius:50%; background:currentColor; }
    .tel-group { display:flex; gap:12px; align-items:center; }
    .tel-pill { padding:7px 13px; border-radius:9px; background:rgba(15,18,26,.6); border:1px solid var(--border); display:flex; flex-direction:column; min-width:120px; }
    .tel-label { font-size:.48rem; font-weight:900; letter-spacing:1.5px; color:var(--text-secondary); text-transform:uppercase; }
    .tel-val { font-size:.82rem; font-weight:800; font-family:'Outfit'; color:#fff; }
    .hud-btn { background:rgba(34,211,238,.06); border:1px solid var(--cyan); color:var(--cyan); padding:9px 15px; border-radius:9px; font-family:'JetBrains Mono'; font-size:.62rem; cursor:pointer; transition:.2s; font-weight:700; white-space:nowrap; }
    .hud-btn:hover { background:var(--cyan); color:#000; }
    .hud-btn.velocity { background:rgba(251,191,36,.08); border-color:var(--gold); color:var(--gold); }
    .hud-btn.velocity:hover { background:var(--gold); color:#000; }
    .clock-block { text-align:right; font-family:'JetBrains Mono'; font-size:.58rem; color:var(--text-secondary); line-height:1.4; min-width:130px; border-left:1px solid var(--border); padding-left:14px; }

    /* â”€â”€ MAIN PANELS â”€â”€ */
    .workspace-main { grid-row:1/3; grid-column:2; display:flex; flex-direction:column; overflow:hidden; }
    .decision-strip { display:grid; grid-template-columns:1fr 1fr 1fr; gap:14px; padding:14px 36px; background:rgba(0,0,0,.2); border-bottom:1px solid var(--border); }
    .decision-node { padding:11px 18px; border-radius:12px; background:rgba(15,18,26,.6); border:1px solid var(--border); font-size:.72rem; display:flex; align-items:center; gap:14px; transition:.3s; cursor:pointer; }
    .decision-node:hover { border-color:var(--accent); transform:translateY(-2px); }
    .d-label { font-weight:900; font-family:'Outfit'; letter-spacing:2px; font-size:.58rem; text-transform:uppercase; }
    .d-val { color:#fff; font-weight:700; font-size:.78rem; margin-top:2px; }
    .panel { flex:1; overflow:hidden; display:none; flex-direction:column; }
    .panel.active { display:flex; }

    /* â”€â”€ OPS VAULT â”€â”€ */
    #opsPanel { padding:20px 36px; }
    .ops-toolbar { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; gap:16px; flex-wrap:wrap; }
    .ops-actions { display:flex; gap:10px; }
    .ops-meta { font-family:'JetBrains Mono'; font-size:.72rem; color:var(--text-secondary); display:flex; align-items:center; gap:20px; }
    #vectorBadge { color:var(--green); font-weight:900; display:none; }
    .lead-row { display:grid; grid-template-columns:130px 2.5fr 110px 2fr 150px 150px 70px; gap:18px; align-items:center; padding:12px 22px; background:rgba(15,18,26,.4); border:1px solid var(--border); border-radius:11px; margin-bottom:7px; font-size:.8rem; transition:.2s; backdrop-filter:blur(10px); cursor:pointer; }
    .lead-row:hover { background:rgba(255,255,255,.06); border-color:var(--accent); transform:translateX(4px); }
    .lead-row > div { white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .pii { transition:filter .35s; }
    .privacy-mode .pii { filter:blur(7px); user-select:none; pointer-events:none; }
    #nodesViewport { flex:1; overflow-y:auto; overflow-x:hidden; }
    #nodesMount { width:100%; }
    .status-pill { padding:3px 9px; border-radius:5px; font-size:.58rem; font-weight:950; font-family:'Outfit'; text-transform:uppercase; }
    .pill-now { background:rgba(52,211,153,.1); color:var(--green); border:1px solid var(--green); }
    .pill-next { background:rgba(251,191,36,.1); color:var(--gold); border:1px solid var(--gold); }
    .pill-stuck { background:rgba(248,113,113,.1); color:var(--red); border:1px solid var(--red); }

    /* â”€â”€ VELOCITY FLOW â”€â”€ */
    #velocityPanel { padding:20px 36px; overflow-y:auto; gap:20px; }
    .vel-section { margin-bottom:24px; }
    .vel-title { font-family:'Outfit'; font-size:.7rem; font-weight:900; text-transform:uppercase; letter-spacing:3px; color:var(--text-secondary); opacity:.6; margin-bottom:14px; }
    /* Daily cadence */
    .cadence-card { background:rgba(251,191,36,.06); border:1px solid rgba(251,191,36,.2); border-radius:14px; padding:18px 22px; }
    .cadence-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:14px; }
    .cadence-title { font-family:'Outfit'; font-weight:900; font-size:1rem; color:var(--gold); }
    .cadence-items { display:flex; flex-direction:column; gap:10px; }
    .cadence-item { display:flex; align-items:center; gap:14px; padding:12px 16px; background:rgba(0,0,0,.3); border-radius:10px; border:1px solid rgba(255,255,255,.06); cursor:pointer; transition:.2s; }
    .cadence-item:hover { border-color:var(--gold); background:rgba(251,191,36,.06); }
    .cadence-pri { font-size:.6rem; font-weight:900; font-family:'Outfit'; text-transform:uppercase; padding:2px 8px; border-radius:5px; }
    .pri-hot { background:rgba(248,113,113,.15); color:var(--red); border:1px solid var(--red); }
    .pri-warm { background:rgba(251,191,36,.15); color:var(--gold); border:1px solid var(--gold); }
    .pri-cold { background:rgba(148,163,184,.1); color:var(--text-secondary); border:1px solid var(--border); }
    .cadence-name { font-weight:700; color:#fff; flex:1; }
    .cadence-action { font-size:.72rem; color:var(--text-secondary); }
    .cadence-prob { font-family:'Outfit'; font-weight:900; font-size:.9rem; }
    /* Kanban */
    .kanban { display:grid; grid-template-columns:repeat(5,1fr); gap:12px; }
    .kanban-col { background:rgba(15,18,26,.4); border:1px solid var(--border); border-radius:12px; padding:14px; min-height:200px; }
    .kanban-stage { font-size:.6rem; font-weight:900; letter-spacing:2px; text-transform:uppercase; margin-bottom:12px; }
    .kanban-card { background:rgba(255,255,255,.04); border:1px solid var(--border); border-radius:9px; padding:10px 12px; margin-bottom:8px; cursor:pointer; transition:.2s; }
    .kanban-card:hover { border-color:var(--accent); background:rgba(129,140,248,.08); }
    .kanban-card-name { font-size:.78rem; font-weight:700; color:#fff; }
    .kanban-card-co { font-size:.65rem; color:var(--text-secondary); margin-top:2px; }
    .kanban-card-score { font-size:.6rem; font-family:'JetBrains Mono'; margin-top:6px; }
    .kanban-empty { font-size:.65rem; color:var(--text-secondary); opacity:.4; text-align:center; padding-top:20px; }
    /* Interview radar */
    .radar-grid { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    .radar-card { background:rgba(129,140,248,.06); border:1px solid rgba(129,140,248,.2); border-radius:12px; padding:16px; cursor:pointer; transition:.2s; }
    .radar-card:hover { border-color:var(--accent); transform:translateY(-2px); box-shadow:0 8px 24px rgba(0,0,0,.3); }
    .radar-company { font-family:'Outfit'; font-weight:900; font-size:1rem; color:#fff; }
    .radar-role { font-size:.72rem; color:var(--text-secondary); margin-top:3px; }
    .radar-score { font-family:'JetBrains Mono'; font-size:.65rem; color:var(--green); margin-top:10px; }
    .radar-questions { margin-top:12px; display:none; }
    .radar-card.expanded .radar-questions { display:block; }
    .radar-q { font-size:.72rem; color:rgba(255,255,255,.8); padding:6px 0; border-bottom:1px solid var(--border); line-height:1.5; }
    .radar-q:last-child { border-bottom:none; }

    /* â”€â”€ COMPANY / INDUSTRY / ANALYTICS CARDS â”€â”€ */
    .co-card { background:rgba(15,18,26,.5); border:1px solid var(--border); border-radius:14px; padding:16px 20px; margin-bottom:12px; transition:.2s; cursor:pointer; }
    .co-card:hover { border-color:var(--accent); }
    .co-card-header { display:flex; justify-content:space-between; align-items:center; }
    .co-card-name { font-family:'Outfit'; font-weight:900; font-size:1rem; color:#fff; }
    .co-card-meta { font-size:.68rem; color:var(--text-secondary); margin-top:4px; }
    .co-card-body { display:none; margin-top:14px; border-top:1px solid var(--border); padding-top:12px; }
    .co-card.expanded .co-card-body { display:block; }
    .co-contact { display:flex; align-items:center; justify-content:space-between; padding:5px 0; border-bottom:1px solid rgba(255,255,255,.04); font-size:.72rem; }
    .co-contact:last-child { border-bottom:none; }
    .tag-chip { display:inline-block; padding:2px 8px; border-radius:5px; font-size:.55rem; font-weight:900; font-family:'Outfit'; text-transform:uppercase; margin-right:4px; margin-bottom:4px; background:rgba(129,140,248,.1); border:1px solid rgba(129,140,248,.2); color:var(--accent); }
    .stat-card { background:rgba(15,18,26,.5); border:1px solid var(--border); border-radius:12px; padding:18px; text-align:center; }
    .stat-val { font-family:'Outfit'; font-weight:900; font-size:1.6rem; color:#fff; }
    .stat-label { font-size:.58rem; color:var(--text-secondary); text-transform:uppercase; letter-spacing:1.5px; margin-top:4px; }
    .bar-row { display:flex; align-items:center; gap:10px; margin-bottom:8px; font-size:.72rem; }
    .bar-fill { height:8px; border-radius:4px; background:linear-gradient(90deg,var(--accent),var(--cyan)); transition:width .5s; }
    .bar-label { min-width:120px; color:#fff; font-weight:600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .bar-count { min-width:44px; text-align:right; color:var(--text-secondary); font-family:'JetBrains Mono'; }
    .pipe-stage { display:flex; flex-direction:column; align-items:center; gap:6px; flex:1; }
    .pipe-num { font-family:'Outfit'; font-weight:900; font-size:1.4rem; }
    .pipe-lbl { font-size:.55rem; text-transform:uppercase; letter-spacing:1px; color:var(--text-secondary); }

    /* â”€â”€ MODE TOGGLE â”€â”€ */
    .mode-toggle { display:flex; align-items:center; gap:0; border-radius:10px; overflow:hidden; border:1px solid var(--border); flex-shrink:0; }
    .mode-btn { padding:8px 14px; font-family:'JetBrains Mono'; font-size:.58rem; font-weight:900; cursor:pointer; transition:.25s; border:none; background:transparent; color:var(--text-secondary); text-transform:uppercase; letter-spacing:1px; }
    .mode-btn.active-revenue { background:rgba(129,140,248,.15); color:var(--accent); }
    .mode-btn.active-velocity { background:rgba(251,191,36,.15); color:var(--gold); }
    /* Message draft */
    .draft-box { display:none; margin-top:10px; padding:12px 14px; background:rgba(0,0,0,.4); border:1px solid rgba(255,255,255,.08); border-radius:9px; font-size:.72rem; color:rgba(255,255,255,.75); line-height:1.7; font-family:'Inter'; white-space:pre-wrap; }
    .draft-box.show { display:block; }
    .draft-actions { display:flex; gap:8px; margin-top:8px; }
    .draft-btn { padding:5px 12px; border-radius:6px; border:1px solid var(--border); background:rgba(255,255,255,.04); color:var(--text-secondary); font-family:'JetBrains Mono'; font-size:.58rem; cursor:pointer; transition:.2s; }
    .draft-btn:hover { border-color:var(--accent); color:#fff; background:rgba(129,140,248,.1); }
    /* Warm intro score */
    .intro-score { display:inline-flex; align-items:center; gap:4px; font-size:.58rem; font-family:'JetBrains Mono'; padding:2px 7px; border-radius:5px; font-weight:900; }
    /* â”€â”€ FILTER PILLS â”€â”€ */
    .filter-pills { display:flex; gap:7px; align-items:center; padding:10px 36px 0; flex-wrap:wrap; }
    .fpill { padding:5px 13px; border-radius:100px; font-family:'JetBrains Mono'; font-size:.58rem; font-weight:900; cursor:pointer; border:1px solid var(--border); background:transparent; color:var(--text-secondary); transition:.2s; text-transform:uppercase; letter-spacing:1px; }
    .fpill:hover { border-color:var(--accent); color:#fff; }
    .fpill.active { background:rgba(129,140,248,.15); border-color:var(--accent); color:#fff; }
    .fpill.hot { border-color:var(--red); color:var(--red); }
    .fpill.hot.active { background:rgba(248,113,113,.15); color:var(--red); }
    .fpill.warm { border-color:var(--gold); color:var(--gold); }
    .fpill.warm.active { background:rgba(251,191,36,.15); color:var(--gold); }
    .fpill.cold { border-color:var(--text-secondary); }
    .fpill.cold.active { background:rgba(148,163,184,.1); }
    #securityAlert { position:fixed; top:0; left:0; width:100%; padding:4px; background:var(--red); color:#000; font-weight:900; font-size:.58rem; text-align:center; z-index:10000; display:none; text-transform:uppercase; }
    #toast { position:fixed; bottom:60px; right:36px; background:#000; color:var(--green); padding:13px 24px; border:1px solid var(--green); font-family:'JetBrains Mono'; font-size:.78rem; border-radius:11px; display:none; z-index:1000; box-shadow:0 0 36px rgba(52,211,153,.25); animation:slideIn .3s ease; }
    @keyframes slideIn { from { transform:translateX(40px); opacity:0; } }
    .ticker-item { font-family:'JetBrains Mono'; font-size:.6rem; color:var(--text-secondary); display:flex; align-items:center; gap:7px; }
    .ticker-item b { color:var(--cyan); }

    /* â”€â”€ DESTINY MAP â”€â”€ */
    .destiny-container { position:relative; height:100%; overflow-x:auto; overflow-y:hidden; padding:40px; display:flex; align-items:center; scroll-behavior:smooth; }
    .timeline-track { position:absolute; top:50%; left:0; width:4000px; height:1px; background:linear-gradient(90deg, transparent, var(--border), var(--border), transparent); transform:translateY(-50%); z-index:1; opacity:.3; }
    .timeline-points { position:relative; width:4000px; height:100%; z-index:2; display:flex; align-items:center; }
    .timeline-marker { position:absolute; top:50%; height:12px; border-left:1px solid var(--border); transform:translateY(-50%); }
    .timeline-marker span { position:absolute; top:-20px; left:-20px; width:40px; text-align:center; font-family:'JetBrains Mono'; font-size:.55rem; color:var(--text-secondary); opacity:.5; transform:rotate(-45deg); }

    .anchor-node { position:absolute; transform:translateY(-50%); width:300px; padding:24px; background:rgba(4,4,10,.9); border:1px solid var(--border); border-radius:20px; backdrop-filter:blur(15px); cursor:pointer; transition:.4s cubic-bezier(0.2, 0.8, 0.2, 1); box-shadow:0 10px 40px rgba(0,0,0,.5); }
    .anchor-node:hover { border-color:var(--accent); transform:translateY(-55%) scale(1.02); box-shadow:0 15px 50px var(--accent-glow); }
    .anchor-node.high-alpha { border-color:rgba(248,113,113,.4); box-shadow:0 0 30px rgba(248,113,113,.15); }
    .anchor-node.high-alpha:hover { border-color:var(--red); box-shadow:0 0 40px rgba(248,113,113,.3); }
    .anchor-header { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:16px; }
    .anchor-title { font-family:'Outfit'; font-weight:900; font-size:1.2rem; color:#fff; line-height:1.1; }
    .anchor-milestones { display:flex; flex-direction:column; gap:10px; }
    .milestone-item { padding:10px 14px; background:rgba(255,255,255,.03); border:1px solid var(--border); border-radius:10px; font-size:.68rem; line-height:1.4; display:flex; flex-direction:column; gap:4px; }
    .milestone-item:hover { border-color:var(--accent); background:rgba(255,255,255,.05); }
    .milestone-tag { font-family:'Outfit'; font-weight:900; font-size:.5rem; text-transform:uppercase; letter-spacing:1px; color:var(--accent); }
    .milestone-date { font-family:'JetBrains Mono'; font-size:.58rem; color:var(--text-secondary); margin-top:4px; }

    /* â”€â”€ SIGNAL FEED â”€â”€ */
    .signal-feed-wrap { padding:30px 40px; display:flex; flex-direction:column; height:100%; overflow-y:auto; gap:12px; }
    .signal-card { background:rgba(4,4,10,.8); border:1px solid var(--border); border-radius:18px; padding:20px 24px; display:flex; gap:24px; align-items:flex-start; transition:.3s; backdrop-filter:blur(10px); }
    .signal-card:hover { border-color:var(--accent); transform:translateX(8px); background:rgba(129,140,248,.03); }
    .signal-card.alpha { border-color:rgba(248,113,113,.3); border-left:4px solid var(--red); }
    .signal-card.alpha:hover { border-color:var(--red); }
    .signal-icon-box { width:48px; height:48px; border-radius:12px; background:rgba(255,255,255,.03); display:flex; align-items:center; justify-content:center; font-size:1.5rem; flex-shrink:0; border:1px solid var(--border); }
    .signal-card-main { flex:1; }
    .signal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
    .signal-type-badge { font-family:'JetBrains Mono'; font-weight:900; font-size:.55rem; color:#000; background:var(--text-secondary); padding:2px 10px; border-radius:4px; text-transform:uppercase; letter-spacing:1px; }
    .signal-type-alpha { background:var(--red); color:#000; }
    .signal-type-funding { background:var(--cyan); color:#000; }
    .signal-type-hiring { background:var(--gold); color:#000; }
    .signal-time { font-family:'JetBrains Mono'; font-size:.6rem; color:var(--text-secondary); opacity:.6; }
    .signal-card-title { font-family:'Outfit'; font-weight:800; font-size:1.05rem; color:#fff; }
    .signal-card-desc { font-size:.82rem; color:var(--text-secondary); margin-top:6px; line-height:1.5; }
    .signal-card-footer { display:flex; justify-content:space-between; align-items:center; margin-top:16px; border-top:1px solid rgba(255,255,255,0.03); padding-top:12px; }
    .signal-source { font-family:'JetBrains Mono'; font-size:.58rem; color:var(--accent); opacity:.8; display:flex; align-items:center; gap:6px; }
    .signal-source::before { content:''; display:block; width:6px; height:6px; border-radius:50%; background:currentColor; box-shadow:0 0 6px currentColor; }
    .signal-actions-row { display:flex; gap:8px; }
    .sig-btn { font-family:'JetBrains Mono'; font-size:.55rem; font-weight:900; background:transparent; border:1px solid var(--border); color:var(--text-secondary); padding:6px 12px; border-radius:6px; cursor:pointer; transition:.2s; }
    .sig-btn:hover { border-color:var(--accent); color:#fff; background:rgba(129,140,248,.1); }
    .sig-btn.primary { border-color:var(--green); color:var(--green); }
    .sig-btn.primary:hover { background:rgba(52,211,153,.1); }
    </style>
</head>
<body>
<div id="securityAlert">âš  NX_SECURITY: NON-LOCAL TRAFFIC DETECTED // PRIVATE VAULT EXPOSED</div>
<div id="toast"></div>

<div class="app-window">
    <aside class="workspace-sidebar">
        <div class="logo">
            <div class="logo-icon"></div>
            BASIN::NEXUS
        </div>

        <div class="sidebar-label">Operations</div>
        <div class="nav-item" onclick="switchPanel(0)"><div class="nav-left"><span>ğŸ“¡</span> Destiny Map</div></div>
        <div class="nav-item" onclick="switchPanel(1)"><div class="nav-left"><span>ğŸ›°ï¸</span> Signal Feed</div></div>
        <div class="nav-item active" onclick="switchPanel(2)">
            <div class="nav-left"><span>ğŸ§ </span> Ops Vault</div>
            <span id="vaultBadge" class="badge">â€¦</span>
        </div>

        <div class="sidebar-label">Velocity Flow</div>
        <div class="nav-item" onclick="switchPanel(3)">
            <div class="nav-left"><span>ğŸš€</span> Daily Cadence</div>
            <span class="badge badge-gold" id="cadenceBadge">5</span>
        </div>
        <div class="nav-item" onclick="switchPanel(4)"><div class="nav-left"><span>ğŸ¯</span> Pipeline</div></div>
        <div class="nav-item" onclick="switchPanel(5)"><div class="nav-left"><span>ğŸ“¡</span> Interview Radar</div></div>

        <div class="sidebar-label">Intelligence</div>
        <div class="nav-item" onclick="switchPanel(6);buildCompanies()">
            <div class="nav-left"><span>ğŸ¢</span> Companies</div>
            <span class="badge" id="coBadge">â€”</span>
        </div>
        <div class="nav-item" onclick="switchPanel(7);buildIndustries()">
            <div class="nav-left"><span>ğŸ­</span> Industries</div>
            <span class="badge" id="indBadge">â€”</span>
        </div>
        <div class="nav-item" onclick="switchPanel(8);buildSeniority()">
            <div class="nav-left"><span>ğŸ‘”</span> Seniority</div>
            <span class="badge" id="senBadge">â€”</span>
        </div>
        <div class="nav-item" onclick="switchPanel(9);buildAnalytics()">
            <div class="nav-left"><span>ğŸ“Š</span> Analytics</div>
        </div>

        <div class="sidebar-label">Network & Signals</div>
        <div class="nav-item" onclick="switchPanel(10)"><div class="nav-left"><span>ğŸ”—</span> Warm Intros</div></div>
        <div class="nav-item" onclick="switchPanel(11)"><div class="nav-left"><span>ğŸŒ</span> Relationship Graph</div></div>
        <div class="nav-item" onclick="switchPanel(12)"><div class="nav-left"><span>âš ï¸</span> Live Alerts</div></div>
        <div class="nav-item" onclick="switchPanel(13)"><div class="nav-left"><span>ğŸ“¥</span> Signal Inbox</div></div>

        <div class="sidebar-label">Tools & Protocols</div>
        <div class="nav-item" onclick="switchPanel(14)"><div class="nav-left"><span>ğŸ“¤</span> Export Cadence</div></div>
        <div class="nav-item" onclick="switchPanel(15)"><div class="nav-left"><span>ğŸ“‹</span> Protocol Console</div></div>
        <div class="nav-item" onclick="switchPanel(16)"><div class="nav-left"><span>âš™ï¸</span> Settings</div></div>

        <div class="protocol-box">
            <div class="protocol-title">T4: Close or Kill</div>
            <div class="protocol-body">Node idle &gt;5 days â†’ Autonomous archival triggered.</div>
        </div>
        <div class="sys-status"><span class="pulse">â—</span> SYS_STATUS: OPTIMAL</div>
    </aside>

    <main class="workspace-main">
        <header class="workspace-header">
            <div class="search-wrap">
                <input type="text" class="search-bar" id="globalSearch" placeholder="Command (/) or Semantic Search (K)â€¦">
                <div id="vectorToggle" class="vector-pill" onclick="toggleVector()"><div class="dot"></div> VECTOR</div>
            </div>
            <div class="tel-group">
                <div class="tel-pill"><span class="tel-label">Pipeline</span><span class="tel-val">$430,000</span></div>
                <div class="tel-pill"><span class="tel-label">Intent</span><span class="tel-val" style="color:var(--cyan)">HIGH ALPHA</span></div>
            </div>
            <div style="display:flex; gap:10px; align-items:center;">
                <button class="hud-btn velocity" onclick="generateCadence(); switchPanel(3);">âš¡ TODAY'S 5</button>
                <button class="hud-btn" onclick="loadVault()">LOAD VAULT</button>
                <div class="mode-toggle">
                    <button class="mode-btn" id="modeRevenue" onclick="setMode('revenue')">ğŸ’¼ Revenue</button>
                    <button class="mode-btn active-velocity" id="modeVelocity" onclick="setMode('velocity')">ğŸš€ Velocity</button>
                </div>
                <div id="systemClock" class="clock-block">â€”</div>
            </div>
        </header>

        <div class="decision-strip" id="decisionStrip">
            <div class="decision-node" id="dNode0" onclick="decisionAction(0)">
                <div><div class="d-label" id="dLabel0" style="color:var(--green)">NOW</div><div id="labelNow" class="d-val">Loadingâ€¦</div></div>
            </div>
            <div class="decision-node" id="dNode1" onclick="decisionAction(1)">
                <div><div class="d-label" id="dLabel1" style="color:var(--gold)">NEXT</div><div id="labelNext" class="d-val">Loadingâ€¦</div></div>
            </div>
            <div class="decision-node" id="dNode2" onclick="decisionAction(2)">
                <div><div class="d-label" id="dLabel2" style="color:var(--red)">STUCK</div><div id="labelStuck" class="d-val">Loadingâ€¦</div></div>
            </div>
        </div>

        <!-- PANEL 0: DESTINY MAP -->
        <div class="panel" id="panel-0" style="overflow:hidden; height:100%; width:100%;">
            <div class="destiny-container" id="destinyMapMount">
                <div class="timeline-track"></div>
                <div class="timeline-points" id="timelinePoints"></div>
            </div>
        </div>

        <!-- PANEL 1: SIGNAL FEED -->
        <div class="panel" id="panel-1" style="overflow:hidden; height:100%;">
            <div class="signal-feed-wrap">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <div>
                        <div class="vel-title" style="margin-bottom:0;">ğŸ›°ï¸ SIGNAL FEED // REAL-TIME GTM PULSE</div>
                        <div style="font-size:10px; color:var(--gold); font-family:'JetBrains Mono'; opacity:0.8; margin-top:4px;">â— Google Alerts RSS active â€“ custom keyword monitoring</div>
                    </div>
                    <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
                        <button class="hud-btn velocity" onclick="fetchAllRSS()" style="font-size:.6rem; padding:6px 14px;">â†» Refresh Signals</button>
                        <button class="hud-btn" onclick="fetchAllJobBoards()" style="font-size:.6rem; padding:6px 14px; border-color:var(--green); color:var(--green);">ğŸ’¼ Refresh Jobs</button>
                        <button class="hud-btn" onclick="fetchAllXSignals()" style="font-size:.6rem; padding:6px 14px; border-color:#1DA1F2; color:#1DA1F2;">ğ• Refresh X</button>
                        <div class="filter-pills" style="padding:0;">
                            <button class="fpill active" onclick="filterSignals('all', this)">All</button>
                            <button class="fpill hot" onclick="filterSignals('alpha', this)">High Alpha</button>
                            <button class="fpill warm" onclick="filterSignals('funding', this)">Funding</button>
                            <button class="fpill" style="border-color:var(--green); color:var(--green);" onclick="filterSignals('hiring', this)">Hiring</button>
                            <button class="fpill" style="border-color:#1DA1F2; color:#1DA1F2;" onclick="filterSignals('x', this)">X Posts</button>
                            <button class="fpill" style="border-color:var(--cyan); color:var(--cyan);" onclick="filterSignals('startup', this)">Startup</button>
                        </div>
                    </div>
                </div>
                <div id="signalListMount" style="display:flex; flex-direction:column; gap:12px;"></div>
            </div>
        </div>

        <!-- PANEL 2: OPS VAULT -->
        <div class="panel active" id="panel-2" style="padding:20px 36px; display:flex; flex-direction:column; overflow:hidden;">
            <div class="ops-toolbar">
                <div class="ops-actions">
                    <button class="hud-btn" style="border-color:var(--border); color:var(--text-secondary); background:transparent; font-size:.6rem;">&#8593; IMPORT CSV</button>
                    <button class="hud-btn" style="border-color:var(--border); color:var(--text-secondary); background:transparent; font-size:.6rem;">&#8593; CONTACTS</button>
                </div>
                <div class="ops-meta">
                    <div id="vectorBadge">ğŸ§¬ SEMANTIC RADAR ACTIVE</div>
                    <div>LOCAL LEADS: <b id="recordsCount" style="color:#fff;">â€¦</b></div>
                    <div style="color:var(--green); font-size:.6rem;" id="vecStatus"></div>
                </div>
            </div>
            <div class="filter-pills">
                <span style="font-family:'JetBrains Mono';font-size:.55rem;color:var(--text-secondary);letter-spacing:1px;">FILTER:</span>
                <button class="fpill active" id="fpAll" onclick="applyConvFilter('all')">All</button>
                <button class="fpill hot" id="fpHot" onclick="applyConvFilter('hot')">&#128293; HOT 80%+</button>
                <button class="fpill warm" id="fpWarm" onclick="applyConvFilter('warm')">&#127777; WARM 60â€“80%</button>
                <button class="fpill cold" id="fpCold" onclick="applyConvFilter('cold')">&#10052; COLD &lt;60%</button>
                <span id="filterCount" style="font-family:'JetBrains Mono';font-size:.58rem;color:var(--text-secondary);margin-left:8px;"></span>
            </div>
            <div class="lead-row" style="background:transparent; border:none; cursor:default; opacity:.35; font-weight:900; font-size:.58rem; text-transform:uppercase; letter-spacing:2px; margin-bottom:10px; pointer-events:none;">
                <div>Dataset</div><div>Name</div><div>Stage</div><div>Email</div><div>Phone</div><div>Source</div><div>Score</div>
            </div>
            <div id="nodesViewport">
                <div id="nodesMount"></div>
            </div>
        </div>

        <!-- PANEL 3: DAILY CADENCE -->
        <div class="panel" id="panel-3" style="padding:20px 36px; overflow-y:auto;">
            <div class="vel-section">
                <div class="vel-title">âš¡ Daily Velocity Pulse</div>
                <div class="cadence-card">
                    <div class="cadence-header">
                        <div class="cadence-title">Today's Targets</div>
                        <button class="hud-btn velocity" onclick="generateCadence()" style="font-size:.6rem; padding:6px 12px;">â†» Regenerate</button>
                    </div>
                    <div class="cadence-items" id="cadenceList">
                        <div style="color:var(--text-secondary); font-size:.75rem; padding:20px 0; text-align:center;">Loading vault data to generate targetsâ€¦</div>
                    </div>
                </div>
            </div>
            <div class="vel-section" style="margin-top:8px;">
                <div class="vel-title">ğŸ“Š Conversation Score Distribution</div>
                <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:12px;">
                    <div style="background:rgba(52,211,153,.08); border:1px solid rgba(52,211,153,.2); border-radius:12px; padding:16px; text-align:center;">
                        <div style="font-family:'Outfit'; font-size:1.8rem; font-weight:900; color:var(--green);" id="scoreHot">â€”</div>
                        <div style="font-size:.65rem; color:var(--text-secondary); margin-top:4px;">HOT (80%+)</div>
                    </div>
                    <div style="background:rgba(251,191,36,.08); border:1px solid rgba(251,191,36,.2); border-radius:12px; padding:16px; text-align:center;">
                        <div style="font-family:'Outfit'; font-size:1.8rem; font-weight:900; color:var(--gold);" id="scoreWarm">â€”</div>
                        <div style="font-size:.65rem; color:var(--text-secondary); margin-top:4px;">WARM (60â€“80%)</div>
                    </div>
                    <div style="background:rgba(148,163,184,.08); border:1px solid rgba(148,163,184,.15); border-radius:12px; padding:16px; text-align:center;">
                        <div style="font-family:'Outfit'; font-size:1.8rem; font-weight:900; color:var(--text-secondary);" id="scoreCold">â€”</div>
                        <div style="font-size:.65rem; color:var(--text-secondary); margin-top:4px;">COLD (&lt;60%)</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PANEL 4: CONVERSATION PIPELINE -->
        <div class="panel" id="panel-4" style="padding:20px 36px; overflow-y:auto;">
            <div class="vel-title">ğŸ¯ Conversation Pipeline</div>
            <div class="kanban" id="kanbanBoard">
                <div class="kanban-col"><div class="kanban-stage" style="color:var(--text-secondary)">Saved</div><div id="col-saved"></div></div>
                <div class="kanban-col"><div class="kanban-stage" style="color:var(--cyan)">Contacted</div><div id="col-contacted"></div></div>
                <div class="kanban-col"><div class="kanban-stage" style="color:var(--accent)">Call / Chat</div><div id="col-call"></div></div>
                <div class="kanban-col"><div class="kanban-stage" style="color:var(--gold)">Interview</div><div id="col-interview"></div></div>
                <div class="kanban-col"><div class="kanban-stage" style="color:var(--green)">Offer / Win</div><div id="col-offer"></div></div>
            </div>
        </div>

        <!-- PANEL 5: INTERVIEW RADAR -->
        <div class="panel" id="panel-5" style="padding:20px 36px; overflow-y:auto;">
            <div class="vel-title">ğŸ“¡ Interview Radar â€” Target Companies</div>
            <div class="radar-grid" id="radarGrid"></div>
        </div>

        <!-- PANEL 6: COMPANIES -->
        <div class="panel" id="panel-6" style="padding:20px 36px; overflow-y:auto;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
                <div class="vel-title" style="margin-bottom:0;">ğŸ¢ Company Intelligence</div>
                <input type="text" id="coSearch" placeholder="Search companiesâ€¦" style="background:rgba(0,0,0,.35);border:1px solid var(--border);color:#fff;padding:7px 12px;border-radius:8px;font-family:'JetBrains Mono';font-size:.72rem;" oninput="buildCompanies()">
            </div>
            <div id="companyList"></div>
        </div>

        <!-- PANEL 7: INDUSTRIES -->
        <div class="panel" id="panel-7" style="padding:20px 36px; overflow-y:auto;">
            <div class="vel-title">ğŸ­ Industry Intelligence</div>
            <div id="industryList"></div>
        </div>

        <!-- PANEL 8: SENIORITY -->
        <div class="panel" id="panel-8" style="padding:20px 36px; overflow-y:auto;">
            <div class="vel-title">ğŸ‘” Seniority Intelligence</div>
            <div id="seniorityList"></div>
        </div>

        <!-- PANEL 9: ANALYTICS -->
        <div class="panel" id="panel-9" style="padding:20px 36px; overflow-y:auto;">
            <div class="vel-title">ğŸ“Š CRM Analytics Dashboard</div>
            <div id="analyticsMount"></div>
        </div>

        <!-- PANEL 10-16: Stubs -->
        <div class="panel" id="panel-10" style="padding:60px; color:var(--text-secondary); font-family:'JetBrains Mono'; font-size:.8rem; text-align:center;">
            <div style="font-size:3rem;margin-bottom:16px;">ğŸ”—</div>WARM INTROS // Coming soon â€” Protocol 23
        </div>
        <div class="panel" id="panel-11" style="padding:60px; color:var(--text-secondary); font-family:'JetBrains Mono'; font-size:.8rem; text-align:center;">
            <div style="font-size:3rem;margin-bottom:16px;">ğŸŒ</div>RELATIONSHIP GRAPH // Coming soon â€” Protocol 23
        </div>
        <div class="panel" id="panel-12" style="padding:60px; color:var(--text-secondary); font-family:'JetBrains Mono'; font-size:.8rem; text-align:center;">
            <div style="font-size:3rem;margin-bottom:16px;">âš ï¸</div>LIVE ALERTS // Coming soon â€” Protocol 23
        </div>
        <div class="panel" id="panel-13" style="padding:60px; color:var(--text-secondary); font-family:'JetBrains Mono'; font-size:.8rem; text-align:center;">
            <div style="font-size:3rem;margin-bottom:16px;">ğŸ“¥</div>SIGNAL INBOX // Coming soon â€” Protocol 23
        </div>
        <div class="panel" id="panel-14" style="padding:60px; color:var(--text-secondary); font-family:'JetBrains Mono'; font-size:.8rem; text-align:center;">
            <div style="font-size:3rem;margin-bottom:16px;">ğŸ“¤</div>EXPORT CADENCE // Coming soon â€” Protocol 23
        </div>
        <div class="panel" id="panel-15" style="padding:60px; color:var(--text-secondary); font-family:'JetBrains Mono'; font-size:.8rem; text-align:center;">
            <div style="font-size:3rem;margin-bottom:16px;">ğŸ“‹</div>PROTOCOL CONSOLE // Coming soon â€” Protocol 23
        </div>
        <div class="panel" id="panel-16" style="padding:60px; color:var(--text-secondary); font-family:'JetBrains Mono'; font-size:.8rem; text-align:center;">
            <div style="font-size:3rem;margin-bottom:16px;">âš™ï¸</div>SETTINGS // Coming soon â€” Protocol 23
        </div>

    <footer style="grid-row:3; grid-column:2; padding:0 36px; border-top:1px solid var(--border); background:#000; display:flex; align-items:center; gap:36px;">
        <div class="ticker-item">â— NODE_SYNC [LIVE] <b id="tickerCount">â€¦</b></div>
        <div class="ticker-item">â— SEMANTIC_RADAR <b style="color:var(--green)" id="tickerVector">LOADING</b></div>
        <div class="ticker-item">â— VELOCITY_FLOW <b style="color:var(--gold)">ACTIVE</b></div>
        <div class="ticker-item">â— LOCAL_FIRST <b>100% PRIVATE</b></div>
    </footer>
</div>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// NexusNode + State
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
class NexusNode {
    constructor(d) {
        this.id = d.id; this.type = d.type || 'lead';
        this.name = d.name || 'Unknown Entity'; this.company = d.company || '';
        this.email = d.email || 'â€”'; this.phone = d.phone || 'â€”';
        this.role = d.role || ''; this.industry = d.industry || '';
        this.intentScore = +d.intentScore || 65;
        this.status = d.status || 'NEXT';
        this.source = 'Signal Refinery';
        this.embedding = d.embedding || [];
        // Conversation probability: intentScore + random variance, seeded by id
        this.convProb = Math.min(99, Math.max(30, this.intentScore + (parseInt(this.id.slice(-2), 16) % 20 - 10)));
    }
}

let allNodes = [], filteredNodes = [], vectorMode = false, privacyMode = false, vectorsReady = 0;
let searchDebounce, kanbanData = { saved:[], contacted:[], call:[], interview:[], offer:[] };
let currentMode = 'velocity'; // 'revenue' | 'velocity'
const ROW_BATCH = 50;

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Mode Toggle (Revenue â†” Velocity)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DECISION_REVENUE = [
    {label:'NOW',color:'var(--green)',action:()=>filterStatus('NOW')},
    {label:'NEXT',color:'var(--gold)',action:()=>filterStatus('NEXT')},
    {label:'STUCK',color:'var(--red)',action:()=>filterStatus('STUCK')}
];
const DECISION_VELOCITY = [
    {label:'CONTACTED',color:'var(--cyan)',action:()=>switchPanel(4)},
    {label:'INTERVIEW',color:'var(--gold)',action:()=>switchPanel(4)},
    {label:'OFFER',color:'var(--green)',action:()=>switchPanel(4)}
];
function setMode(mode) {
    currentMode = mode;
    document.getElementById('modeRevenue').className = 'mode-btn' + (mode==='revenue'?' active-revenue':'');
    document.getElementById('modeVelocity').className = 'mode-btn' + (mode==='velocity'?' active-velocity':'');
    const defs = mode==='revenue' ? DECISION_REVENUE : DECISION_VELOCITY;
    defs.forEach((d,i)=>{
        document.getElementById(`dLabel${i}`).textContent = d.label;
        document.getElementById(`dLabel${i}`).style.color = d.color;
    });
    const velItems = document.querySelectorAll('.sidebar-label');
    if(velItems[1]) velItems[1].style.opacity = mode==='velocity'?'1':'.4';
    showToast(mode==='velocity'?'ğŸš€ Velocity Mode â€” Career Acceleration Active':'ğŸ’¼ Revenue Mode â€” GTM Intelligence Active');
    if(mode==='velocity') switchPanel(4);
}
function decisionAction(i) {
    const defs = currentMode==='revenue' ? DECISION_REVENUE : DECISION_VELOCITY;
    if(defs[i]) defs[i].action();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Warm Intro Score (0â€“100): combines semantic similarity to top
// consulting contacts + role seniority + intentScore
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const WARM_ANCHORS = ['replit','go nimbly','descope','consulting','customer success','revenue ops','gtm'];
function warmIntroScore(node) {
    const meta = `${node.name} ${node.company} ${node.role}`.toLowerCase();
    let base = node.intentScore * 0.4;
    WARM_ANCHORS.forEach(a=>{ if(meta.includes(a)) base += 12; });
    const seniority = /vp|head|director|chief|cto|cso|cro|partner|founder/.test(meta) ? 15 : /manager|lead|principal|senior/.test(meta) ? 8 : 0;
    return Math.min(99, Math.round(base + seniority));
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Security
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if (!['localhost','127.0.0.1'].includes(window.location.hostname)) {
    document.getElementById('securityAlert').style.display = 'block';
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Cosine Similarity + TF-IDF
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function cosineSim(A, B) {
    if (!A?.length || !B?.length || A.length !== B.length) return 0;
    let dot=0,mA=0,mB=0;
    for (let i=0;i<A.length;i++){dot+=A[i]*B[i];mA+=A[i]*A[i];mB+=B[i]*B[i];}
    const d=Math.sqrt(mA)*Math.sqrt(mB);
    return d===0?0:dot/d;
}
function kwScore(node, tokens) {
    const m=`${node.name} ${node.company} ${node.role} ${node.industry} ${node.email}`.toLowerCase();
    return tokens.reduce((s,t)=>s+(m.includes(t)?1+(m.split(t).length-2)*.3:0),0);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Vault Load
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadVault() {
    showToast('ğŸ”’ Synchronizing 163MB Vector Vaultâ€¦');
    try {
        const r = await fetch('./11_DATA_FEEDS/local_nexus_data.json', {cache:'no-store'});
        if (!r.ok) throw new Error('Not found');
        const data = await r.json();
        allNodes = data.nodes.map(n => new NexusNode(n));
        window.nexusNodes = allNodes;
        filteredNodes = allNodes;
        vectorsReady = allNodes.filter(n=>n.embedding?.some(v=>v!==0)).length;
        updateUI();
        showToast(`ğŸ§¬ ${allNodes.length.toLocaleString()} Nodes Â· ${vectorsReady.toLocaleString()} Vectors Â· READY`);
        console.log('%cğŸ”¥ BASIN::NEXUS VECTOR RADAR ONLINE â€” type anything to feel the intelligence','color:#34d399;font-size:14px;font-weight:bold;');
        buildVelocityFlow();
    } catch(e) {
        console.warn('Vault not found, using demo data');
        allNodes = Array(64).fill(0).map((_,i)=>new NexusNode({id:`demo${i}`,name:`Demo Node ${i}`,company:'Nexus AI',email:'demo@nexus.local',status:['NOW','NEXT','STUCK'][i%3]}));
        filteredNodes = allNodes;
        updateUI();
        buildVelocityFlow();
    }
}

function updateUI() {
    const cnt = allNodes.length.toLocaleString();
    document.getElementById('vaultBadge').textContent = cnt;
    document.getElementById('recordsCount').textContent = cnt;
    document.getElementById('tickerCount').textContent = cnt + ' NODES';
    const pct = Math.round(vectorsReady/allNodes.length*100);
    document.getElementById('tickerVector').textContent = vectorsReady>0?`${pct}% VECTORIZED`:'KEYWORD MODE';
    document.getElementById('vecStatus').textContent = vectorsReady>0?`ğŸ§¬ ${vectorsReady.toLocaleString()} real vectors`:'';
    const now=allNodes.find(n=>n.status==='NOW'), next=allNodes.find(n=>n.status==='NEXT'), stuck=allNodes.find(n=>n.status==='STUCK');
    if(now) document.getElementById('labelNow').textContent=`${now.name}: ${now.company}`;
    if(next) document.getElementById('labelNext').textContent=`${next.name}: ${next.company}`;
    if(stuck) document.getElementById('labelStuck').textContent=`${stuck.name}: ${stuck.company}`;
    renderTable();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Table Render (infinite scroller)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderTable() {
    const m = document.getElementById('nodesMount');
    m.innerHTML = '';
    filteredNodes.slice(0,100).forEach(n=>m.appendChild(createRow(n)));
}
function createRow(node) {
    const row = document.createElement('div');
    row.className = 'lead-row';
    const sc = node.intentScore>75?'var(--green)':node.intentScore>50?'var(--gold)':'var(--red)';
    const pc = node.status==='NOW'?'pill-now':node.status==='NEXT'?'pill-next':'pill-stuck';
    const wi = warmIntroScore(node);
    const wiColor = wi>=70?'rgba(52,211,153,.8)':wi>=50?'rgba(251,191,36,.8)':'rgba(148,163,184,.5)';
    // In velocity mode, show conv prob + warm intro instead of source + score
    const col6 = currentMode==='velocity'
        ? `<span class="intro-score" style="background:rgba(52,211,153,.08);border:1px solid ${wiColor};color:${wiColor}">ğŸ¤ ${wi}%</span>`
        : `<div style="color:var(--text-secondary);opacity:.55;font-size:.58rem;letter-spacing:1px;">${node.source}</div>`;
    const col7 = currentMode==='velocity'
        ? `<div style="color:var(--gold);font-weight:900;font-family:'Outfit';font-size:.88rem;">${node.convProb}%</div>`
        : `<div style="color:${sc};font-weight:900;font-family:'Outfit';font-size:.92rem;">${node.intentScore}%</div>`;
    row.innerHTML=`
        <div style="color:var(--accent);font-weight:900;font-family:'Outfit';text-transform:uppercase;font-size:.62rem;">${node.type}</div>
        <div style="color:#fff;font-weight:800;font-family:'Outfit';font-size:.88rem;">${node.name}${node.role?`<div style="font-size:.65rem;color:var(--text-secondary);font-weight:400;margin-top:1px;">${node.role}</div>`:''}</div>
        <div><span class="status-pill ${pc}">${node.status}</span></div>
        <div class="pii" style="font-size:.75rem;">${node.email}</div>
        <div class="pii" style="font-family:'JetBrains Mono';font-size:.68rem;">${node.phone}</div>
        ${col6}
        ${col7}`;
    row.onclick=()=>openNodeDetail(node);
    return row;
}
document.getElementById('nodesViewport').onscroll=function(e){
    const {scrollTop,scrollHeight,clientHeight}=e.target;
    if(scrollTop+clientHeight>=scrollHeight-200){
        const cur=document.getElementById('nodesMount').children.length;
        if(cur<filteredNodes.length) filteredNodes.slice(cur,cur+ROW_BATCH).forEach(n=>document.getElementById('nodesMount').appendChild(createRow(n)));
    }
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// HOT / WARM / COLD Quick Filter
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let activeConvFilter = 'all';
function applyConvFilter(tier) {
    activeConvFilter = tier;
    ['fpAll','fpHot','fpWarm','fpCold'].forEach(id=>{
        const el=document.getElementById(id); if(el) el.classList.remove('active');
    });
    const map={all:'fpAll',hot:'fpHot',warm:'fpWarm',cold:'fpCold'};
    if(map[tier]) document.getElementById(map[tier])?.classList.add('active');
    if(tier==='all') filteredNodes=[...allNodes];
    else if(tier==='hot') filteredNodes=allNodes.filter(n=>n.convProb>=80);
    else if(tier==='warm') filteredNodes=allNodes.filter(n=>n.convProb>=60&&n.convProb<80);
    else if(tier==='cold') filteredNodes=allNodes.filter(n=>n.convProb<60);
    const fc=document.getElementById('filterCount');
    if(fc&&tier!=='all') fc.textContent=`${filteredNodes.length.toLocaleString()} nodes`;
    else if(fc) fc.textContent='';
    renderTable();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Seniority inference + PANEL 10
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function inferSeniority(node) {
    const r=(node.role||'').toLowerCase();
    if(/\b(ceo|cto|cro|cso|coo|cfo|chief|founder|co-founder)\b/.test(r)) return 'C-Suite / Founder';
    if(/\b(vp|vice president|v\.p\.)\b/.test(r)) return 'VP';
    if(/\b(head|director|sr\. director|senior director)\b/.test(r)) return 'Head / Director';
    if(/\b(manager|lead|principal|senior manager)\b/.test(r)) return 'Manager / Lead';
    if(/\b(senior|sr\.)\b/.test(r)) return 'Senior IC';
    if(/\b(engineer|analyst|specialist|associate|consultant)\b/.test(r)) return 'Individual Contributor';
    if(r.length > 0) return 'Other';
    return 'Unknown';
}

function buildSeniority() {
    if(!allNodes.length) return;
    const TIER_ORDER=['C-Suite / Founder','VP','Head / Director','Manager / Lead','Senior IC','Individual Contributor','Other','Unknown'];
    const map={};
    allNodes.forEach(n=>{
        const tier=inferSeniority(n);
        if(!map[tier]) map[tier]={name:tier,nodes:[],companies:new Set()};
        map[tier].nodes.push(n);
        if(n.company) map[tier].companies.add(n.company);
    });
    // Sort by predefined tier order
    const entries=TIER_ORDER.map(t=>map[t]).filter(Boolean);
    const list=document.getElementById('seniorityList');
    if(!list) return;
    list.innerHTML='';
    entries.forEach(tier=>{
        const avgScore=Math.round(tier.nodes.reduce((s,n)=>s+(currentMode==='velocity'?n.convProb:n.intentScore),0)/tier.nodes.length);
        const topCos=[...tier.companies].slice(0,5);
        const topContacts=tier.nodes.sort((a,b)=>b.convProb-a.convProb).slice(0,5);
        const sc=avgScore>=80?'var(--green)':avgScore>=65?'var(--gold)':'var(--red)';
        const isBoss=/C-Suite|VP|Head/.test(tier.name);
        const card=document.createElement('div');
        card.className='co-card';
        if(isBoss) card.style.borderColor='rgba(251,191,36,.25)';
        card.innerHTML=`
            <div class="co-card-header" onclick="this.parentElement.classList.toggle('expanded')">
                <div>
                    <div class="co-card-name">${isBoss?'â­ ':''}${tier.name}</div>
                    <div class="co-card-meta">${tier.nodes.length.toLocaleString()} contacts &middot; ${tier.companies.size} companies</div>
                </div>
                <div style="text-align:right;">
                    <div style="font-family:'Outfit';font-weight:900;font-size:1.3rem;color:${sc}">${avgScore}%</div>
                    <div style="font-size:.55rem;color:var(--text-secondary);">AVG SCORE</div>
                </div>
            </div>
            <div class="co-card-body">
                <div style="font-size:.6rem;font-weight:900;letter-spacing:1px;color:var(--text-secondary);text-transform:uppercase;margin-bottom:8px;">Top Companies</div>
                <div style="margin-bottom:12px;">${topCos.map(c=>`<span class="tag-chip" style="cursor:pointer;" onclick="filterToCompany('${c.replace(/'/g,'')}');showToast('Filtering: ${c.replace(/'/g,'')}')">${c}</span>`).join('')}</div>
                <div style="font-size:.6rem;font-weight:900;letter-spacing:1px;color:var(--text-secondary);text-transform:uppercase;margin-bottom:8px;">Hottest Contacts</div>
                ${topContacts.map(n=>`<div class="co-contact"><span style="color:#fff;font-weight:600;">${n.name}</span><span style="color:var(--text-secondary);font-size:.65rem;">${n.company||'â€”'}</span><span style="color:${n.convProb>=80?'var(--green)':'var(--gold)'};font-family:'JetBrains Mono';font-size:.65rem;">${n.convProb}%</span></div>`).join('')}
                <div style="display:flex;gap:8px;margin-top:14px;flex-wrap:wrap;">
                    <button class="draft-btn" onclick="filterBySeniority('${tier.name}')" style="color:var(--cyan);border-color:var(--cyan);">&#x1F9E0; Filter Vault</button>
                    <button class="draft-btn" onclick="addTopToday(null,'${tier.name}')" style="color:var(--gold);border-color:var(--gold);">&#x26A1; Add to Cadence</button>
                </div>
            </div>`;
        list.appendChild(card);
    });
    // update badge
    const senBadge=document.getElementById('senBadge');
    if(senBadge) senBadge.textContent=entries.length;
}
function filterBySeniority(tier) {
    filteredNodes=allNodes.filter(n=>inferSeniority(n)===tier);
    renderTable(); switchPanel(2);
    showToast(`\ud83d\udc54 ${tier}: ${filteredNodes.length.toLocaleString()} nodes`);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Search (Vector + Keyword)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleVector() {
    vectorMode=!vectorMode;
    document.getElementById('vectorToggle').classList.toggle('active',vectorMode);
    document.getElementById('vectorBadge').style.display=vectorMode?'block':'none';
    showToast(vectorMode?'ğŸ§¬ Semantic Radar Online':'ğŸ” Keyword Mode Active');
    doSearch();
}
function doSearch() {
    const raw=document.getElementById('globalSearch').value, q=raw.toLowerCase().trim();
    const tokens=q.split(/\s+/).filter(Boolean), badge=document.getElementById('vectorBadge');
    if(!q){filteredNodes=allNodes;if(badge)badge.style.display='none';renderTable();return;}
    let scored;
    if(vectorMode&&vectorsReady>0){
        const anchor=allNodes.find(x=>x.embedding?.some(v=>v!==0)&&tokens.some(t=>x.name.toLowerCase().includes(t)||x.company.toLowerCase().includes(t)));
        scored=allNodes.map(n=>{
            const sv=anchor&&n.embedding?.some(v=>v!==0)?cosineSim(n.embedding,anchor.embedding):0;
            const kv=kwScore(n,tokens)/(tokens.length+1);
            return{node:n,score:sv*.55+kv*.45};
        }).sort((a,b)=>b.score-a.score);
    } else {
        scored=allNodes.map(n=>({node:n,score:kwScore(n,tokens)})).filter(x=>x.score>0).sort((a,b)=>b.score-a.score);
    }
    const res=scored.filter(x=>x.score>0).slice(0,500);
    filteredNodes=res.length>0?res.map(x=>x.node):allNodes.filter(n=>n.name.toLowerCase().includes(q)||n.email.toLowerCase().includes(q));
    if(badge&&q){
        const avg=res.length>0?(res.slice(0,10).reduce((s,x)=>s+x.score,0)/Math.min(10,res.length)).toFixed(2):0;
        badge.textContent=`ğŸ§¬ ${filteredNodes.length.toLocaleString()} matches for "${raw}" (score ${avg})`;
        badge.style.display='block';
    }
    renderTable();
}
document.getElementById('globalSearch').addEventListener('input',()=>{clearTimeout(searchDebounce);searchDebounce=setTimeout(doSearch,300);});
function filterStatus(s){filteredNodes=allNodes.filter(n=>n.status===s);renderTable();switchPanel(2);}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Velocity Flow Engine
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const TARGET_COMPANIES = ['Replit','Go Nimbly','Descope','Salesforce','HubSpot','Gong','Outreach','Notion','Linear','Lattice'];
const ACTIONS = ['Send personalized LinkedIn DM','Comment on recent post','Email with value hook','Request informational call','Send Loom video intro','Drop voice memo'];

function draftMessage(node) {
    const co = node.company || 'your company';
    const role = node.role || 'your role';
    const templates = [
        `Hey ${node.name.split(' ')[0]}, I noticed ${co}'s been expanding its CS motion â€” I've spent the last few months building out GTM infrastructure for early-stage teams and think there's a genuine overlap. Would 15 min be worth it?`,
        `${node.name.split(' ')[0]} â€” your work on ${role.toLowerCase()} at ${co} stood out to me. I'm exploring my next move in CS/RevOps and would love to hear how your team thinks about [specific signal]. Open to a quick call?`,
        `Hi ${node.name.split(' ')[0]}, long shot but a strong one â€” I'm a CS operator who's been in the room closing enterprise deals and building signal-first GTM systems. ${co} keeps coming up on my radar. Worth 15 min?`,
        `${node.name.split(' ')[0]}, I've been following ${co}'s momentum. My background: 5 months building a private AI CRM that surfaces revenue signals better than Salesforce. Think that overlaps with what you're building at ${co}?`,
    ];
    return templates[Math.floor(Math.random()*templates.length)];
}

function buildVelocityFlow() {
    generateCadence();
    buildKanban();
    buildRadar();
    buildScoreDistrib();
    // Badge counts ready immediately
    const cos = new Set(allNodes.map(n=>n.company).filter(Boolean));
    const inds = new Set(allNodes.map(n=>inferIndustry(n)).filter(Boolean));
    const coBadge = document.getElementById('coBadge');
    const indBadge = document.getElementById('indBadge');
    if(coBadge) coBadge.textContent = cos.size;
    if(indBadge) indBadge.textContent = inds.size;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Industry inference helper
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function inferIndustry(node) {
    if(node.industry && node.industry !== 'Unknown') return node.industry;
    const m = `${node.company} ${node.role}`.toLowerCase();
    if(/security|cyber|soc|identity|auth|descope|okta|crowdstrike|siem/.test(m)) return 'Cybersecurity';
    if(/replit|ai|ml|llm|gpt|openai|anthropic|vector|embed/.test(m)) return 'AI / LLM';
    if(/revops|revenue ops|gtm|nimbly|gong|outreach|salesloft/.test(m)) return 'RevOps / GTM';
    if(/saas|software|platform|cloud/.test(m)) return 'SaaS / Cloud';
    if(/consult|advisory|partner|fractional/.test(m)) return 'Consulting';
    if(/sales|hubspot|salesforce|crm/.test(m)) return 'CRM / Sales';
    if(/market|demand|growth|seo|content/.test(m)) return 'Marketing';
    if(/product|pm|roadmap|notion|linear/.test(m)) return 'Product';
    if(/data|analytics|bi|tableau|looker/.test(m)) return 'Data / BI';
    if(/finance|fintech|payments|stripe/.test(m)) return 'FinTech';
    return 'Other';
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PANEL 7: Company Intelligence Cards
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildCompanies() {
    if(!allNodes.length) return;
    const q = (document.getElementById('coSearch')?.value||'').toLowerCase();
    // Group by company
    const map = {};
    allNodes.forEach(n=>{
        const co = (n.company||'Unknown').trim();
        if(!map[co]) map[co]={name:co,nodes:[]};
        map[co].nodes.push(n);
    });
    let entries = Object.values(map)
        .filter(c=>!q||c.name.toLowerCase().includes(q))
        .sort((a,b)=>b.nodes.length-a.nodes.length)
        .slice(0,30);
    const list = document.getElementById('companyList');
    list.innerHTML='';
    entries.forEach(c=>{
        const avgScore = Math.round(c.nodes.reduce((s,n)=>s+(currentMode==='velocity'?n.convProb:n.intentScore),0)/c.nodes.length);
        const top5 = c.nodes.sort((a,b)=>b.convProb-a.convProb).slice(0,5);
        const tags = [...new Set(c.nodes.map(n=>inferIndustry(n)))].slice(0,3);
        const sc = avgScore>=80?'var(--green)':avgScore>=65?'var(--gold)':'var(--red)';
        const card = document.createElement('div');
        card.className='co-card';
        card.innerHTML=`
            <div class="co-card-header" onclick="this.parentElement.classList.toggle('expanded')">
                <div>
                    <div class="co-card-name">${c.name}</div>
                    <div class="co-card-meta">${c.nodes.length} contacts in vault &middot; ${tags.map(t=>`<span class="tag-chip">${t}</span>`).join('')}</div>
                </div>
                <div style="text-align:right;">
                    <div style="font-family:'Outfit';font-weight:900;font-size:1.3rem;color:${sc}">${avgScore}%</div>
                    <div style="font-size:.55rem;color:var(--text-secondary);">${currentMode==='velocity'?'CONV PROB':'INTENT'}</div>
                </div>
            </div>
            <div class="co-card-body">
                <div style="font-size:.6rem;font-weight:900;letter-spacing:1px;color:var(--text-secondary);text-transform:uppercase;margin-bottom:8px;">Top Contacts</div>
                ${top5.map(n=>`<div class="co-contact"><span style="color:#fff;font-weight:600;">${n.name}</span><span style="color:var(--text-secondary);font-size:.65rem;">${n.role||'â€”'}</span><span style="color:${n.convProb>=80?'var(--green)':'var(--gold)'};font-family:'JetBrains Mono';font-size:.65rem;">${n.convProb}%</span></div>`).join('')}
                <div style="display:flex;gap:8px;margin-top:14px;flex-wrap:wrap;">
                    <button class="draft-btn" onclick="filterToCompany('${c.name.replace(/'/g,'')}');showToast('ğŸ§  Vault filtered: ${c.name.replace(/'/g,'')}')" style="color:var(--cyan);border-color:var(--cyan);">ğŸ§  Filter Vault</button>
                    <button class="draft-btn" onclick="addTopToday('${c.name.replace(/'/g,'')}')" style="color:var(--gold);border-color:var(--gold);">âš¡ Add to Cadence</button>
                    <button class="draft-btn" onclick="window.open('https://www.crunchbase.com/organization/${encodeURIComponent(c.name)}')">ğŸ“ˆ Crunchbase</button>
                    <button class="draft-btn" onclick="window.open('https://news.google.com/search?q=${encodeURIComponent(c.name)}')">ğŸ“° News</button>
                </div>
            </div>`;
        list.appendChild(card);
    });
    if(!entries.length) list.innerHTML='<div style="color:var(--text-secondary);font-size:.75rem;padding:20px 0;">No companies found.</div>';
}
function filterToCompany(co) {
    filteredNodes = allNodes.filter(n=>(n.company||'').toLowerCase().includes(co.toLowerCase()));
    renderTable(); switchPanel(3);
}
function addTopToday(co) {
    const top = allNodes.filter(n=>(n.company||'').toLowerCase().includes(co.toLowerCase())).sort((a,b)=>b.convProb-a.convProb).slice(0,3);
    top.forEach(n=>addToKanban(n,'contacted'));
    switchPanel(4); generateCadence();
    showToast(`âš¡ ${top.length} ${co} contacts added to cadence`);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PANEL 8: Industry Intelligence Cards
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildIndustries() {
    if(!allNodes.length) return;
    const map = {};
    allNodes.forEach(n=>{
        const ind = inferIndustry(n);
        if(!map[ind]) map[ind]={name:ind,nodes:[],companies:new Set()};
        map[ind].nodes.push(n);
        if(n.company) map[ind].companies.add(n.company);
    });
    const entries = Object.values(map).sort((a,b)=>b.nodes.length-a.nodes.length).slice(0,15);
    const list = document.getElementById('industryList');
    list.innerHTML='';
    entries.forEach(ind=>{
        const avgScore = Math.round(ind.nodes.reduce((s,n)=>s+(currentMode==='velocity'?n.convProb:n.intentScore),0)/ind.nodes.length);
        const topCos = [...ind.companies].slice(0,5);
        const topContacts = ind.nodes.sort((a,b)=>b.convProb-a.convProb).slice(0,5);
        const sc=avgScore>=80?'var(--green)':avgScore>=65?'var(--gold)':'var(--red)';
        const card=document.createElement('div');
        card.className='co-card';
        card.innerHTML=`
            <div class="co-card-header" onclick="this.parentElement.classList.toggle('expanded')">
                <div>
                    <div class="co-card-name">${ind.name}</div>
                    <div class="co-card-meta">${ind.nodes.length.toLocaleString()} contacts &middot; ${ind.companies.size} companies</div>
                </div>
                <div style="text-align:right;">
                    <div style="font-family:'Outfit';font-weight:900;font-size:1.3rem;color:${sc}">${avgScore}%</div>
                    <div style="font-size:.55rem;color:var(--text-secondary);">AVG SCORE</div>
                </div>
            </div>
            <div class="co-card-body">
                <div style="font-size:.6rem;font-weight:900;letter-spacing:1px;color:var(--text-secondary);text-transform:uppercase;margin-bottom:8px;">Top Companies</div>
                <div style="margin-bottom:12px;">${topCos.map(c=>`<span class="tag-chip" style="cursor:pointer;" onclick="filterToCompany('${c.replace(/'/g,'')}')">${c}</span>`).join('')}</div>
                <div style="font-size:.6rem;font-weight:900;letter-spacing:1px;color:var(--text-secondary);text-transform:uppercase;margin-bottom:8px;">Hottest Contacts</div>
                ${topContacts.map(n=>`<div class="co-contact"><span style="color:#fff;font-weight:600;">${n.name}</span><span style="color:var(--text-secondary);font-size:.65rem;">${n.company||'â€”'}</span><span style="color:${n.convProb>=80?'var(--green)':'var(--gold)'};font-family:'JetBrains Mono';font-size:.65rem;">${n.convProb}%</span></div>`).join('')}
                <div style="display:flex;gap:8px;margin-top:14px;flex-wrap:wrap;">
                    <button class="draft-btn" onclick="filterToIndustry('${ind.name}');showToast('Vault filtered: ${ind.name}')" style="color:var(--cyan);border-color:var(--cyan);">ğŸ§  Filter Vault</button>
                    <button class="draft-btn" onclick="window.open('https://news.google.com/search?q=${encodeURIComponent(ind.name+' industry 2026')}')">ğŸ“° Industry News</button>
                </div>
            </div>`;
        list.appendChild(card);
    });
}
function filterToIndustry(ind) {
    filteredNodes = allNodes.filter(n=>inferIndustry(n)===ind);
    renderTable(); switchPanel(3);
    showToast(`ğŸ­ Vault filtered: ${ind} (${filteredNodes.length} nodes)`);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PANEL 9: Analytics Dashboard
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildAnalytics() {
    if(!allNodes.length) return;
    const mount = document.getElementById('analyticsMount');
    const total = allNodes.length;
    const vecPct = vectorsReady>0?Math.round(vectorsReady/total*100):0;
    const avgProb = Math.round(allNodes.reduce((s,n)=>s+n.convProb,0)/total);
    const hot = allNodes.filter(n=>n.convProb>=80).length;
    const warm = allNodes.filter(n=>n.convProb>=60&&n.convProb<80).length;
    const cold = allNodes.filter(n=>n.convProb<60).length;
    // Top industries
    const indMap={};
    allNodes.forEach(n=>{const i=inferIndustry(n);indMap[i]=(indMap[i]||0)+1;});
    const topInds=Object.entries(indMap).sort((a,b)=>b[1]-a[1]).slice(0,6);
    const maxInd=topInds[0]?.[1]||1;
    // Top companies
    const coMap={};
    allNodes.forEach(n=>{if(n.company){coMap[n.company]=(coMap[n.company]||0)+1;}});
    const topCos=Object.entries(coMap).sort((a,b)=>b[1]-a[1]).slice(0,6);
    const maxCo=topCos[0]?.[1]||1;
    // Pipeline
    const pipe=kanbanData;
    mount.innerHTML=`
        <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px;">
            <div class="stat-card"><div class="stat-val">${total.toLocaleString()}</div><div class="stat-label">Total Nodes</div></div>
            <div class="stat-card"><div class="stat-val" style="color:var(--green)">${vecPct}%</div><div class="stat-label">Vectorized</div></div>
            <div class="stat-card"><div class="stat-val" style="color:var(--gold)">${avgProb}%</div><div class="stat-label">Avg Conv Prob</div></div>
            <div class="stat-card"><div class="stat-val" style="color:var(--cyan)">${hot.toLocaleString()}</div><div class="stat-label">HOT Nodes (80%+)</div></div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;">
            <div style="background:rgba(15,18,26,.5);border:1px solid var(--border);border-radius:12px;padding:18px;">
                <div style="font-size:.62rem;font-weight:900;letter-spacing:2px;color:var(--text-secondary);text-transform:uppercase;margin-bottom:14px;">Top Industries</div>
                ${topInds.map(([n,c])=>`<div class="bar-row"><div class="bar-label">${n}</div><div style="flex:1;"><div class="bar-fill" style="width:${Math.round(c/maxInd*100)}%"></div></div><div class="bar-count">${c.toLocaleString()}</div></div>`).join('')}
            </div>
            <div style="background:rgba(15,18,26,.5);border:1px solid var(--border);border-radius:12px;padding:18px;">
                <div style="font-size:.62rem;font-weight:900;letter-spacing:2px;color:var(--text-secondary);text-transform:uppercase;margin-bottom:14px;">Top Companies</div>
                ${topCos.map(([n,c])=>`<div class="bar-row"><div class="bar-label">${n}</div><div style="flex:1;"><div class="bar-fill" style="width:${Math.round(c/maxCo*100)}%;background:linear-gradient(90deg,var(--cyan),var(--green));"></div></div><div class="bar-count">${c.toLocaleString()}</div></div>`).join('')}
            </div>
        </div>
        <div style="background:rgba(15,18,26,.5);border:1px solid var(--border);border-radius:12px;padding:18px;margin-bottom:16px;">
            <div style="font-size:.62rem;font-weight:900;letter-spacing:2px;color:var(--text-secondary);text-transform:uppercase;margin-bottom:14px;">Conversation Pipeline Health</div>
            <div style="display:flex;gap:0;">
                <div class="pipe-stage"><div class="pipe-num" style="color:var(--text-secondary)">${(pipe.saved||[]).length}</div><div class="pipe-lbl">Saved</div></div>
                <div style="align-self:center;color:var(--border);font-size:1.2rem;">&rsaquo;</div>
                <div class="pipe-stage"><div class="pipe-num" style="color:var(--cyan)">${(pipe.contacted||[]).length}</div><div class="pipe-lbl">Contacted</div></div>
                <div style="align-self:center;color:var(--border);font-size:1.2rem;">&rsaquo;</div>
                <div class="pipe-stage"><div class="pipe-num" style="color:var(--accent)">${(pipe.call||[]).length}</div><div class="pipe-lbl">Call</div></div>
                <div style="align-self:center;color:var(--border);font-size:1.2rem;">&rsaquo;</div>
                <div class="pipe-stage"><div class="pipe-num" style="color:var(--gold)">${(pipe.interview||[]).length}</div><div class="pipe-lbl">Interview</div></div>
                <div style="align-self:center;color:var(--border);font-size:1.2rem;">&rsaquo;</div>
                <div class="pipe-stage"><div class="pipe-num" style="color:var(--green)">${(pipe.offer||[]).length}</div><div class="pipe-lbl">Offer</div></div>
            </div>
        </div>
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;">
            <div class="stat-card"><div class="stat-val" style="color:var(--green)">${hot.toLocaleString()}</div><div class="stat-label">ğŸ”¥ HOT (80%+)</div></div>
            <div class="stat-card"><div class="stat-val" style="color:var(--gold)">${warm.toLocaleString()}</div><div class="stat-label">ğŸŒ¡ WARM (60â€“80%)</div></div>
            <div class="stat-card"><div class="stat-val" style="color:var(--text-secondary)">${cold.toLocaleString()}</div><div class="stat-label">â„ COLD (&lt;60%)</div></div>
        </div>`;
}

function generateCadence() {
    if(!allNodes.length) return;
    const top = [...allNodes].sort((a,b)=>b.convProb-a.convProb).slice(0,10);
    const list = document.getElementById('cadenceList');
    list.innerHTML = '';
    top.forEach((node,i)=>{
        const pri = node.convProb>=80?'pri-hot':node.convProb>=65?'pri-warm':'pri-cold';
        const priLabel = node.convProb>=80?'ğŸ”¥ HOT':node.convProb>=65?'ğŸŒ¡ WARM':'â„ COLD';
        const action = ACTIONS[i%ACTIONS.length];
        const wi = warmIntroScore(node);
        const draft = draftMessage(node);
        const draftId = `draft-${i}-${Date.now()}`;
        const el = document.createElement('div');
        el.style.cssText = 'border:1px solid rgba(255,255,255,.07);border-radius:11px;padding:14px 16px;background:rgba(0,0,0,.3);margin-bottom:10px;transition:.2s;';
        el.innerHTML = `
            <div style="display:flex;align-items:center;gap:12px;cursor:pointer;" onclick="this.parentElement.querySelector('.draft-box').classList.toggle('show')">
                <span class="cadence-pri ${pri}">${priLabel}</span>
                <div style="flex:1">
                    <div style="font-weight:700;color:#fff;font-size:.85rem;">${node.name} <span style="color:var(--text-secondary);font-weight:400;font-size:.7rem;">@ ${node.company||'Unknown'}</span></div>
                    <div style="font-size:.7rem;color:var(--text-secondary);margin-top:2px;">${node.role||action} &middot; <span style="color:var(--green)">ğŸ¤ Intro ${wi}%</span></div>
                </div>
                <div style="font-family:'Outfit';font-weight:900;font-size:.95rem;color:${node.convProb>=80?'var(--green)':node.convProb>=65?'var(--gold)':'var(--text-secondary)'}">${node.convProb}%</div>
                <span style="font-size:.6rem;color:var(--text-secondary);user-select:none;">â–¼ draft</span>
            </div>
            <div class="draft-box" id="${draftId}">${draft}<div class="draft-actions">
                <button class="draft-btn" onclick="navigator.clipboard.writeText(document.getElementById('${draftId}').firstChild?.nodeValue?.trim()||'');showToast('ğŸ“‹ Copied!')">ğŸ“‹ Copy</button>
                <button class="draft-btn" onclick="addToKanban(allNodes.find(n=>n.id==='${node.id}'),'contacted');showToast('âœ… ${node.name.replace(/'/g,'')} â†’ Contacted');this.style.color='var(--green)'">âœ… Log Contacted</button>
                <button class="draft-btn" onclick="window.open('https://linkedin.com/search/results/people/?keywords=${encodeURIComponent(node.name+' '+(node.company||''))}')">ğŸ”— LinkedIn</button>
                <button class="draft-btn" onclick="window.open('https://x.com/search?q=${encodeURIComponent(node.name)}')">ğ• X</button>
            </div></div>`;
        list.appendChild(el);
    });
    document.getElementById('cadenceBadge').textContent = Math.min(10, top.length);
}

function buildKanban() {
    // Pre-seed with NOW nodes â†’ call, high-score NEXT â†’ contacted, STUCK â†’ interview
    kanbanData.saved = allNodes.filter(n=>n.intentScore>70&&n.status==='NEXT').slice(0,3);
    kanbanData.contacted = allNodes.filter(n=>n.status==='NOW').slice(0,2);
    kanbanData.call = allNodes.filter(n=>n.intentScore>80).slice(0,1);
    renderKanban();
}
function addToKanban(node, col) {
    if(!kanbanData[col]) kanbanData[col]=[];
    if(!kanbanData[col].find(n=>n.id===node.id)) { kanbanData[col].push(node); renderKanban(); }
}
function renderKanban() {
    ['saved','contacted','call','interview','offer'].forEach(col=>{
        const el=document.getElementById(`col-${col}`);
        if(!el) return;
        el.innerHTML='';
        const nodes=kanbanData[col]||[];
        if(!nodes.length){el.innerHTML='<div class="kanban-empty">Drop nodes here</div>';return;}
        nodes.forEach(n=>{
            const c=document.createElement('div');
            c.className='kanban-card';
            c.innerHTML=`<div class="kanban-card-name">${n.name}</div><div class="kanban-card-co">${n.company||'â€”'}</div><div class="kanban-card-score" style="color:var(--green)">${n.convProb}% conv prob</div>`;
            el.appendChild(c);
        });
    });
}

function buildRadar() {
    const grid=document.getElementById('radarGrid');
    if(!grid) return;
    grid.innerHTML='';
    const targets = TARGET_COMPANIES.slice(0,6).map(co=>{
        // Pull REAL contacts from vault matching this company
        const nodes = allNodes.filter(n=>n.company?.toLowerCase().includes(co.toLowerCase()));
        const avgScore = nodes.length>0 ? Math.round(nodes.reduce((s,n)=>s+n.convProb,0)/nodes.length) : 68;
        const topContacts = nodes.sort((a,b)=>b.convProb-a.convProb).slice(0,4);
        return {co, nodes, avgScore, topContacts};
    });
    targets.forEach(t=>{
        const card=document.createElement('div');
        card.className='radar-card';
        const qs=generatePrepQuestions(t.co);
        const contactHTML = t.topContacts.length>0
            ? t.topContacts.map(n=>`<div style="display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid var(--border);font-size:.7rem;"><span style="color:#fff;font-weight:600;">${n.name}</span><span style="color:var(--text-secondary);">${n.role||'â€”'}</span><span style="color:var(--green);font-family:'JetBrains Mono';">${n.convProb}%</span></div>`).join('')
            : '<div style="font-size:.7rem;color:var(--text-secondary);padding:8px 0;">No contacts in vault yet â€” add CSVs to 11_DATA_FEEDS/</div>';
        card.innerHTML=`
            <div style="display:flex;justify-content:space-between;align-items:flex-start;">
                <div>
                    <div class="radar-company">${t.co}</div>
                    <div class="radar-role">${t.nodes.length} contacts in vault</div>
                </div>
                <div style="text-align:right;">
                    <div style="font-family:'Outfit';font-weight:900;font-size:1.4rem;color:${t.avgScore>=75?'var(--green)':t.avgScore>=60?'var(--gold)':'var(--red)'}">${t.avgScore}%</div>
                    <div style="font-size:.55rem;color:var(--text-secondary);">AVG CONV SCORE</div>
                </div>
            </div>
            <div class="radar-questions" style="margin-top:10px;">
                <div style="font-size:.58rem;font-weight:900;letter-spacing:1px;color:var(--text-secondary);text-transform:uppercase;margin-bottom:6px;">Live Contacts</div>
                ${contactHTML}
                <div style="font-size:.58rem;font-weight:900;letter-spacing:1px;color:var(--text-secondary);text-transform:uppercase;margin:10px 0 6px;">Prep Questions</div>
                ${qs.map(q=>`<div class="radar-q">â€¢ ${q}</div>`).join('')}
            </div>`;
        card.onclick=()=>card.classList.toggle('expanded');
        grid.appendChild(card);
    });
}

function generatePrepQuestions(company) {
    const map={
        'Replit':['How does Replit plan to monetize enterprise teams?','What does GTM look like for AI-native companies?','How do you measure Customer Success velocity?','What\'s the onboarding funnel for pro users?','How do you balance developer experience vs enterprise needs?'],
        'Go Nimbly':['What RevOps motions are most broken in mid-market?','How does GTM consulting charge differently than implementation?','What does your ideal CS hire look like?','How do you scope a fractional engagement?','What signals tell you a client is ready to expand?'],
        'Descope':['How does identity management intersect with revenue motions?','What triggers most identity vendor switches?','How do you position passkeys vs traditional MFA?','What does enterprise onboarding look like?','How does the CS team handle SOC2 requirements for clients?'],
    };
    return map[company]||[
        `What does the CS motion look like at ${company}?`,
        `How does ${company} define customer health?`,
        `What\'s the biggest GTM challenge ${company} faces?`,
        `How does ${company} handle enterprise onboarding?`,
        `What does the ideal CS hire look like for ${company}?`,
    ];
}

function buildScoreDistrib() {
    if(!allNodes.length) return;
    document.getElementById('scoreHot').textContent = allNodes.filter(n=>n.convProb>=80).length.toLocaleString();
    document.getElementById('scoreWarm').textContent = allNodes.filter(n=>n.convProb>=60&&n.convProb<80).length.toLocaleString();
    document.getElementById('scoreCold').textContent = allNodes.filter(n=>n.convProb<60).length.toLocaleString();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Node Detail / Scrub Hub
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openNodeDetail(node) {
    const q=encodeURIComponent(`${node.name} ${node.company}`);
    showToast(`ğŸ” Scrub Hub: ${node.name}`);
    setTimeout(()=>{
        window.open(`https://www.linkedin.com/search/results/people/?keywords=${q}`,'_blank');
        window.open(`https://news.google.com/search?q=${q}`,'_blank');
    },300);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// UI Helpers
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchPanel(idx) {
    document.querySelectorAll('.panel').forEach((p,i)=>p.classList.toggle('active',i===idx));
    document.querySelectorAll('.nav-item').forEach((n,i)=>n.classList.toggle('active',i===idx));
    
    if(idx === 0) buildDestinyMap();
    if(idx === 1) buildSignalFeed();
}

const SIGNAL_MOCK = [
    {id:1, title:'Replit // Series B Round Detected', type:'FUNDING', source:'C-BASE', priority:'ALPHA', time:'2h ago', desc:'Replit has raised $XXM in Series B lead by Andreessen Horowitz. Strategic signal for infrastructure expansion.'},
    {id:4, title:'Raj // Signature Pending Alert', type:'SYSTEM', source:'DOCUSIGN', priority:'ALPHA', time:'12h ago', desc:'Payment rail signature for vCISO HUB expansion has been seen but not signed. Nudge required.'}
];

let liveSignals = [...SIGNAL_MOCK];

const RSS_SOURCES = [
    // Industry News & Intelligence
    { name: 'Replit Blog', url: 'https://replit.com/blog/rss.xml', type: 'PRODUCT', category: 'news' },
    { name: 'TechCrunch SaaS', url: 'https://techcrunch.com/tag/saas/feed/', type: 'FUNDING', category: 'news' },
    { name: 'SaaStr', url: 'https://www.saastr.com/feed/', type: 'GTM', category: 'news' },
    { name: 'Crunchbase Funding', url: 'https://news.crunchbase.com/feed/', type: 'FUNDING', category: 'news' },
    { name: 'HubSpot', url: 'https://blog.hubspot.com/blog/rss.xml', type: 'MARKETING', category: 'news' },
    { name: 'Salesforce Ben', url: 'https://www.salesforceben.com/feed/', type: 'CRM', category: 'news' },
    // Google Alert Monitoring (Replace IDs with your real feed IDs from google.com/alerts)
    { name: 'Google Alert: RevOps Hiring', url: 'https://www.google.com/alerts/feeds/1234567/REVOPS', type: 'HIRING', category: 'alert' },
    { name: 'Google Alert: Replit Funding', url: 'https://www.google.com/alerts/feeds/1234567/REPLIT', type: 'FUNDING', category: 'alert' },
    { name: 'Google Alert: GTM AI Strategy', url: 'https://www.google.com/alerts/feeds/1234567/GTM_AI', type: 'STRATEGY', category: 'alert' },
    { name: 'Google Alert: vCISO Market', url: 'https://www.google.com/alerts/feeds/1234567/vCISO', type: 'CONSULTING', category: 'alert' }
];

const JOB_BOARD_SOURCES = [
    // Startup-first boards
    { name: 'YC Jobs: RevOps', url: 'https://www.ycombinator.com/jobs.rss?role=revops', badge: 'YC', color: 'var(--green)' },
    { name: 'YC Jobs: Customer Success', url: 'https://www.ycombinator.com/jobs.rss?role=customer-success', badge: 'YC', color: 'var(--green)' },
    { name: 'YC Jobs: GTM', url: 'https://www.ycombinator.com/jobs.rss?role=go-to-market', badge: 'YC', color: 'var(--green)' },
    // Remote boards
    { name: 'RemoteOK RevOps', url: 'https://remoteok.com/remote-revops-jobs.rss', badge: 'REMOTEâœ“', color: 'var(--cyan)' },
    { name: 'RemoteOK: Customer Success', url: 'https://remoteok.com/remote-customer-success-jobs.rss', badge: 'REMOTEâœ“', color: 'var(--cyan)' },
    { name: 'We Work Remotely: RevOps', url: 'https://weworkremotely.com/remote-revops-jobs.rss', badge: 'WWR', color: 'var(--cyan)' },
    { name: 'Startup.jobs RevOps', url: 'https://startup.jobs/rss?query=revops', badge: 'STARTUP', color: 'var(--accent)' },
    { name: 'Startup.jobs vCISO', url: 'https://startup.jobs/rss?query=vciso', badge: 'STARTUP', color: 'var(--accent)' },
    // Community boards
    { name: 'Reddit r/forhire', url: 'https://www.reddit.com/r/forhire/.rss?sort=new', badge: 'REDDIT', color: '#FF4500' },
    { name: 'Reddit r/revops', url: 'https://www.reddit.com/r/revops/.rss', badge: 'REDDIT', color: '#FF4500' },
    { name: 'HN Hiring', url: 'https://hnrss.org/newest?q=hiring+RevOps+OR+GTM+OR+%22Customer+Success%22', badge: 'HN', color: 'var(--gold)' },
    { name: 'Product Hunt Jobs', url: 'https://www.producthunt.com/jobs/rss', badge: 'PHâ›¤', color: '#DA552F' },
    // Wellfound/AngelList
    { name: 'Wellfound: RevOps', url: 'https://wellfound.com/jobs?keywords=RevOps&location=Remote&rss=1', badge: 'WTFD', color: 'var(--pink)' },
    { name: 'Wellfound: vCISO', url: 'https://wellfound.com/jobs?keywords=vCISO&rss=1', badge: 'WTFD', color: 'var(--pink)' }
];

async function classifyWithOllama(sig) {
    if (localStorage.getItem('OLLAMA_OFFLINE') === 'true') return sig;
    try {
        const r = await fetch('http://localhost:11434/api/generate', {
            method: 'POST',
            body: JSON.stringify({
                model: 'llama3.1:8b',
                prompt: `BASIN::NEXUS Signal Classifier. Output JSON only:\nInput: ${sig.title} - ${sig.desc}\n{"title":string,"summary":"2-sentence","priority":"HIGH ALPHA"|"MEDIUM"|"LOW","signalType":"Funding"|"Hiring"|"Product"|"Competitor"|"News","relatedCompany":string|null,"intentScore":0-100}\nHIGH ALPHA=funding/major hire/competitor pivot`,
                stream: false, format: 'json'
            })
        });
        const d = await r.json();
        const ai = JSON.parse(d.response);
        return { ...sig, title:ai.title||sig.title, desc:ai.summary||sig.desc, priority:ai.priority==='HIGH ALPHA'?'ALPHA':ai.priority, type:ai.signalType?.toUpperCase()||sig.type, intentScore:ai.intentScore, relatedCompany:ai.relatedCompany };
    } catch (e) { return sig; }
}

async function classifyJobWithOllama(sig) {
    if (localStorage.getItem('OLLAMA_OFFLINE') === 'true') return sig;
    try {
        const r = await fetch('http://localhost:11434/api/generate', {
            method: 'POST',
            body: JSON.stringify({
                model: 'llama3.1:8b',
                prompt: `BASIN::NEXUS Job Classifier. Output JSON only:\nInput: ${sig.title} - ${sig.desc}\n{"title":string,"company":string,"location":string,"seniority":"VP"|"Head"|"Director"|"Manager"|"IC"|null,"roleType":"RevOps"|"Customer Success"|"GTM"|"vCISO"|"Sales"|"Other","priority":"HIGH ALPHA"|"MEDIUM"|"LOW","intentScore":0-100,"summary":"2-sentence"}\nHIGH ALPHA=VP/Head/Director in RevOps/CS/GTM/vCISO`,
                stream: false, format: 'json'
            })
        });
        const d = await r.json();
        const ai = JSON.parse(d.response);
        return { ...sig, title:`${ai.seniority||''} ${ai.title||sig.title}`.trim(), desc:ai.summary||sig.desc, priority:ai.priority==='HIGH ALPHA'?'ALPHA':ai.priority, intentScore:ai.intentScore, relatedCompany:ai.company };
    } catch (e) { return sig; }
}

async function fetchAllRSS() {
    showToast('ğŸ›°ï¸ Scanning 10+ High-Signal RSS Feeds...');
    const proxy = 'https://api.allorigins.win/get?url=';
    
    // Check if Ollama is accessible
    try {
        await fetch('http://localhost:11434/api/tags');
        localStorage.setItem('OLLAMA_OFFLINE', 'false');
        showToast('ğŸ§  NEXUS_AI: Ollama active // Classifying signals...');
    } catch (e) {
        localStorage.setItem('OLLAMA_OFFLINE', 'true');
        showToast('âš ï¸ NEXUS_AI: Ollama offline // Using rule-based logic');
    }

    for (const source of RSS_SOURCES) {
        try {
            const r = await fetch(proxy + encodeURIComponent(source.url));
            const d = await r.json();
            await parseRSS(d.contents, source);
        } catch (e) {
            console.warn(`Failed to fetch ${source.name}`, e);
        }
    }
    buildSignalFeed();
}

async function parseRSS(xml, source) {
    const parser = new DOMParser();
    const doc = parser.parseFromString(xml, 'text/xml');
    const items = Array.from(doc.querySelectorAll('item')).slice(0, 3);
    
    for (const item of items) {
        const title = item.querySelector('title')?.textContent || '';
        const desc = item.querySelector('description')?.textContent.replace(/<[^>]*>/g, '').slice(0, 200) + '...' || '';
        const link = item.querySelector('link')?.textContent || '#';
        const date = new Date(item.querySelector('pubDate')?.textContent || Date.now());
        
        // Avoid duplicates early
        if (liveSignals.find(s => s.title === title)) continue;

        const isAlpha = /funding|raised|round|hired|join|series|acquisition/i.test(title + desc);
        
        let sig = {
            id: 'rss-' + Math.random().toString(36).substr(2, 9),
            title: title,
            type: source.type,
            source: source.name.toUpperCase(),
            priority: isAlpha ? 'ALPHA' : 'MEDIUM',
            time: formatTime(date),
            desc: desc,
            url: link,
            intentScore: isAlpha ? 85 : 40
        };
        
        // Run AI classification
        sig = await classifyWithOllama(sig);
        
        liveSignals.unshift(sig);
    }
}

function formatTime(date) {
    const hours = Math.round((new Date() - date) / 36e5);
    return hours <= 0 ? 'Just now' : hours < 24 ? `${hours}h ago` : `${Math.round(hours/24)}d ago`;
}

function buildSignalFeed() {
    const mount = document.getElementById('signalListMount');
    if(!mount) return;
    mount.innerHTML = '';
    
    liveSignals.sort((a,b) => (a.priority === 'ALPHA' ? -1 : 1)).forEach(sig => {
        const card = document.createElement('div');
        card.className = `signal-card ${sig.priority==='ALPHA'?'alpha':''}`;
        card.dataset.type = sig.type;
        card.dataset.source = sig.badge || sig.source;
        card.style.cursor = 'pointer';
        card.onclick = (e) => {
            if (e.target.tagName !== 'BUTTON') window.open(sig.url || '#', '_blank');
        };

        const icon = sig.category === 'job' ? 'ğŸ’¼' : sig.type==='FUNDING'?'ğŸ’°':sig.type==='HIRING'?'ğŸ‘”':sig.type==='PRODUCT'?'ğŸš€':sig.type==='SYSTEM'?'âš¡':'ğŸ›°ï¸';
        const badgeHtml = sig.badge
            ? `<span style="font-family:'JetBrains Mono';font-size:.45rem;font-weight:900;background:${sig.badgeColor||'var(--accent)'};color:#000;padding:2px 7px;border-radius:3px;letter-spacing:1px;">${sig.badge}</span>`
            : '';
        
        card.innerHTML = `
            <div class="signal-icon-box">${icon}</div>
            <div class="signal-card-main">
                <div class="signal-header">
                    <div style="display:flex; gap:6px; align-items:center;">
                        <span class="signal-type-badge ${sig.priority==='ALPHA'?'signal-type-alpha':sig.type==='FUNDING'?'signal-type-funding':sig.type==='HIRING'?'signal-type-hiring':''}">
                            ${sig.type} ${sig.priority==='ALPHA'?'// HIGH ALPHA':''}
                        </span>
                        ${badgeHtml}
                        ${sig.intentScore ? `<span style="font-family:'JetBrains Mono'; font-size:.5rem; color:var(--cyan); border:1px solid var(--cyan); padding:1px 5px; border-radius:3px; font-weight:900;">INTENT: ${sig.intentScore}</span>` : ''}
                    </div>
                    <span class="signal-time">${sig.time}</span>
                </div>
                <div class="signal-card-title">${sig.title}</div>
                ${sig.relatedCompany ? `<div style="font-family:'Outfit'; font-size:.65rem; color:var(--accent); font-weight:900; margin-top:2px; text-transform:uppercase; letter-spacing:1px;">Target: ${sig.relatedCompany}</div>` : ''}
                <div class="signal-card-desc">${sig.desc}</div>
                <div class="signal-card-footer">
                    <div class="signal-source" style="${sig.source.includes('GOOGLE ALERT') ? 'color:var(--gold);' : ''}">
                        ${sig.source} INTEGRATION // STATUS: ${localStorage.getItem('OLLAMA_OFFLINE')==='true'?'VERIFIED':'AI_ENRICHED'}
                    </div>
                    <div class="signal-actions-row">
                        <button class="sig-btn primary" onclick="event.stopPropagation(); showToast('Action logged: Nudge sent')">NUDGE</button>
                        <button class="sig-btn" onclick="event.stopPropagation(); showToast('Target added to daily cadence')">ADD TO CADENCE</button>
                        <button class="sig-btn" onclick="event.stopPropagation(); showToast('Scrubbing data...')">SCRUB</button>
                    </div>
                </div>
            </div>
        `;
        mount.appendChild(card);
    });
}

async function fetchAllJobBoards() {
    showToast('ğŸ’¼ Scanning 14 Job Boards // YC, Wellfound, HN, Reddit, RemoteOK...');
    const proxy = 'https://api.allorigins.win/get?url=';
    
    try {
        await fetch('http://localhost:11434/api/tags');
        localStorage.setItem('OLLAMA_OFFLINE', 'false');
    } catch (e) {
        localStorage.setItem('OLLAMA_OFFLINE', 'true');
    }

    for (const board of JOB_BOARD_SOURCES) {
        try {
            const r = await fetch(proxy + encodeURIComponent(board.url));
            const d = await r.json();
            await parseJobRSS(d.contents, board);
        } catch (e) {
            console.warn(`Job board failed: ${board.name}`, e);
        }
    }
    buildSignalFeed();
    showToast(`âœ“ Job scan complete // ${liveSignals.filter(s=>s.category==='job').length} hiring signals`);
}

async function parseJobRSS(xml, board) {
    const parser = new DOMParser();
    const doc = parser.parseFromString(xml, 'text/xml');
    const items = Array.from(doc.querySelectorAll('item')).slice(0, 4);
    
    for (const item of items) {
        const title = item.querySelector('title')?.textContent || '';
        const desc = (item.querySelector('description')?.textContent || '').replace(/<[^>]*>/g,'').slice(0,180)+'...';
        const link = item.querySelector('link')?.textContent || '#';
        const date = new Date(item.querySelector('pubDate')?.textContent || Date.now());
        
        if (liveSignals.find(s => s.title === title)) continue;
        
        const isSenior = /\bVP\b|\bHead\b|\bDirector\b|\bPrincipal\b/i.test(title);
        const isRevOps = /RevOps|Revenue Ops|GTM|vCISO|Customer Success/i.test(title+desc);
        
        let sig = {
            id: 'job-' + Math.random().toString(36).substr(2,9),
            title: title,
            type: 'HIRING',
            source: board.name.toUpperCase(),
            priority: (isSenior && isRevOps) ? 'ALPHA' : isRevOps ? 'MEDIUM' : 'LOW',
            time: formatTime(date),
            desc: desc,
            url: link,
            intentScore: isSenior ? 88 : isRevOps ? 62 : 35,
            badge: board.badge,
            badgeColor: board.color,
            category: 'job'
        };
        sig = await classifyJobWithOllama(sig);
        liveSignals.unshift(sig);
    }
}

async function fetchAllXSignals() {
    showToast('ğ• Scanning X for keywords: RevOps, Replit, GTM...');
    const keywords = ['RevOps hiring', 'Replit funding', 'vCISO fractional', 'GTM AI startup'];
    const proxy = 'https://api.allorigins.win/get?url=';
    
    for (const q of keywords) {
        try {
            // Simulated search via Nitter or other open proxies since direct X is closed
            const searchUrl = `https://nitter.net/search?f=tweets&q=${encodeURIComponent(q)}&since=1d`;
            const r = await fetch(proxy + encodeURIComponent(searchUrl));
            const d = await r.json();
            parseXSignals(d.contents, q);
        } catch (e) {
            console.warn(`X scan failed for: ${q}`, e);
        }
    }
    buildSignalFeed();
}

function parseXSignals(html, query) {
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, 'text/html');
    const tweets = Array.from(doc.querySelectorAll('.timeline-item')).slice(0, 5);
    
    tweets.forEach(async t => {
        const text = t.querySelector('.tweet-content')?.textContent || '';
        const user = t.querySelector('.username')?.textContent || 'anonymous';
        const link = 'https://x.com' + (t.querySelector('.tweet-link')?.getAttribute('href') || '');
        const timeStr = t.querySelector('.tweet-date a')?.getAttribute('title') || 'Just now';
        
        if (liveSignals.find(s => s.desc === text)) return;

        let sig = {
            id: 'x-' + Math.random().toString(36).substr(2, 9),
            title: `ğ• Signal: @${user}`,
            type: query.toUpperCase().includes('HIRING') ? 'HIRING' : query.toUpperCase().includes('FUNDING') ? 'FUNDING' : 'NEWS',
            source: 'X_MONITOR',
            badge: 'ğ•',
            badgeColor: '#1DA1F2',
            priority: query.toUpperCase().includes('ALPHA') ? 'ALPHA' : 'MEDIUM',
            time: 'Recent',
            desc: text,
            url: link,
            category: 'x'
        };

        // Run AI classification if online
        sig = await classifyWithOllama(sig);
        liveSignals.unshift(sig);
    });
}

function filterSignals(type, btn) {
    document.querySelectorAll('.signal-feed-wrap .fpill').forEach(p=>p.classList.remove('active'));
    btn.classList.add('active');
    const mount = document.getElementById('signalListMount');
    if(!mount) return;
    const all = mount.querySelectorAll('.signal-card');
    all.forEach(c => {
        const show = type === 'all' ? true
            : type === 'alpha' ? c.classList.contains('alpha')
            : type === 'funding' ? c.dataset.type?.includes('FUNDING')
            : type === 'hiring' ? c.dataset.type?.includes('HIRING')
            : type === 'x' ? c.dataset.source?.includes('ğ•')
            : type === 'remote' ? c.dataset.source?.includes('REMOTE')
            : type === 'startup' ? (c.dataset.source?.includes('YC') || c.dataset.source?.includes('PH') || c.dataset.source?.includes('STARTUP'))
            : true;
        c.style.display = show ? '' : 'none';
    });
}
window.addSignal = function(data) {
    console.log('%cğŸ›°ï¸ NEXUS_INCOMING_SIGNAL: Protocol 23 verified','color:var(--cyan);font-weight:bold;');
    const sig = {
        id: 'external-' + Date.now(),
        ...data,
        priority: data.priority || 'MEDIUM',
        time: 'Just now'
    };
    liveSignals.unshift(sig);
    if (document.getElementById('panel-1').classList.contains('active')) {
        buildSignalFeed();
    }
    showToast(`Incoming Signal: ${sig.title}`);
    return { status: "signal_added", timestamp: new Date().toISOString() };
};

function buildDestinyMap() {
    const mount = document.getElementById('timelinePoints');
    if(!mount) return;
    mount.innerHTML = '';
    
    // Create time markers
    for(let i=0; i<4000; i+=250) {
        const marker = document.createElement('div');
        marker.className = 'timeline-marker';
        marker.style.left = `${i}px`;
        const dateOffset = Math.floor((i-1000)/100);
        const d = new Date(); d.setDate(d.getDate() + dateOffset);
        marker.innerHTML = `<span>${d.toLocaleDateString([],{month:'short',day:'numeric'})}</span>`;
        mount.appendChild(marker);
    }

    const anchors = [
        {name:'REPLIT', x: 800, alpha:true, milestones:[{tag:'STRATEGY',val:'Founding Enterprise Plan', date:'Mar 12'},{tag:'TECH',val:'Auth Migration Audit', date:'Mar 15'}]},
        {name:'GO NIMBLY', x: 1400, alpha:true, milestones:[{tag:'GTM',val:'Tech Prep HUD Audit', date:'Mar 25'},{tag:'CONTRACT',val:'Signature Waiting', date:'Apr 02'}]},
        {name:'DESCOPE', x: 2100, alpha:false, milestones:[{tag:'IMPLEMENT',val:'CS Spec Finalization', date:'Apr 18'},{tag:'QBR',val:'Inaugural Review', date:'Jun 04'}]},
        {name:'RAJ (vCISO)', x: 2800, alpha:true, milestones:[{tag:'PAYMENT',val:'Signature Rail Wait', date:'May 10'},{tag:'LAUNCH',val:'vCISO HUB LIVE', date:'May 22'}]}
    ];

    anchors.forEach(a => {
        const node = document.createElement('div');
        node.className = `anchor-node ${a.alpha?'high-alpha':''}`;
        node.style.left = `${a.x}px`;
        node.style.top = `${50 + (Math.random()*40-20)}%`;
        
        node.innerHTML = `
            <div class="anchor-header">
                <div class="anchor-title">${a.name}</div>
                ${a.alpha?'<span style="color:var(--red);font-size:.5rem;font-weight:950;letter-spacing:1px;">ALPHA</span>':''}
            </div>
            <div class="anchor-milestones">
                ${a.milestones.map(m => `
                    <div class="milestone-item">
                        <span class="milestone-tag">${m.tag}</span>
                        <span>${m.val}</span>
                        <div class="milestone-date">${m.date} // T-MINUS ${Math.floor(Math.random()*20)} DAYS</div>
                    </div>
                `).join('')}
            </div>
        `;
        node.onclick = () => {
            showToast(`Zooming to ${a.name} vault data...`);
            setTimeout(()=>switchPanel(2), 500);
        };
        mount.appendChild(node);
    });
}
function showToast(msg) {
    const t=document.getElementById('toast');
    t.textContent=msg; t.style.display='block';
    setTimeout(()=>t.style.display='none',3500);
}
document.addEventListener('keydown',e=>{
    if(e.shiftKey&&e.key.toLowerCase()==='p'){
        privacyMode=!privacyMode;
        document.body.classList.toggle('privacy-mode',privacyMode);
        showToast(privacyMode?'ğŸ•¶ï¸ PRIVACY SHIELD ON':'ğŸ‘ Privacy Off');
    }
});

window.onload=()=>{
    loadVault();
    setInterval(()=>{
        const n=new Date();
        document.getElementById('systemClock').innerHTML=`${n.toISOString().split('T')[0]} // ${n.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})} PST<br><span style="color:var(--green)">ENCRYPTION_STABLE</span>`;
    },1000);
};
</script>
</body>
</html>
