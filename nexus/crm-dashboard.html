<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NEXUS::CRM | Sovereign Revenue Architecture</title>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  
  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- CSV Parser -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
            mono: ['JetBrains Mono', 'monospace'],
            serif: ['Cinzel', 'serif'],
          },
          colors: {
            gold: {
              400: '#D4AF37',
              500: '#C5A028',
              600: '#B08D23',
            },
            obsidian: '#020617',
            charcoal: '#0F172A',
          }
        }
      }
    }
  </script>

  <style>
    body {
      background-color: #020617;
      background-image: 
        radial-gradient(circle at 50% 0%, rgba(212, 175, 55, 0.05) 0%, transparent 40%),
        radial-gradient(circle at 100% 100%, rgba(15, 23, 42, 1) 0%, transparent 40%);
      color: #e2e8f0;
    }

    /* Glassmorphism Classes */
    .glass-panel {
      background: rgba(15, 23, 42, 0.6);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.05);
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
    }
    
    .glass-header {
      background: rgba(2, 6, 23, 0.8);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(212, 175, 55, 0.1);
    }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: #020617; }
    ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #D4AF37; }

    /* Utilities */
    .text-gold-glow {
      text-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
    }
    
    .card-hover:hover {
      border-color: rgba(212, 175, 55, 0.3);
      transform: translateY(-2px);
      box-shadow: 0 10px 40px -10px rgba(0,0,0,0.5);
    }

    @keyframes pulse-gold {
      0%, 100% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0); }
      50% { box-shadow: 0 0 10px 0 rgba(212, 175, 55, 0.2); }
    }
    .animate-pulse-gold {
      animation: pulse-gold 2s infinite;
    }

    /* EXECUTIVE PRINT SYSTEM */
    #print-brief-template { display: none; }
    
    @media print {
      body * { visibility: hidden; }
      #print-brief-template, #print-brief-template * { visibility: visible; }
      #print-brief-template {
        display: block !important;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        background: white !important;
        color: black !important;
        font-family: 'Cinzel', serif;
        padding: 40px;
      }
      .brief-tag {
        font-family: 'JetBrains Mono', monospace;
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 2px;
        border-bottom: 1px solid #000;
        padding-bottom: 4px;
        margin-bottom: 20px;
      }
      .brief-title { font-size: 28px; font-weight: 700; margin-bottom: 40px; }
      .brief-meta { 
        display: grid; 
        grid-template-columns: 1fr 1fr; 
        gap: 20px; 
        margin-bottom: 40px;
        font-family: 'Inter', sans-serif;
      }
      .meta-block h5 { font-size: 8px; font-weight: 900; text-transform: uppercase; color: #666; margin-bottom: 5px; }
      .meta-block p { font-size: 14px; margin: 0; }
      .intel-section { margin-top: 40px; border-left: 4px solid #000; padding-left: 20px; }
      .intel-header { font-size: 12px; font-weight: 900; text-transform: uppercase; margin-bottom: 10px; }
      .intel-body { font-size: 16px; font-style: italic; line-height: 1.6; }
      .risk-block { 
        margin-top: 50px; 
        padding: 20px; 
        background: #f8f8f8 !important; 
        border: 1px solid #ddd;
        page-break-inside: avoid;
      }
      .decision-footer {
        position: fixed;
        bottom: 40px;
        left: 40px;
        right: 40px;
        border-top: 1px solid #eee;
        padding-top: 10px;
        font-size: 9px;
        font-family: 'JetBrains Mono', monospace;
        display: flex;
        justify-content: space-between;
      }
    }
  </style>
</head>
<body class="h-screen flex flex-col overflow-hidden selection:bg-gold-500/20">

  <!-- SIGNAL REFINERY OVERLAY -->
  <div id="refinery-overlay" class="fixed inset-0 bg-obsidian z-[60] hidden flex-col items-center justify-center">
    <div class="w-96">
      <div class="flex justify-between text-[10px] font-mono mb-2 text-gold-400">
        <span id="refinery-stage">INITIALIZING ENQUIRY...</span>
        <span id="refinery-percent">0%</span>
      </div>
      <div class="h-1 bg-slate-800 rounded-full overflow-hidden mb-8">
        <div id="refinery-bar" class="h-full bg-gold-400 w-0 transition-all duration-100 ease-out"></div>
      </div>
      
      <div class="font-mono text-[10px] text-slate-500 h-32 overflow-hidden border border-slate-800 bg-slate-900/50 p-4 rounded" id="refinery-log">
        <!-- Logs go here -->
      </div>
    </div>
  </div>

  <!-- TOP BAR -->
  <header class="glass-header h-16 flex items-center justify-between px-6 z-50 shrink-0">
    <div class="flex items-center gap-4">
      <button onclick="toggleClientMode()" class="cursor-pointer h-8 w-8 bg-gradient-to-br from-gold-400 to-amber-700 rounded-sm flex items-center justify-center shadow-[0_0_15px_rgba(212,175,55,0.3)] hover:scale-110 transition border-none p-0" id="logo-box">
        <i class="fa-solid fa-cube text-obsidian text-lg" id="logo-icon"></i>
      </button>
      <div>
        <h1 class="font-serif text-lg tracking-widest text-slate-100" id="app-title">BASIN<span class="text-gold-400">::</span>NEXUS</h1>
        <div class="text-[9px] font-mono text-slate-500 tracking-[0.2em] uppercase" id="app-subtitle">Sovereign Revenue Architecture</div>
      </div>
    </div>

    <div class="flex items-center gap-8">
      <!-- Status Indicators -->
      <div class="hidden md:flex gap-4">
        <div class="flex items-center gap-2 px-3 py-1 bg-slate-800/50 border border-slate-700 rounded-full">
          <div class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></div>
          <span class="text-[10px] font-mono uppercase tracking-wider text-slate-400">NEXUS AI ONLINE</span>
        </div>
        <button onclick="toggleHunterMode()" class="flex items-center gap-2 px-3 py-1 bg-slate-800/50 border border-slate-700 rounded-full hover:bg-slate-700 transition opacity-50 hover:opacity-100" id="hunter-btn" title="Activating Executive Search Protocol...">
            <i class="fa-solid fa-crosshairs text-red-500 text-[10px]"></i>
            <span class="text-[10px] font-mono uppercase tracking-wider text-slate-400 hidden xl:inline">Hunter Mode</span>
        </button>
        <button onclick="runRefinerySequence()" class="flex items-center gap-2 px-3 py-1 bg-slate-800/50 border border-slate-700 rounded-full hover:bg-slate-700 transition">
          <i class="fa-solid fa-rotate text-gold-400 text-[10px]"></i>
          <span class="text-[10px] font-mono uppercase tracking-wider text-slate-400">Refresh Data</span>
        </button>
      </div>

      <div class="h-6 w-px bg-slate-800"></div>

      <!-- User Nav -->
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 rounded-full border border-gold-400/30 bg-slate-900 overflow-hidden">
           <img src="https://ui-avatars.com/api/?name=Leon+Basin&background=020617&color=D4AF37&font-size=0.4" alt="User">
        </div>
      </div>
    </div>
  </header>

  <div class="flex flex-1 overflow-hidden">
    
    <!-- SIDEBAR -->
    <aside class="w-20 lg:w-64 glass-panel border-r-0 border-t-0 border-b-0 border-l-0 border-r border-white/5 flex flex-col shrink-0 z-40">
      
      <!-- Nav Items -->
      <nav class="flex-1 py-8 flex flex-col gap-2 px-3">
        
        <div class="px-3 mb-2 text-[10px] font-mono uppercase text-slate-600 hidden lg:block">Command</div>
        
        <!-- Active War Room Filter -->
        <button onclick="resetFilters()" class="flex items-center gap-4 px-3 py-3 rounded-lg bg-gold-500/10 border border-gold-500/20 text-gold-500 group transition-all text-left w-full">
          <i class="fa-solid fa-layer-group w-5 text-center group-hover:scale-110 transition"></i>
          <span class="font-medium hidden lg:block">Signal Feed</span>
        </button>

        <button onclick="toggleRevenueHealth()" class="flex items-center gap-4 px-3 py-3 rounded-lg text-slate-400 hover:bg-slate-800/50 hover:text-slate-100 group transition-all text-left w-full outline-none focus:bg-slate-800/50">
          <i class="fa-solid fa-chart-line w-5 text-center group-hover:scale-110 transition"></i>
          <span class="font-medium hidden lg:block">Revenue Health</span>
        </button>

        <button onclick="toggleMarketIntel()" class="flex items-center gap-4 px-3 py-3 rounded-lg text-slate-400 hover:bg-slate-800/50 hover:text-slate-100 group transition-all text-left w-full outline-none focus:bg-slate-800/50">
          <i class="fa-solid fa-brain w-5 text-center group-hover:scale-110 transition"></i>
          <span class="font-medium hidden lg:block">Market Intel</span>
        </button>

        <div class="my-4 h-px bg-slate-800 mx-2"></div>

        <div class="px-3 mb-2 text-[10px] font-mono uppercase text-slate-600 hidden lg:block">Refinery Segments</div>

        <!-- Tech Stack Filters -->
        <button onclick="filterByTech('salesforce')" class="flex items-center gap-4 px-3 py-2 rounded-lg text-slate-500 hover:bg-slate-800/30 hover:text-blue-400 group transition-all text-sm w-full text-left">
          <i class="fa-brands fa-salesforce w-5 text-center"></i>
          <span class="hidden lg:block">Salesforce Ops</span>
        </button>

        <button onclick="filterByTech('hubspot')" class="flex items-center gap-4 px-3 py-2 rounded-lg text-slate-500 hover:bg-slate-800/30 hover:text-orange-400 group transition-all text-sm w-full text-left">
          <i class="fa-brands fa-hubspot w-5 text-center"></i>
          <span class="hidden lg:block">HubSpot Users</span>
        </button>
        
        <button onclick="filterBySource('Founder List')" class="flex items-center gap-4 px-3 py-2 rounded-lg text-slate-500 hover:bg-slate-800/30 hover:text-purple-400 group transition-all text-sm w-full text-left">
          <i class="fa-solid fa-rocket w-5 text-center"></i>
          <span class="hidden lg:block">Founder List</span>
        </button>

      </nav>

      <!-- Bottom Widget -->
      <div class="p-4 hidden lg:block">
        <div class="rounded-xl bg-gradient-to-b from-slate-800/50 to-slate-900/80 border border-white/5 p-4">
          <div class="flex items-center gap-2 mb-3">
            <i class="fa-solid fa-shield-halved text-gold-400"></i>
            <span class="text-xs font-bold text-white">Sovereignty Score</span>
          </div>
          <div class="flex justify-between items-end mb-1">
            <span class="text-2xl font-mono text-white">94%</span>
            <span class="text-[10px] text-emerald-400 mb-1">Strategic Command</span>
          </div>
          <div class="w-full bg-slate-700 h-1 rounded-full overflow-hidden">
            <div class="bg-gold-400 h-full w-[94%]"></div>
          </div>
          <div class="mt-2 text-[10px] text-slate-500">System Fully Operational</div>
        </div>
      </div>
    </aside>

    <!-- CONTENT AREA -->
    <main class="flex-1 flex flex-col min-w-0 bg-obsidian relative">
      
      <!-- Background Grid -->
      <div class="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 pointer-events-none"></div>
      
      <!-- Toolbar -->
      <div class="p-6 relative z-10" id="main-dashboard-header">
        <!-- Dashboard Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <div class="glass-panel rounded-xl p-5 border-l-4 border-l-gold-500/50">
                <div class="text-slate-500 text-[10px] font-mono uppercase tracking-widest mb-1">Active Signals</div>
                <div class="text-3xl font-mono text-white tracking-tighter" id="stat-total-leads">0</div>
            </div>
            <div class="glass-panel rounded-xl p-5 border-l-4 border-l-blue-500/50">
                <div class="text-slate-500 text-[10px] font-mono uppercase tracking-widest mb-1">Enriched Data Points</div>
                <div class="text-3xl font-mono text-white tracking-tighter" id="stat-total-companies">0</div>
            </div>
            <div class="glass-panel rounded-xl p-5 border-l-4 border-l-red-500/50">
                <div class="text-slate-500 text-[10px] font-mono uppercase tracking-widest mb-1">High Probability</div>
                <div class="text-3xl font-mono text-white tracking-tighter" id="stat-high-priority">0</div>
            </div>
            <div class="glass-panel rounded-xl p-5 border-l-4 border-l-emerald-500/50">
                <div class="text-slate-500 text-[10px] font-mono uppercase tracking-widest mb-1">System Status</div>
                <div class="text-2xl font-mono text-emerald-400 tracking-tighter">ONLINE</div>
            </div>
        </div>

        <div class="flex flex-col md:flex-row gap-4 justify-between items-end md:items-center">
            <div>
              <h2 class="text-2xl font-serif text-white mb-1" id="page-title">Sovereign Signal Feed</h2>
              <p class="text-sm text-slate-500 font-mono" id="page-subtitle">Real-time enrichment from Basin::Refinery</p>
            </div>

            <div class="flex gap-3 w-full md:w-auto">
              <div class="relative group flex-1 md:w-80">
                <div class="absolute -inset-0.5 bg-gradient-to-r from-gold-500/20 to-purple-600/20 rounded-lg blur opacity-75 group-hover:opacity-100 transition duration-1000 group-hover:duration-200"></div>
                <div class="relative flex items-center">
                   <i class="fa-solid fa-search absolute left-3 text-slate-500"></i>
                   <input type="text" id="searchInput" placeholder="Search target accounts..." class="w-full bg-slate-900/90 text-slate-200 text-sm rounded-lg pl-10 pr-4 py-2.5 border border-slate-700 focus:border-gold-500 focus:outline-none focus:ring-1 focus:ring-gold-500/50 placeholder:text-slate-600 font-mono">
                </div>
              </div>
            </div>
        </div>
      </div>
      
      <!-- REVENUE HEALTH VIEW (Originally Hidden) -->
      <div id="revenue-health-view" class="hidden absolute inset-0 bg-obsidian z-20 p-8 overflow-y-auto">
          <h2 class="text-3xl font-serif text-white mb-8 border-b border-white/10 pb-4">Revenue Lifecycle Health</h2>
          
          <div class="grid grid-cols-3 gap-6 mb-8">
              <div class="glass-panel p-6 rounded-xl">
                  <h4 class="text-xs font-mono uppercase text-slate-400 mb-2">Signal Velocity</h4>
                  <div class="text-4xl font-mono text-gold-400 mb-2">14.2<span class="text-sm text-slate-500 ml-2">days</span></div>
                  <p class="text-[10px] text-slate-500">Avg. time from Signal to Brief Generation</p>
                  <div class="mt-4 h-1 bg-slate-800 rounded w-full"><div class="h-full bg-gold-400 w-[70%]"></div></div>
              </div>
              <div class="glass-panel p-6 rounded-xl">
                  <h4 class="text-xs font-mono uppercase text-slate-400 mb-2">Enrichment Accuracy</h4>
                  <div class="text-4xl font-mono text-emerald-400 mb-2">98.4<span class="text-sm text-slate-500 ml-2">%</span></div>
                  <p class="text-[10px] text-slate-500">Verified contacts vs. Bounces</p>
                  <div class="mt-4 h-1 bg-slate-800 rounded w-full"><div class="h-full bg-emerald-400 w-[98%]"></div></div>
              </div>
              <div class="glass-panel p-6 rounded-xl">
                  <h4 class="text-xs font-mono uppercase text-slate-400 mb-2">Pipeline Conversion</h4>
                  <div class="text-4xl font-mono text-blue-400 mb-2">$4.2M<span class="text-sm text-slate-500 ml-2">influenced</span></div>
                  <p class="text-[10px] text-slate-500">Total pipeline generated Q1 2026</p>
                  <div class="mt-4 h-1 bg-slate-800 rounded w-full"><div class="h-full bg-blue-400 w-[60%]"></div></div>
              </div>
          </div>
          
          <div class="glass-panel p-6 rounded-xl mb-6">
              <h4 class="text-xs font-mono uppercase text-slate-400 mb-4">Live Pipeline Flow</h4>
              <!-- Simple CSS Chart Visualization -->
              <div class="flex items-end gap-2 h-40 border-b border-white/5 pb-2">
                  <div class="flex-1 bg-slate-800 hover:bg-gold-500/50 transition-all rounded-t" style="height: 30%"></div>
                  <div class="flex-1 bg-slate-800 hover:bg-gold-500/50 transition-all rounded-t" style="height: 45%"></div>
                  <div class="flex-1 bg-slate-800 hover:bg-gold-500/50 transition-all rounded-t" style="height: 35%"></div>
                  <div class="flex-1 bg-slate-800 hover:bg-gold-500/50 transition-all rounded-t" style="height: 60%"></div>
                  <div class="flex-1 bg-slate-800 hover:bg-gold-500/50 transition-all rounded-t" style="height: 75%"></div>
                  <div class="flex-1 bg-slate-800 hover:bg-gold-500/50 transition-all rounded-t" style="height: 50%"></div>
                  <div class="flex-1 bg-slate-800 hover:bg-gold-500/50 transition-all rounded-t" style="height: 65%"></div>
                  <div class="flex-1 bg-gold-400 hover:bg-gold-300 transition-all rounded-t relative group" style="height: 85%">
                    <div class="absolute -top-8 left-1/2 -translate-x-1/2 bg-white text-black text-[10px] px-2 py-1 rounded opacity-0 group-hover:opacity-100 whitespace-nowrap">Current Week</div>
                  </div>
                  <div class="flex-1 bg-slate-800 hover:bg-gold-500/50 transition-all rounded-t" style="height: 60%"></div>
                  <div class="flex-1 bg-slate-800 hover:bg-gold-500/50 transition-all rounded-t" style="height: 70%"></div>
              </div>
          </div>
          
           <button onclick="toggleRevenueHealth()" class="px-4 py-2 bg-slate-800 text-white text-xs font-mono rounded border border-white/10 hover:bg-slate-700">Back to Feed</button>
      </div>

      <!-- MARKET INTEL VIEW -->
      <div id="market-intel-view" class="hidden absolute inset-0 bg-obsidian z-20 p-8 overflow-y-auto">
          <h2 class="text-3xl font-serif text-white mb-4 border-b border-white/10 pb-4">Market Intelligence Vault</h2>
          
          <div id="market-intel-content" class="space-y-8">
              <!-- Content injected by JS -->
              <div class="animate-pulse flex flex-col gap-4">
                  <div class="h-8 bg-slate-800 w-1/4 rounded"></div>
                  <div class="grid grid-cols-2 gap-4">
                      <div class="h-32 bg-slate-800 rounded"></div>
                      <div class="h-32 bg-slate-800 rounded"></div>
                  </div>
              </div>
          </div>
          
          <button onclick="toggleMarketIntel()" class="mt-8 px-4 py-2 bg-slate-800 text-white text-xs font-mono rounded border border-white/10 hover:bg-slate-700">Back to Feed</button>
      </div>

      <!-- Feed / Grid -->
      <div class="flex-1 overflow-y-auto px-6 pb-20 scroll-smooth relative z-10" id="feed-container">
        <!-- Loader -->
        <div class="h-full flex flex-col items-center justify-center text-slate-600 gap-4">
          <i class="fa-solid fa-circle-notch fa-spin text-4xl text-gold-400/50"></i>
          <div class="font-mono text-xs tracking-widest uppercase">Initializing Secure Uplink...</div>
        </div>
      </div>

      <!-- Footer Overlay -->
      <div class="absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-t from-obsidian to-transparent pointer-events-none z-20"></div>

      <!-- Nexus Oracle Floating Assistant -->
      <div id="oracle-container" class="fixed bottom-8 right-8 w-96 z-50 transition-all duration-500 transform translate-y-8 opacity-0 pointer-events-none scale-95">
          <div class="glass border border-white/10 rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[500px]">
              <div class="bg-gradient-to-r from-blue-600/30 to-purple-600/30 p-4 border-b border-white/10 flex justify-between items-center">
                  <div class="flex items-center gap-3">
                      <div class="w-2 h-2 rounded-full bg-blue-400 animate-pulse"></div>
                      <span class="text-[10px] font-bold text-white tracking-[0.2em] font-mono">NEXUS::ORACLE</span>
                  </div>
                  <button onclick="toggleOracle()" class="text-slate-400 hover:text-white transition">
                      <i class="fa-solid fa-chevron-down text-sm"></i>
                  </button>
              </div>
              <div id="oracle-messages" class="p-4 overflow-y-auto space-y-4 font-mono text-[10px] text-slate-300 min-h-[250px] bg-slate-950/40">
                  <div class="flex gap-2">
                      <span class="text-blue-400 shrink-0">[SYSTEM]</span>
                      <span>Uplink established. Scanning your 6,336 leads. How shall we orchestrate?</span>
                  </div>
              </div>
              <div class="p-4 border-t border-white/10 bg-slate-900/50">
                  <div class="relative group">
                      <input type="text" id="oracle-input" 
                          class="w-full bg-slate-950/80 border border-slate-800 rounded-lg py-3 px-4 text-[10px] text-white placeholder-slate-600 focus:outline-none focus:border-blue-500/50 font-mono transition-all"
                          placeholder="Ask the Oracle (e.g. 'Outreach plan for Substack')..."
                          onkeyup="handleOracleKey(event)">
                      <button onclick="askOracle()" class="absolute right-3 top-2.5 text-blue-400 hover:text-white transition">
                          <i class="fa-solid fa-paper-plane text-xs"></i>
                      </button>
                  </div>
              </div>
          </div>
      </div>

      <button id="oracle-pill" onclick="toggleOracle()" class="fixed bottom-8 right-8 px-6 py-4 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white rounded-full shadow-[0_0_20px_rgba(37,99,235,0.3)] flex items-center gap-3 z-40 transition-all hover:scale-105 border border-white/20 group">
          <div class="relative">
              <i class="fa-solid fa-ghost text-sm group-hover:animate-bounce"></i>
              <div class="absolute -top-1 -right-1 w-2 h-2 bg-emerald-400 rounded-full border border-obsidian animate-ping"></div>
          </div>
          <span class="font-mono text-xs font-bold tracking-[0.2em]">ORACLE</span>
      </button>

    </main>

    <!-- DETAIL PANEL (Right) -->
    <aside class="w-96 glass-panel border-l border-white/5 hidden xl:flex flex-col p-6 gap-6 shrink-0 z-30">
        <div>
            <h3 class="text-xs font-mono uppercase text-slate-500 mb-4 tracking-widest">Selected Target</h3>
            <div id="detail-view" class="flex flex-col gap-4 text-center items-center justify-center h-40 border-2 border-dashed border-slate-800 rounded-xl relative overflow-hidden group">
                <i class="fa-regular fa-id-card text-3xl text-slate-700 group-hover:scale-110 transition"></i>
                <p class="text-sm text-slate-500">Select a lead to view War Room</p>
            </div>
        </div>

        <div class="flex-1 overflow-hidden flex flex-col">
            <h3 class="text-xs font-mono uppercase text-slate-500 mb-2 tracking-widest flex justify-between items-center">
                Attack Plans
                <span class="text-[9px] bg-slate-800 px-2 py-0.5 rounded text-gold-400 border border-slate-700">AI GENERATED</span>
            </h3>
            
            <!-- Attack Plan Tabs -->
            <div class="flex gap-2 mb-4">
                <button onclick="switchTab('sovereign')" id="tab-sovereign" class="flex-1 py-1.5 text-[10px] uppercase font-bold tracking-wider rounded bg-gold-400 text-obsidian text-center">Sovereign</button>
                <button onclick="switchTab('technical')" id="tab-technical" class="flex-1 py-1.5 text-[10px] uppercase font-bold tracking-wider rounded bg-slate-800 text-slate-400 hover:text-white transition text-center">Tech</button>
                <button onclick="switchTab('roi')" id="tab-roi" class="flex-1 py-1.5 text-[10px] uppercase font-bold tracking-wider rounded bg-slate-800 text-slate-400 hover:text-white transition text-center">ROI</button>
            </div>

            <!-- Pitch Content -->
            <div class="bg-gradient-to-b from-slate-800/30 to-slate-900/30 border border-gold-500/10 rounded-xl p-4 flex-1 relative overflow-y-auto custom-scrollbar">
                
                <div id="content-sovereign" class="pitch-content">
                    <p class="text-sm text-slate-300 italic mb-4 leading-relaxed" id="pitch-preview">
                        "Select a target to generate a sovereign architecture pitch."
                    </p>
                </div>
                
                <div id="content-candidate" class="pitch-content hidden">
                    <p class="text-sm text-slate-300 italic mb-4 leading-relaxed" id="pitch-candidate">
                         "Select a target to generate Candidate Value Prop."
                    </p>
                </div>
                
                <div id="content-technical" class="pitch-content hidden">
                    <p class="text-sm text-slate-300 italic mb-4 leading-relaxed" id="pitch-tech">
                        "Analyzing tech stack for vulnerabilities..."
                    </p>
                </div>

                <div id="content-roi" class="pitch-content hidden">
                    <p class="text-sm text-slate-300 italic mb-4 leading-relaxed" id="pitch-roi">
                         "Calculating cost of inaction..."
                    </p>
                </div>

                <!-- Actions -->
                <div class="flex flex-col gap-2 mt-4">
                    <button onclick="copyPitch()" class="w-full py-2 bg-slate-800 hover:bg-slate-700 text-slate-300 font-medium rounded border border-slate-700 transition text-xs flex items-center justify-center gap-2">
                        <i class="fa-regular fa-copy"></i> Copy to Clipboard
                    </button>
                    <button onclick="exportBrief()" class="w-full py-2 bg-gradient-to-r from-gold-500 to-amber-600 hover:from-gold-400 hover:to-amber-500 text-obsidian font-bold rounded shadow-[0_0_15px_rgba(212,175,55,0.2)] transition text-xs flex items-center justify-center gap-2">
                       <i class="fa-solid fa-file-pdf"></i> Generate Executive Brief
                    </button>
                    <button onclick="searchNews()" class="w-full py-2 bg-slate-800 hover:bg-slate-700 text-blue-400 font-medium rounded border border-slate-700 transition text-xs flex items-center justify-center gap-2">
                       <i class="fa-solid fa-satellite-dish"></i> Signal Decryption (News)
                    </button>
                </div>

            </div>
        </div>
    </aside>

  </div>

  <!-- PRINT TEMPLATE (HIDDEN) -->
  <div id="print-brief-template">
    <div class="brief-tag">GTM Signal Intelligence // Basin::Nexus</div>
    <div class="brief-title">EXECUTIVE GTM SIGNAL BRIEF</div>
    
    <div class="brief-meta">
        <div class="meta-block">
            <h5>Strategic Target</h5>
            <p id="pb-name"></p>
            <p id="pb-title" style="font-size: 11px; color: #555;"></p>
        </div>
        <div class="meta-block">
            <h5>Organization</h5>
            <p id="pb-company"></p>
        </div>
        <div class="meta-block">
            <h5>Signal Strength</h5>
            <p id="pb-score" style="font-weight: 900; font-size: 24px;"></p>
        </div>
        <div class="meta-block">
            <h5>Date of Issue</h5>
            <p id="pb-date"></p>
        </div>
    </div>

    <div class="intel-section">
        <div class="intel-header">Core Revenue Hypothesis (Sovereign)</div>
        <div class="intel-body" id="pb-sov"></div>
    </div>

    <div class="intel-section">
        <div class="intel-header">Technical Infrastructure Signal</div>
        <div class="intel-body" id="pb-tech"></div>
    </div>

    <div class="risk-block">
        <div class="intel-header" style="color: #c00;">Risk of Inaction</div>
        <div class="intel-body" id="pb-roi"></div>
    </div>

    <div class="decision-footer">
        <span>CONFIDENTIAL // AUTHORIZED ACCESS ONLY</span>
        <span>BASIN::NEXUS REVENUE ARCHITECTURE v6.2</span>
    </div>
  </div>

  <script>
    window.rawData = [];
    let currentLead = null;
    const VERSION = "6.3.0";
    let isClientMode = false;
    let isHunterMode = false;

    function toggleHunterMode() {
        isHunterMode = !isHunterMode;
        const btn = document.getElementById('hunter-btn');
        
        if (isHunterMode) {
            if(btn) {
                btn.classList.remove('opacity-50');
                btn.classList.add('bg-red-900/20', 'border-red-500/50', 'text-red-400');
            }
            
            // Filter Data for Hiring Signals if we had real signal data for that, 
            // for now, we just re-render to trigger visual refresh, 
            // or we could filter by keywords if valid.
            const hiringKeywords = ['Founder', 'CEO', 'Director', 'Head of', 'President', 'VP', 'Owner', 'Partner', 'Managing Partner'];
            const highValueTargets = ['Mira Murati', 'JoÃ£o (Joe) Moura', 'Andrew Ng', 'Rowan Cheung', 'Nate Nasralla', 'Jassi Singh', 'Daniel Bell', 'Katia Annad', 'SecureMC', 'Rodney Daut', 'Kalina', 'Dean Birinyi'];
            
            const filtered = window.rawData.filter(item => 
                hiringKeywords.some(k => item['Title'] && item['Title'].includes(k)) ||
                highValueTargets.some(t => item['Full Name'] && item['Full Name'].includes(t)) ||
                highValueTargets.some(t => item['Company'] && item['Company'].includes(t)) ||
                (item['GTM Score'] && parseInt(item['GTM Score']) >= 90)
            );
            
            renderFeed(filtered.slice(0, 150));
            updateHeader("Hunter Protocol Active", `Tracking ${filtered.length} High-Velocity Placement Vectors`);
        } else {
            if(btn) {
                btn.classList.add('opacity-50');
                btn.classList.remove('bg-red-900/20', 'border-red-500/50', 'text-red-400');
            }
            resetFilters();
        }
    }

    // FALLBACK DATA (For Offline/Demo Stability)

    const MOCK_DATA = [
      {"Full Name": "Jassi Singh", "Company": "TalSmart", "Title": "Founder & CEO", "GTM Score": "98", "Tech Stack": "HubSpot, LinkedIn Sales Nav", "Source": "Active Deal", "Industry": "Sales Intelligence", "Nexus Pitch": "TalSmart's lead velocity is constrained by human-in-the-loop validation. Basin::Nexus Sovereign Agents can automate 80% of top-of-funnel validation. I've prepared a Loom audit of your current funnel efficiency."},
      {"Full Name": "SecureMC Leadership", "Company": "SecureMC Global", "Title": "Expansion Team", "GTM Score": "97", "Tech Stack": "Global BPO, Real Estate", "Source": "Strategic Inbound", "Industry": "Intl. Operations", "Nexus Pitch": "Deploying the 'Wholesaler Extraction' pilot will allow SecureMC to capture US distress signals ahead of the market. Let's operationalize this bridge protocol."},
      {"Full Name": "Daniel Bell", "Company": "Bell Tower", "Title": "Managing Partner", "GTM Score": "95", "Tech Stack": "ConnectWise, Azure Sentinel", "Source": "Strategic Partner", "Industry": "Cybersecurity / MSP", "Nexus Pitch": "Daniel, the 'Partnership Framework' is ready. We can merge Basin::Nexus signal data with your security stack to create the first Sovereign GTM for MSPs."},
      {"Full Name": "Katia Annad", "Company": "Bell Tower", "Title": "Sysadmin & Cloud Sec", "GTM Score": "92", "Tech Stack": "Linux, Azure, AWS", "Source": "Strategic Partner", "Industry": "Cybersecurity", "Nexus Pitch": "Your infrastructure is ready for a sovereign reasoning layer. Let's bypass the 'SaaS Tax' and run local GTM models on your own compute."},
      {"Full Name": "Rodney Daut", "Company": "Network", "Title": "Strategic Advisor", "GTM Score": "90", "Tech Stack": "Substack, LinkedIn", "Source": "Referral", "Industry": "Content", "Nexus Pitch": "Rodney, I'm ready to audit Kalina's signal stack. My 'Sovereign GTM' framework builds an internal intelligence layer that you ownâ€”not OpenAI."},
      {"Full Name": "Kalina (Referral)", "Company": "Stealth Mode", "Title": "Founder", "GTM Score": "94", "Tech Stack": "Unknown", "Source": "Rodney Daut", "Industry": "Venture", "Nexus Pitch": "Kalina, I'm offering a 'Signal Audit' to identify where your pipeline is leaking to 'rented' intelligence. Let's effectively operationalize your privacy."},
      {"Full Name": "Dean Birinyi", "Company": "Birinyi Photography", "Title": "Owner", "GTM Score": "89", "Tech Stack": "Wealth/Asset Protection", "Source": "Scraping", "Industry": "High Net Worth", "Nexus Pitch": "Dean, protecting your IP and asset base requires a sovereign intelligence layer. Let's move your GTM data off the public cloud."},
      {"Full Name": "Isaiah Grant", "Company": "Kingdom Impact", "Title": "Founder", "GTM Score": "88", "Tech Stack": "Unknown", "Source": "Scraped", "Industry": "Mission-Driven", "Nexus Pitch": "Isaiah, my 'Sovereign GTM' framework builds an internal intelligence layer that you own. Let's effectively operationalize your privacy and protect your impact."},
      {"Full Name": "Chris Russell", "Company": "Tempus Pecunia", "Title": "Founder & President", "GTM Score": "87", "Tech Stack": "google_analytics", "Source": "Scraped", "Industry": "Finance", "Nexus Pitch": "Chris, leading Tempus Pecunia means protecting the IP. My 'Sovereign GTM' framework builds an internal intelligence layer that you ownâ€”not OpenAI."},
      {"Full Name": "Andrew Ng", "Company": "DeepLearning.AI", "Title": "Founder", "GTM Score": "99", "Tech Stack": "Modern AI", "Source": "Strategic Elite Pull", "Industry": "AI Education", "Nexus Pitch": "ðŸ¦… Andrew, I've analyzed DeepLearning.AI's GTM architecture. Most teams are currently renting their intelligence from brittle SaaS stacks. Let's build a Sovereign Signal Refinery."},
      {"Full Name": "Mira Murati", "Company": "Thinking Machines Lab", "Title": "Co-Founder and CEO", "GTM Score": "99", "Tech Stack": "Modern AI", "Source": "Strategic Elite Pull", "Industry": "AI Lab", "Nexus Pitch": "ðŸ¦… Mira, your work at OpenAI changed the world. Now with Thinking Machines, the GTM architecture needs to be as advanced as the models themselves. Let's build a Sovereign Signal Refinery."},
      {"Full Name": "JoÃ£o (Joe) Moura", "Company": "CrewAI", "Title": "Founder & CEO", "GTM Score": "99", "Tech Stack": "Agents/AI", "Source": "Strategic Elite Pull", "Industry": "AI Agents", "Nexus Pitch": "ðŸ¦… Joe, CrewAI is orchestrating the future of work. But don't let your own GTM orchestrate itself on rented rails. Let's architect a Sovereign Signal Refinery for your agents."},
      {"Full Name": "Rowan Cheung", "Company": "The Rundown AI", "Title": "Founder & CEO", "GTM Score": "98", "Tech Stack": "Modern AI", "Source": "Strategic Elite Pull", "Industry": "AI Content", "Nexus Pitch": "ðŸ¦… Rowan, the AI signal market is becoming saturated. Ownership of the reasoning layer is the only moat left. Let's architect a sovereign system for The Rundown."}
    ];

    function initDashboard() {
        console.log("Initializing Basin::Nexus V" + VERSION);
        runRefinerySequence(true); // Initial load sequence
    }

    function runRefinerySequence(isInit = false) {
        const overlay = document.getElementById('refinery-overlay');
        const progressBar = document.getElementById('refinery-bar');
        const stageText = document.getElementById('refinery-stage');
        const percentText = document.getElementById('refinery-percent');
        const logBox = document.getElementById('refinery-log');
        
        overlay.style.display = 'flex';
        progressBar.style.width = '0%';
        logBox.innerHTML = '';
        
        const logs = [
            "Initializing Secure Uplink...",
            "Handshaking with Basin::Refinery...",
            "Decrypting Signal Stream...",
            "Ingesting 12,400 raw nodes...",
            "Applying GTM Scoring Algorithms...",
            "Enriching Company Firmographics...",
            "Validating Contact Vectors...",
            "Optimizing Local Cache...",
            "SYNC COMPLETE."
        ];

        let step = 0;
        const totalSteps = logs.length;
        
        const interval = setInterval(() => {
            if (step >= totalSteps) {
                clearInterval(interval);
                setTimeout(() => {
                    overlay.style.display = 'none';
                    if (isInit) loadData(); // Load data after animation
                }, 500);
                return;
            }
            
            // Update UI
            const percent = Math.round(((step + 1) / totalSteps) * 100);
            progressBar.style.width = percent + '%';
            percentText.innerText = percent + '%';
            stageText.innerText = logs[step];
            
            const logEntry = document.createElement('div');
            logEntry.className = "text-emerald-500/80 mb-1";
            logEntry.innerText = `> ${new Date().toLocaleTimeString()} :: ${logs[step]}`;
            logBox.appendChild(logEntry);
            logBox.scrollTop = logBox.scrollHeight;
            
            step++;
        }, 150); // Speed of animation
    }

    function loadData() {
        const statusEl = document.getElementById('stat-total-leads');
        // statusEl.innerText = "Syncing..."; // Removed to keep numbers stable after anim
        
        const csvUrl = 'leads.csv?v=' + Date.now();
        
        Papa.parse(csvUrl, {
            download: true,
            header: true,
            skipEmptyLines: true,
            complete: function(results) {
                window.rawData = results.data.filter(r => r['Full Name'] || r['Company']);
                
                // Cascaded data loading
                Promise.all([
                    fetch('recon_results.json?v=' + Date.now()).then(r => r.json()).catch(() => ({})),
                    fetch('company_profiles.json?v=' + Date.now()).then(r => r.json()).catch(() => ({})),
                    fetch('market_intel.json?v=' + Date.now()).then(r => r.json()).catch(() => ({}))
                ]).then(([recon, profiles, market]) => {
                    window.reconData = recon;
                    window.companyProfiles = profiles;
                    window.marketIntel = market;
                    processData();
                });
            },
            error: function(err) {
                console.warn("CSV Load Failed. Using Sovereign Mock Data.", err);
                window.rawData = MOCK_DATA;
                window.reconData = {};
                processData();
            }
        });
    }

    function processData() {
         // Identify Substack Segment
        window.rawData.forEach(r => {
            if (r['Company'] === 'Substack Subscriber' || r['Company'] === 'Newsletter Subscriber') {
                r.isSubstack = true;
                r.channel = 'Email/Content';
            } else {
                r.channel = 'LinkedIn/Direct';
            }
        });

        // Sort by GTM Score Descending
        window.rawData.sort((a, b) => {
            const scoreA = parseInt(a['GTM Score']) || 0;
            const scoreB = parseInt(b['GTM Score']) || 0;
            return scoreB - scoreA;
        });

        console.log("Data Active:", window.rawData.length);
        updateStats();
        // Limit rendering for performance
        renderFeed(window.rawData.slice(0, 150));
        setupSearch();
    }

    function updateStats() {
        const totalLeads = window.rawData.length;
        const uniqueCompanies = new Set(window.rawData.map(r => r['Company']).filter(c => c)).size;
        const highPriority = window.rawData.filter(r => (parseInt(r['GTM Score']) || 0) >= 80).length;
        
        // Update UI Stats with animation
        animateValue("stat-total-leads", 0, totalLeads, 1000);
        animateValue("stat-total-companies", 0, uniqueCompanies, 1000);
        animateValue("stat-high-priority", 0, highPriority, 1000);
    }

    function animateValue(id, start, end, duration) {
        const obj = document.getElementById(id);
        if (!obj) return;
        let startTimestamp = null;
        const step = (timestamp) => {
            if (!startTimestamp) startTimestamp = timestamp;
            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
            obj.innerText = Math.floor(progress * (end - start) + start).toLocaleString();
            if (progress < 1) {
                window.requestAnimationFrame(step);
            }
        };
        window.requestAnimationFrame(step);
    }

    function setupSearch() {
        // Clear old listeners by replacing element (simple hack)
        const oldInput = document.getElementById('searchInput');
        const newInput = oldInput.cloneNode(true);
        oldInput.parentNode.replaceChild(newInput, oldInput);

        newInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            const filtered = window.rawData.filter(item => 
                (item['Full Name'] && item['Full Name'].toLowerCase().includes(term)) ||
                (item['Company'] && item['Company'].toLowerCase().includes(term)) ||
                (item['Tech Stack'] && item['Tech Stack'].toLowerCase().includes(term)) ||
                (item['Title'] && item['Title'].toLowerCase().includes(term))
            );
            renderFeed(filtered.slice(0, 150));
        });
    }

    function filterByTech(tech) {
        const searchInput = document.getElementById('searchInput');
        searchInput.value = tech;
        const event = new Event('input');
        searchInput.dispatchEvent(event);
        updateHeader(`Stack: ${tech}`, `${window.rawData.filter(r => r['Tech Stack'] && r['Tech Stack'].toLowerCase().includes(tech)).length} signals identified`);
    }

    function filterBySource(sourceStr) {
        document.getElementById('searchInput').value = "";
        const filtered = window.rawData.filter(item => 
            item['Source'] && item['Source'].includes(sourceStr)
        );
        renderFeed(filtered.slice(0, 150));
        updateHeader("Strategic Command", sourceStr + " Segments Active");
    }

    function resetFilters() {
        document.getElementById('searchInput').value = "";
        renderFeed(window.rawData.slice(0, 150));
        updateHeader("Sovereign Signal Feed", "Real-time enrichment from Basin::Refinery");
    }

    function updateHeader(title, subtitle) {
        document.getElementById('page-title').innerText = title;
        document.getElementById('page-subtitle').innerText = subtitle;
    }

    function renderFeed(data) {
        const container = document.getElementById('feed-container');
        if(data.length === 0) {
            container.innerHTML = `
                <div class="h-full flex flex-col items-center justify-center opacity-30 gap-4 mt-20">
                    <i class="fa-solid fa-ghost text-6xl"></i>
                    <div class="font-mono text-sm uppercase">No signals intercepted.</div>
                </div>`;
            return;
        }

        let html = '<div class="grid grid-cols-1 md:grid-cols-2 2xl:grid-cols-3 gap-4 pt-6">';
        
        data.forEach((lead, index) => {
            const actualIndex = window.rawData.indexOf(lead); // Use index from master list
            const score = parseInt(lead['GTM Score']) || 10;
            const initials = lead['Full Name'] ? lead['Full Name'].split(' ').map(n => n[0]).join('').slice(0,2) : '?';
            const source = lead['Source'] || '';
            
            // --- TIER LOGIC (Based on Chat Framework) ---
            // Tier 1: Strong Fit (85+) + Active Signal/Deal
            // Tier 2: Good Fit (70+) + Passive Signal OR Strong Fit + No Signal
            // Tier 3: Low Fit OR No Signals
            
            const hasActiveSignal = source.includes('Active Deal') || source.includes('Partner') || source.includes('Inbound') || source.includes('Hot');
            const hasPassiveSignal = source.includes('Referral') || source.includes('Warm');
            
            let tier = 3;
            if (score >= 85 && hasActiveSignal) tier = 1;
            else if (score >= 85 || (score >= 70 && hasActiveSignal) || (score >= 70 && hasPassiveSignal)) tier = 2;
            
            // Visual Config based on Tier
            let borderClass = 'border-l-slate-800';
            let glowClass = '';
            let tierBadge = '<span class="px-2 py-0.5 rounded bg-slate-800 text-slate-500 text-[9px] border border-slate-700">TIER 3</span>';
            
            if (tier === 1) {
                borderClass = 'border-l-gold-400';
                glowClass = 'shadow-[0_0_20px_rgba(212,175,55,0.15)]';
                tierBadge = '<span class="px-2 py-0.5 rounded bg-gold-400/10 text-gold-400 text-[9px] border border-gold-400/50 font-bold">TIER 1 // ACTIVE</span>';
            } else if (tier === 2) {
                borderClass = 'border-l-blue-400';
                glowClass = 'shadow-[0_0_15px_rgba(96,165,250,0.1)]';
                tierBadge = '<span class="px-2 py-0.5 rounded bg-blue-400/10 text-blue-400 text-[9px] border border-blue-400/50">TIER 2 // NURTURE</span>';
            }
            
            const cardClasses = `glass-panel rounded-2xl p-5 cursor-pointer transition-all duration-300 group hover:scale-[1.02] border-l-4 ${borderClass} ${glowClass}`;
            
            html += `
            <div onclick="selectLead(${actualIndex})" role="button" tabindex="0" onkeydown="if(event.key==='Enter') selectLead(${actualIndex})" class="${cardClasses}">
                <div class="flex items-start justify-between mb-4">
                    <div class="h-10 w-10 rounded-xl bg-slate-900 border border-white/5 flex items-center justify-center text-gold-400 font-bold shadow-xl relative overflow-hidden">
                        ${initials}
                        ${hasActiveSignal ? '<div class="absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full animate-pulse border border-slate-900"></div>' : ''}
                    </div>
                    <div class="text-right">
                        <div class="flex flex-col items-end gap-1">
                             ${tierBadge}
                             <div class="flex items-baseline gap-1 mt-1">
                                <span class="text-[18px] font-black font-mono ${tier === 1 ? 'text-gold-400' : (tier === 2 ? 'text-blue-400' : 'text-slate-500')}">${score}</span>
                                <span class="text-[8px] uppercase tracking-widest text-slate-600">FIT</span>
                             </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h4 class="font-bold text-slate-100 truncate group-hover:text-gold-400 transition mb-0.5">${lead['Full Name'] || 'Anonymous Signal'}</h4>
                    <p class="text-[10px] text-slate-500 font-mono uppercase tracking-wider truncate">${lead['Title'] || 'Executive'} @ ${lead['Company']}</p>
                </div>

                <div class="flex flex-wrap gap-1.5 mb-4">
                    ${(lead['Tech Stack'] || '').split(',').slice(0, 3).map(t => t.trim() ? `<span class="px-2 py-0.5 rounded bg-slate-950/50 border border-slate-800 text-[9px] text-slate-400 font-mono">${t}</span>` : '').join('')}
                </div>

                <div class="flex items-center justify-between pt-3 border-t border-white/5 opacity-50 group-hover:opacity-100 transition">
                    <span class="text-[9px] text-slate-600 font-mono uppercase">${lead['Industry'] || 'Unknown Sector'}</span>
                    <i class="fa-solid fa-chevron-right text-[10px] text-gold-400"></i>
                </div>
            </div>
            `;
        });
        
        html += '</div>';
        container.innerHTML = html;
    }

    function selectLead(index) {
        currentLead = window.rawData[index];
        const leadData = currentLead;
        
        // Custom SecureMC War Room View
        if (leadData['Company'] === 'SecureMC Global') {
            const detailHtml = `
                <div class="relative mb-6">
                    <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-gold-600 to-amber-800 border-2 border-gold-400 flex items-center justify-center text-2xl font-black text-white shadow-[0_0_30px_rgba(212,175,55,0.4)] mx-auto animate-pulse-gold">
                        SMC
                    </div>
                    <div class="absolute -bottom-2 left-1/2 -translate-x-1/2 bg-slate-900 border border-gold-400 px-3 py-1 rounded-full flex items-center gap-2 shadow-xl">
                        <div class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></div>
                        <span class="text-[9px] font-bold text-gold-400 uppercase tracking-widest whitespace-nowrap">PILOT ACTIVE</span>
                    </div>
                </div>
                
                <div class="text-center px-4 space-y-4">
                    <div>
                        <h2 class="text-xl font-black text-white leading-none uppercase tracking-tighter">SECUREMC GLOBAL</h2>
                        <div class="text-[10px] text-emerald-400 font-mono uppercase tracking-[0.2em] mt-1">Growth Pilot Protocol</div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-2 text-left">
                         <div class="p-2 bg-slate-800/50 rounded border border-slate-700">
                            <div class="text-[8px] text-slate-500 uppercase font-bold">Current State</div>
                            <div class="text-sm font-mono text-slate-300">Manual Search<span class="text-[9px] block text-red-500">Unscalable</span></div>
                         </div>
                         <div class="p-2 bg-slate-800/50 rounded border border-slate-700">
                            <div class="text-[8px] text-slate-500 uppercase font-bold">Target ICP</div>
                            <div class="text-sm font-mono text-slate-300">Wholesalers<span class="text-[9px] block text-emerald-500">High Volume</span></div>
                         </div>
                    </div>

                    <div class="p-3 bg-blue-900/20 border border-blue-500/30 rounded-lg text-left">
                        <div class="text-[9px] text-blue-400 uppercase font-bold tracking-widest mb-1 italic">NEXT ACTION</div>
                        <div class="text-[10px] text-slate-200">Deploy "Wholesaler Extraction" technical brief to Moaz upon confirmation.</div>
                    </div>
                    
                    <button onclick="window.open('wholesaler-extraction-brief.html', '_blank')" class="w-full py-3 bg-slate-800 hover:bg-slate-700 text-gold-400 font-bold rounded border border-gold-500/20 transition text-xs flex items-center justify-center gap-2 group">
                        <i class="fa-solid fa-file-shield group-hover:scale-110 transition"></i> OPEN EXTRACTION BRIEF
                    </button>
                </div>
            `;
            document.getElementById('detail-view').innerHTML = detailHtml;
            const firstName = leadData['Full Name'].split(' ')[0];
            const pilotPitch = `ðŸ¦… ${firstName}, I'm targeting Wholesalers who are hiring Acquisition Managers. These are the players who need your Cold Callers immediately. My system identifies them automatically.`;
            document.getElementById('pitch-preview').innerText = pilotPitch;
            document.getElementById('tab-sovereign').innerText = "STRATEGY";
            return;
        }

        // Custom TalSmart War Room View
        if (leadData['Company'] === 'TalSmart') {
            const detailHtml = `
                <div class="relative mb-6">
                    <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-purple-600 to-indigo-800 border-2 border-purple-400 flex items-center justify-center text-2xl font-black text-white shadow-[0_0_30px_rgba(168,85,247,0.4)] mx-auto">
                        TS
                    </div>
                    <div class="absolute -bottom-2 left-1/2 -translate-x-1/2 bg-slate-900 border border-purple-400 px-3 py-1 rounded-full flex items-center gap-2 shadow-xl">
                        <div class="w-1.5 h-1.5 rounded-full bg-blue-500 animate-pulse"></div>
                        <span class="text-[9px] font-bold text-purple-400 uppercase tracking-widest whitespace-nowrap">DEAL AT RISK</span>
                    </div>
                </div>
                
                <div class="text-center px-4 space-y-4">
                    <div>
                        <h2 class="text-xl font-black text-white leading-none uppercase tracking-tighter">${leadData['Full Name']}</h2>
                        <div class="text-[10px] text-purple-400 font-mono uppercase tracking-[0.2em] mt-1">Foundational Outbound Engine</div>
                    </div>
                    
                    <div class="p-3 bg-red-900/20 border border-red-500/30 rounded-lg text-left">
                        <div class="text-[9px] text-red-400 uppercase font-bold tracking-widest mb-1 italic">BLOCKER</div>
                        <div class="text-[10px] text-slate-200">Requested CV for "Board approval." Pivot required to focus on Partnership, not Employment.</div>
                    </div>

                    <div class="p-3 bg-blue-900/20 border border-blue-500/30 rounded-lg text-left">
                        <div class="text-[9px] text-blue-400 uppercase font-bold tracking-widest mb-1 italic">NEXT ACTION</div>
                        <div class="text-[10px] text-slate-200">Send partnership framework. Secure $4,000 deployment fee vs 50/50 revenue split logic.</div>
                    </div>
                    
                    <button onclick="window.open('partnership-framework.html', '_blank')" class="w-full py-3 bg-slate-800 hover:bg-slate-700 text-purple-400 font-bold rounded border border-purple-500/20 transition text-xs flex items-center justify-center gap-2 group">
                        <i class="fa-solid fa-handshake group-hover:scale-110 transition"></i> OPEN PARTNERSHIP BRIEF
                    </button>
                </div>
            `;
            document.getElementById('detail-view').innerHTML = detailHtml;
            return;
        }

        // Custom Bell Tower War Room View
        if (leadData['Company'] === 'Bell Tower') {
            const detailHtml = `
                <div class="relative mb-6">
                    <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-blue-600 to-cyan-800 border-2 border-blue-400 flex items-center justify-center text-2xl font-black text-white shadow-[0_0_30px_rgba(59,130,246,0.4)] mx-auto">
                        BT
                    </div>
                    <div class="absolute -bottom-2 left-1/2 -translate-x-1/2 bg-slate-900 border border-blue-400 px-3 py-1 rounded-full flex items-center gap-2 shadow-xl">
                        <div class="w-1.5 h-1.5 rounded-full bg-emerald-500"></div>
                        <span class="text-[9px] font-bold text-blue-400 uppercase tracking-widest whitespace-nowrap">PARTNER VERIFIED</span>
                    </div>
                </div>
                
                <div class="text-center px-4 space-y-4">
                    <div>
                        <h2 class="text-xl font-black text-white leading-none uppercase tracking-tighter">${leadData['Full Name']}</h2>
                        <div class="text-[10px] text-blue-400 font-mono uppercase tracking-[0.2em] mt-1">Managed Defense Protocol</div>
                    </div>
                    
                    <div class="p-3 bg-emerald-900/20 border border-emerald-500/30 rounded-lg text-left">
                        <div class="text-[9px] text-emerald-400 uppercase font-bold tracking-widest mb-1 italic">STRATEGIC ALIGNMENT</div>
                        <div class="text-[10px] text-slate-200">High trust established. Transitioning to "White Label" GTM offering for their MSP clients.</div>
                    </div>

                    <div class="p-3 bg-blue-900/20 border border-blue-500/30 rounded-lg text-left">
                        <div class="text-[9px] text-blue-400 uppercase font-bold tracking-widest mb-1 italic">NEXT ACTION</div>
                        <div class="text-[10px] text-slate-200">Prepare custom "Bell Tower" white-label dashboard for Katia and Daniel.</div>
                    </div>
                </div>
            `;
            document.getElementById('detail-view').innerHTML = detailHtml;
            return;
        }

        const detailHtml = `
            <div class="relative mb-4">
                <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-slate-800 to-slate-950 border border-gold-400/20 flex items-center justify-center text-2xl font-black text-gold-400 shadow-2xl mx-auto rotate-3 group-hover:rotate-0 transition-transform">
                    ${leadData['Full Name'] ? leadData['Full Name'].charAt(0) : '?'}
                </div>
                <div class="absolute -bottom-1 -right-1 h-6 w-6 rounded-lg bg-emerald-500 border-2 border-obsidian flex items-center justify-center shadow-lg">
                    <i class="fa-solid fa-bolt text-[10px] text-white"></i>
                </div>
            </div>
            <div class="text-center px-4">
                <h2 class="text-lg font-black text-white leading-tight mb-1 uppercase tracking-tighter">${leadData['Full Name']}</h2>
                <div class="text-[10px] text-gold-500 font-mono uppercase mb-4 tracking-widest">${leadData['Company']}</div>
                
                </div>
            </div>

            <!-- Intel Vault Section -->
            <div class="w-full mt-6 space-y-4">
                <div class="flex items-center justify-between border-b border-white/5 pb-2">
                    <h3 class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Intelligence Vault</h3>
                    <div class="flex gap-2">
                        <button onclick="manualRecon('${leadData['Full Name']}', 'fast')" class="text-[9px] text-blue-400 hover:text-blue-300 transition uppercase font-bold">FastSearch</button>
                        <button onclick="manualRecon('${leadData['Full Name']}', 'free')" class="text-[9px] text-blue-400 hover:text-blue-300 transition uppercase font-bold">FreeSearch</button>
                    </div>
                </div>
                <div id="recon-nodes" class="space-y-2">
                    <!-- Dynamic Recon Nodes will be injected here -->
                </div>
            </div>
        `;
        document.getElementById('detail-view').innerHTML = detailHtml;
        
        // Inject Recon Nodes if available
        const reconNodes = document.getElementById('recon-nodes');
        if (window.reconData && window.reconData[leadData['Full Name']]) {
            const results = window.reconData[leadData['Full Name']].results || [];
            results.slice(0, 3).forEach(res => {
                const node = document.createElement('a');
                node.href = res.url;
                node.target = "_blank";
                node.className = "block bg-slate-900/80 p-2 rounded border border-white/5 hover:border-gold-400/30 transition group";
                node.innerHTML = `
                    <div class="text-[10px] text-gold-400 font-bold truncate group-hover:underline">${res.title || 'Personal Node'}</div>
                    <div class="text-[9px] text-slate-500 truncate">${res.url}</div>
                `;
                reconNodes.appendChild(node);
            });
        } else {
            reconNodes.innerHTML = `<div class="text-[9px] text-slate-600 italic">No automated nodes detected. Run recon_oracle.py for deep intel.</div>`;
        }
        
        updatePitches(leadData);
    }

    function updatePitches(leadData) {
        document.getElementById('detail-view').className = "flex flex-col items-center bg-slate-900/40 border border-slate-800 p-6 rounded-2xl shadow-xl";
        
        // Populate Pitches
        const firstName = leadData['Full Name'] ? leadData['Full Name'].split(' ')[0] : 'Leader';
        const company = leadData['Company'] || 'the organization';
        
        const sovPitch = leadData['Nexus Pitch'] && leadData['Nexus Pitch'].length > 20 
            ? leadData['Nexus Pitch'] 
            : `ðŸ¦… ${firstName}, managing revenue at ${company} requires sovereign infrastructure. My framework operationalizes your data so you own the intelligence layer, not rent it.`;
            
        // Digital Workforce Framing
        const workforcePitch = `ðŸ¦… ${firstName}, we are deploying the Alice/Julian 'Digital Workforce' protocols to the ${company} node. This eliminates the research-to-response gap and hard-codes your GTM logic into an autonomous loop. Shall we initiate a Resonance Audit?`;

        const techPitch = leadData['Enrichment Source'] && leadData['Enrichment Source'].includes('Workforce')
            ? workforcePitch
            : `ðŸ¦… ${firstName}, I see you're running ${leadData['Tech Stack'] || 'legacy systems'}. Basin::Nexus deploys a local reasoning layer that bypasses API latency and secures your GTM data inside your own VPC.`;
        
        const roiPitch = `ðŸ¦… ${firstName}, ${company} is likely leaking 20% of pipeline to signal noise. By moving to a sovereign strategist model, we can cut CAC by 40% in Q1.`;

        document.getElementById('pitch-preview').innerText = sovPitch;
        document.getElementById('pitch-tech').innerText = techPitch;
        document.getElementById('pitch-roi').innerText = roiPitch;
    
    // Hunter Mode Logic
    const candidatePitch = `ðŸ¦… ${firstName}, I'm vetting leadership roles where I can deploy this Sovereign GTM architecture. ${company} fits the profile for high-velocity signal enrichment. Are you open to a brief demo of the engine?`;
    document.getElementById('pitch-candidate').innerText = candidatePitch;

    if (isHunterMode) {
         document.getElementById('content-sovereign').classList.add('hidden');
         document.getElementById('content-technical').classList.add('hidden');
         document.getElementById('content-roi').classList.add('hidden');
         
         document.getElementById('content-candidate').classList.remove('hidden');
         
         document.getElementById('tab-sovereign').innerText = "INTRO";
         document.getElementById('tab-technical').innerText = "VALUE";
         document.getElementById('tab-roi').innerText = "ASK";
    } else {
         document.getElementById('content-candidate').classList.add('hidden');
         
         document.getElementById('tab-sovereign').innerText = "SOVEREIGN";
         document.getElementById('tab-technical').innerText = "TECH";
         document.getElementById('tab-roi').innerText = "ACCOUNT"; // Account briefed
         switchTab('sovereign');
    }
}
    
    function switchTab(tab) {
        ['sovereign', 'technical', 'roi'].forEach(t => {
            document.getElementById(`content-${t}`).classList.add('hidden');
            const btn = document.getElementById(`tab-${t}`);
            btn.classList.remove('bg-gold-400', 'text-obsidian', 'shadow-[0_0_15px_rgba(212,175,55,0.3)]');
            btn.classList.add('bg-slate-800', 'text-slate-500');
        });
        
        // Handle Account/ROI special case
        document.getElementById('content-roi').classList.add('hidden');
        document.getElementById('content-account').classList.add('hidden');

        if (tab === 'roi') {
             if (isHunterMode) {
                  document.getElementById('content-roi').classList.remove('hidden');
             } else {
                  document.getElementById('content-account').classList.remove('hidden');
                  renderAccountBrief();
             }
        } else {
             document.getElementById(`content-${tab}`).classList.remove('hidden');
        }

        const activeBtn = document.getElementById(`tab-${tab}`);
        activeBtn.classList.remove('bg-slate-800', 'text-slate-500');
        activeBtn.classList.add('bg-gold-400', 'text-obsidian', 'shadow-[0_0_15px_rgba(212,175,55,0.3)]');
    }
    
    function copyPitch() {
        const activeContent = document.querySelector('.pitch-content:not(.hidden) p');
        if (!activeContent) return;
        navigator.clipboard.writeText(activeContent.innerText).then(() => {
            alert('Strategic attack plan cloned to clipboard.');
        });
    }
    
    function renderAccountBrief() {
        if (!currentLead) return;
        const company = currentLead['Company'];
        const profile = window.companyProfiles ? window.companyProfiles[company] : null;
        const container = document.getElementById('content-account');
        
        // Build Neural Identity html
        const name = currentLead['Full Name'];
        const intel = window.reconData ? window.reconData[name] : null;

        let html = `
            <div class="space-y-6">
                <!-- PERSONAL NODES (Identity Profiling) -->
                <div>
                    <h3 class="text-[11px] font-black text-blue-400 uppercase tracking-widest border-b border-white/10 pb-2 mb-3">Neural Identity Profile: ${name}</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="bg-blue-500/10 p-3 rounded border border-blue-500/20">
                            <div class="text-[9px] text-blue-300 uppercase mb-1">GTM Persona</div>
                            <div class="text-[10px] text-white font-medium">${currentLead['Title'].split('|')[0] || 'Executive Operator'}</div>
                        </div>
                        <div class="bg-purple-500/10 p-3 rounded border border-purple-500/20">
                            <div class="text-[9px] text-purple-300 uppercase mb-1">Influence Tier</div>
                            <div class="text-[10px] text-white font-medium">${parseInt(currentLead['GTM Score']) >= 98 ? 'T1 STRATEGIC' : 'HIGH VELOCITY'}</div>
                        </div>
                    </div>
        `;

        if (intel && intel.personal_nodes && intel.personal_nodes.length > 0) {
            html += `<div class="mt-4 grid grid-cols-1 gap-2">`;
            intel.personal_nodes.forEach(node => {
                html += `
                    <a href="${node.url}" target="_blank" class="flex items-center justify-between bg-slate-900/60 p-2 rounded border border-white/5 hover:border-blue-400/50 transition-all">
                        <div class="flex items-center gap-2">
                            <i class="fa-solid fa-link text-blue-400 text-[10px]"></i>
                            <span class="text-[10px] text-slate-300">${node.title}</span>
                        </div>
                        <i class="fa-solid fa-arrow-up-right-from-square text-[8px] text-slate-500"></i>
                    </a>
                `;
            });
            html += `</div>`;
        } else {
             html += `<p class="text-[9px] text-slate-500 italic mt-3">Searching Oracle for personal nodes... Run recon_oracle.py</p>`;
        }

        html += `
                </div>

                <!-- ACCOUNT INTEL (Company Profiling) -->
                <div>
                    <h3 class="text-[11px] font-black text-gold-400 uppercase tracking-widest border-b border-white/10 pb-2 mb-3">Account Brief: ${company}</h3>
        `;

        if (profile) {
            html += `<p class="text-[9px] text-slate-400 italic mb-3">Intelligence synthesized on ${new Date(profile.audit_date).toLocaleDateString()}</p>`;
            profile.signals.slice(0, 3).forEach(sig => {
                html += `
                    <div class="bg-slate-900/80 p-3 rounded border border-white/5 h-auto mb-3">
                        <div class="text-[10px] font-bold text-white mb-1 line-clamp-1">${sig.title}</div>
                        <div class="text-[9px] text-slate-400 line-clamp-2 mb-2 italic">"...${sig.snippet.substring(50, 200)}..."</div>
                        <div class="flex justify-between items-center">
                            <a href="${sig.url}" target="_blank" class="text-[8px] text-blue-500 hover:underline">SOURCE SIGNAL</a>
                            <span class="text-[8px] text-slate-600">AUDITED BY ORACLE</span>
                        </div>
                    </div>
                `;
            });
        } else {
            html += `
                <div class="h-24 flex flex-col items-center justify-center opacity-30 gap-2 border border-dashed border-white/20 rounded-xl">
                    <i class="fa-solid fa-building-shield text-xl"></i>
                    <div class="text-[8px] uppercase tracking-widest text-center">No Account Profile<br/>Found in Oracle Vault</div>
                </div>
            `;
        }
        
        html += `
                    <div class="flex gap-4 mt-4">
                         <a href="https://www.crunchbase.com/search/organizations/field/organizations/name/${company}" target="_blank" class="flex-1 text-center py-2 bg-slate-800 rounded text-[9px] font-bold text-slate-300 hover:bg-slate-700">CRUNCHBASE</a>
                         <a href="https://www.google.com/search?q=${company}+funding+news+2026" target="_blank" class="flex-1 text-center py-2 bg-slate-800 rounded text-[9px] font-bold text-slate-300 hover:bg-slate-700">NEWS TRIGGER</a>
                    </div>
                </div>
            </div>`;
        container.innerHTML = html;
    }

    function manualRecon(name, type) {
        const query = encodeURIComponent(name);
        let url = "";
        if (type === 'fast') url = `https://www.fastpeoplesearch.com/name/${name.replace(/ /g, '-')}`;
        else if (type === 'free') url = `https://www.searchpeoplefree.com/find/${name.replace(/ /g, '-')}`;
        window.open(url, '_blank');
    }

    function searchNews() {
        if(!currentLead) return;
        const query = encodeURIComponent(`${currentLead['Company']} GTM strategy news 2026`);
        window.open(`https://www.google.com/search?q=${query}`, '_blank');
    }

    function exportBrief() {
        if (!currentLead) {
            alert("Select a target to generate a brief.");
            return;
        }

        // Populate Print Template
        document.getElementById('pb-name').innerText = currentLead['Full Name'];
        document.getElementById('pb-title').innerText = currentLead['Title'] || 'Executive';
        document.getElementById('pb-company').innerText = currentLead['Company'];
        document.getElementById('pb-score').innerText = currentLead['GTM Score'] || '00';
        document.getElementById('pb-date').innerText = new Date().toLocaleDateString('en-US', { 
            year: 'numeric', month: 'long', day: 'numeric' 
        });

        document.getElementById('pb-sov').innerText = document.getElementById('pitch-preview').innerText;
        document.getElementById('pb-tech').innerText = document.getElementById('pitch-tech').innerText;
        document.getElementById('pb-roi').innerText = document.getElementById('pitch-roi').innerText;

        // Trigger native print logic
        window.print();
    }
    
    // UI Features
    function toggleRevenueHealth() {
        const healthView = document.getElementById('revenue-health-view');
        healthView.classList.toggle('hidden');
    }

    function toggleMarketIntel() {
        const intelView = document.getElementById('market-intel-view');
        const isHidden = intelView.classList.contains('hidden');
        
        intelView.classList.toggle('hidden');
        
        // Render only if making it visible
        if (isHidden) {
            renderMarketIntel();
        }
    }

    function renderMarketIntel() {
        if (!window.marketIntel) return;
        const container = document.getElementById('market-intel-content');
        const data = window.marketIntel;
        
        let html = `
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Strategic Goal Highlight -->
                <div class="lg:col-span-4 glass-panel p-6 rounded-2xl bg-gradient-to-r from-gold-950/20 to-obsidian border-l-4 border-gold-400">
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="text-[10px] font-mono text-gold-400 uppercase tracking-widest mb-1">FY2026 Sovereign Milestone</div>
                            <h2 class="text-4xl font-serif text-white tracking-tighter">$${data.revenue_goal.target}</h2>
                        </div>
                        <div class="px-4 py-2 bg-gold-400/10 rounded-lg border border-gold-400/20 text-right">
                            <div class="text-[9px] text-gold-400 font-black uppercase tracking-widest">${data.revenue_goal.progress_metric}</div>
                            <div class="text-xl text-white font-mono">${data.revenue_goal.timeframe}</div>
                            <div class="text-[8px] text-slate-500 mt-1 uppercase">Shift: 2025 Engineering â†’ 2026 Strategy</div>
                        </div>
                    </div>
                </div>

                <!-- Modern CRM Section -->
                <div class="glass-panel p-6 rounded-2xl border border-white/5">
                    <h3 class="text-xs font-black text-white uppercase tracking-widest mb-6 border-b border-white/5 pb-2">CRM Frontiers</h3>
                    <div class="space-y-4">
                        ${data.crm_landscape.slice(0, 3).map(crm => `
                            <div class="group cursor-default">
                                <div class="flex justify-between items-center mb-1">
                                    <span class="text-sm font-bold text-slate-100">${crm.name}</span>
                                    <span class="text-[8px] px-1.5 py-0.5 bg-slate-800 rounded text-slate-400 font-mono">${crm.category}</span>
                                </div>
                                <p class="text-[10px] text-slate-500 leading-tight">${crm.notes}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <!-- AI Agent Section -->
                <div class="glass-panel p-6 rounded-2xl border border-white/5 bg-purple-500/5">
                    <h3 class="text-xs font-black text-purple-300 uppercase tracking-widest mb-6 border-b border-purple-500/20 pb-2">Elite AI SDRs</h3>
                    <div class="space-y-4">
                        ${data.ai_agent_nodes[0].tools.slice(0, 4).map(t => `
                            <div class="flex justify-between items-start gap-4">
                                <div class="flex-1">
                                    <div class="text-xs font-bold text-white mb-0.5">${t.name}</div>
                                    <div class="text-[9px] text-slate-500 leading-none">${t.use}</div>
                                </div>
                                <div class="text-[8px] font-mono text-purple-400 uppercase font-black">${t.edge}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <!-- Engineering Ops Section -->
                <div class="glass-panel p-6 rounded-2xl border border-white/5 bg-blue-500/5">
                    <h3 class="text-xs font-black text-blue-300 uppercase tracking-widest mb-6 border-b border-blue-500/20 pb-2">Ops Engineering</h3>
                    <div class="space-y-4">
                        ${data.orchestration_layers[0].tools.slice(0, 4).map(t => `
                            <div class="flex justify-between items-center group cursor-pointer border-b border-white/5 pb-2 last:border-0 hover:bg-blue-400/5">
                                <div>
                                    <div class="text-xs font-bold text-white group-hover:text-blue-400 transition-colors">${t.name}</div>
                                    <div class="text-[9px] text-slate-500">${t.edge}</div>
                                </div>
                                <div class="h-1.5 w-1.5 rounded-full bg-blue-500 animate-pulse"></div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <!-- 2026 Strategic Shift (NEW) -->
                <div class="glass-panel p-6 rounded-2xl border border-gold-400/20 bg-gold-400/5">
                    <h3 class="text-xs font-black text-gold-400 uppercase tracking-widest mb-6 border-b border-gold-400/20 pb-2">2026 Strategic Shift</h3>
                    <div class="space-y-4">
                        ${data.technical_ops_arsenal[1] ? `
                            <div class="mb-4">
                                <div class="text-xs font-bold text-white mb-1">AI GTM Strategist</div>
                                <div class="text-[10px] text-slate-400 leading-tight">Focusing on system-wide friction, handoffs, and agentic governance vs simple outbound.</div>
                            </div>
                        ` : ''}
                        <div class="p-3 bg-slate-950/50 rounded border border-gold-400/10">
                            <div class="text-[8px] text-gold-500 font-mono uppercase mb-1">Signal Alert: Tori Needels</div>
                            <p class="text-[9px] text-slate-400 italic">"Databricks & UiPath hiring for AI GTM Leaders. The bridge is happening now."</p>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        container.innerHTML = html;
    }

    function toggleClientMode() {
        isClientMode = !isClientMode;
        const title = document.getElementById('app-title');
        const subtitle = document.getElementById('app-subtitle');
        const logoBox = document.getElementById('logo-box');
        
        if (isClientMode) {
            // Client Mode (White Label Style)
            title.innerHTML = "BELL<span class='text-blue-500'>::</span>TOWER";
            title.classList.remove('text-slate-100');
            title.classList.add('text-blue-100');
            
            subtitle.innerText = "Managed Defense Protocol";
            
            logoBox.className = "cursor-pointer h-8 w-8 bg-gradient-to-br from-blue-500 to-slate-800 rounded-sm flex items-center justify-center shadow-[0_0_15px_rgba(59,130,246,0.5)] hover:scale-110 transition";
            
            // Just for fun, change some accent colors via JS style injection if we wanted, 
            // but this is enough to show the "White Label" concept.
            alert("Accessing Partner Workspace: Bell Tower");
        } else {
            // Basin Mode
            title.innerHTML = "BASIN<span class='text-gold-400'>::</span>NEXUS";
            title.classList.remove('text-blue-100');
            title.classList.add('text-slate-100');
            
            subtitle.innerText = "Sovereign Revenue Architecture";
            
            logoBox.className = "cursor-pointer h-8 w-8 bg-gradient-to-br from-gold-400 to-amber-700 rounded-sm flex items-center justify-center shadow-[0_0_15px_rgba(212,175,55,0.3)] hover:scale-110 transition";
        }
    }

    // --- NEXUS ORACLE INTELLIGENCE ---
    function toggleOracle() {
        const container = document.getElementById('oracle-container');
        const pill = document.getElementById('oracle-pill');
        const isOpen = !container.classList.contains('opacity-0');
        
        if (isOpen) {
            container.classList.add('opacity-0', 'translate-y-8', 'pointer-events-none', 'scale-95');
            pill.classList.remove('opacity-0');
        } else {
            container.classList.remove('opacity-0', 'translate-y-8', 'pointer-events-none', 'scale-95');
            pill.classList.add('opacity-0');
            document.getElementById('oracle-input').focus();
        }
    }

    function handleOracleKey(e) {
        if (e.key === 'Enter') askOracle();
    }

    function appendOracleMessage(sender, text, isThinking = false) {
        const msgDiv = document.getElementById('oracle-messages');
        const color = sender === 'Oracle' ? 'text-blue-400' : 'text-emerald-400';
        const label = sender === 'Oracle' ? '[ORACLE]' : '[BASIN]';
        
        const newMsg = document.createElement('div');
        newMsg.className = 'flex gap-2 mb-2 animate-in fade-in slide-in-from-left-2 duration-300';
        if (isThinking) newMsg.id = 'oracle-thinking';
        newMsg.innerHTML = `<span class="${color} shrink-0">${label}</span><span class="${isThinking ? 'italic opacity-60' : ''}">${text}</span>`;
        msgDiv.appendChild(newMsg);
        msgDiv.scrollTop = msgDiv.scrollHeight;
        return newMsg;
    }

    async function askOracle() {
        const input = document.getElementById('oracle-input');
        const query = input.value.trim().toLowerCase();
        if (!query) return;

        appendOracleMessage('Basin', input.value);
        input.value = '';

        // Initial Thinking State
        const thinkingMsg = appendOracleMessage('Oracle', 'Connecting to Sovereign Registry...', true);
        
        const delay = (ms) => new Promise(res => setTimeout(res, ms));

        try {
            await delay(600);
            thinkingMsg.innerHTML = `<span class="text-blue-400 shrink-0">[ORACLE]</span><span class="italic opacity-60">Scanning ${window.rawData.length} signal nodes for pattern matches...</span>`;
            
            await delay(800);
            
            let response = "";
            let context = "";

            if (query.includes('resonance') || query.includes('audit')) {
                const recentBatch = window.rawData.filter(r => r['Enrichment Source'] && r['Enrichment Source'].includes('Batch Feb3')).length;
                response = `RESONANCE AUDIT INITIATED: Scanning ${recentBatch} strategic nodes from Feb 3 batch. Finding: High resonance with 'AI GTM Strategist' thesis. RECOMMENDATION: Deploy the Digital Workforce (Alice/Julian) protocols to Tori Needels, Mira Murati, and Lisa DeLuca immediately. Focus on 'System Friction' vs 'Lead Gen'.`;
            }
            else if (query.includes('strategy') || query.includes('2026') || query.includes('tori')) {
                response = `STRATEGIC SHIFT DETECTED: 2026 is moving from GTM Engineering (Task-level) to AI GTM Strategy (System-level). HIGHEST INTENT: Databricks, UiPath, and MaintainX are currently hiring for this exact Sovereign layer. We should pivot our 'Managed Defense' offering to these accounts.`;
            }
            else if (query.includes('plan') || query.includes('substack') || query.includes('outreach')) {
                const highFit = window.rawData.filter(r => (parseInt(r['GTM Score']) || 0) >= 90).length;
                response = `STRATEGIC VECTOR: I recommend a 'Sovereign Warm-up' sequence. First, deploy a Signal Audit to the ${highFit} high-score targets identified. This bypasses the 'Rented' intelligence of standard SDR platforms. Use a 'Proof of Work' Loom for the Tier 1s.`;
            } 
            else if (query.includes('tech') || query.includes('stack')) {
                const stacks = window.rawData.map(r => r['Tech Stack']).filter(t => t);
                const salesforceCount = stacks.filter(s => s.toLowerCase().includes('salesforce')).length;
                const hubspotCount = stacks.filter(s => s.toLowerCase().includes('hubspot')).length;
                response = `TECH AUDIT: Registry shows ${salesforceCount} Salesforce instances and ${hubspotCount} HubSpot deployments. RECOMMENDATION: Focus on the Salesforce cohort firstâ€”they have higher architectural complexity and 2.4x more 'interpretation drift' in their billing configurations.`;
            }
            else if (query.includes('who') || query.includes('top') || query.includes('target')) {
                const top3 = window.rawData.slice(0, 3);
                response = `PRIORITY TARGETING: The top signals are currently ${top3.map(r => r['Full Name']).join(', ')}. These represent the highest GTM alignment scores. Deploy the 'Attack Plan' associated with their specific firmgraphics immediately.`;
            }
            else if (query.includes('nexus') || query.includes('sovereign') || query.includes('how')) {
                response = `SYSTEM LOGIC: Basin::Nexus functions by moving reasoning to the edge. Instead of sending PII to a central cloud (OpenAI), we process signals locally to identify 'Decentralized Revenue' opportunities. This reduces latency by 80% and secures your IP.`;
            }
            else if (query.includes('mosin') || query.includes('om-sales') || query.includes('partner')) {
                response = `PARTNER STRATEGY: Oleksandr Mosin (OM-Sales) is currently looking for BDRs and Pre-Sales Engineers. RECOMMENDATION: Instead of a standard intro, propose a 'Managed Revenue Engine' alliance. Basin::Nexus automates the autonomous BDR layer he is hiring for, providing a way to scale his 1,800+ partners without hiring overhead. This secures a $3k/mo retainer.`;
            }
            else if (query.includes('bell') || query.includes('pavel') || query.includes('ken') || query.includes('hillary')) {
                response = `PEER INTELLIGENCE: You are currently engage with high-signal peers. RECOMMENDATION: Pivot the conversation from 'what tools do you use' to 'how do you own your GTM truth.' This establishes you as the Architect, not the Operator.`;
            }
            else {
                response = "ANALYSIS COMPLETE: Signal set ingested. Pattern matching suggests you should focus on 'High-Velocity' segments. Try asking for a 'tech audit', 'outreach plan', or 'top targets'.";
            }

            thinkingMsg.id = ''; // Remove thinking ID
            thinkingMsg.innerHTML = `<span class="text-blue-400 shrink-0">[ORACLE]</span><span>${response}</span>`;
            
        } catch (e) {
            thinkingMsg.innerHTML = `<span class="text-red-400 shrink-0">[ERROR]</span><span>Uplink interrupted. Please retry command.</span>`;
        }
    }

    // Start
    document.addEventListener('DOMContentLoaded', initDashboard);
  </script>
</body>
</html>
